* M1416-786 ... R. DALEY ... FILE COORDINATOR FOR FILE I/O SYSTEM ......FCOR0001
       PMC     ON                                                       FCOR0002
       NOLNK                                                            FCOR0003
       ENTRY   UPDMFD        TO ADD ENTRY TO MASTER FILE DIRECTORY      FCOR0004
       ENTRY   DELMFD        TO DELETE ENTRY FROM MASTER FILE DIRECTORY FCOR0005
       ENTRY   ATTACH        TO ATTACH TO A USER FILE DIRECTORY         FCOR0006
       ENTRY   ATTNAM        FIND NAME OF DIRECTORY ATTACHED TO         FCOR0007
       ENTRY   UPDATE        TO UPDATE USER FILE DIRECTORY              FCOR0008
       ENTRY   SETPRI        TO SET FILE PRIORITY WITHIN A USER         FCOR0009
       ENTRY   OPEN          TO PLACE A FILE IN ACTIVE STATUS           FCOR0010
       ENTRY   BUFFER        TO ASSIGN A BUFFER TO AN ACTIVE FILE       FCOR0011
       ENTRY   RDFILE        TO READ FROM AN ACTIVE FILE                FCOR0012
       ENTRY   RDWAIT        TO READ AND WAIT UNTIL I/O COMPLETED       FCOR0013
       ENTRY   WRFILE        TO WRITE INTO AN ACTIVE FILE               FCOR0014
       ENTRY   WRWAIT        TO WRITE AND WAIT UNTIL I/O COMPLETED      FCOR0015
       ENTRY   TRFILE        TO TRUNCATE AN ACTIVE FILE                 FCOR0016
       ENTRY   FCHECK        TO CHECK I/O STATUS OF AN ACTIVE FILE      FCOR0017
       ENTRY   FWAIT         TO WAIT UNTIL I/O DONE ON ACTIVE FILE      FCOR0018
       ENTRY   CLOSE         TO REMOVE A FILE FROM ACTIVE STATUS        FCOR0019
       ENTRY   RESETF        TO RESET ALL ACTIVE FILES                  FCOR0020
       ENTRY   CHFILE        TO CHANGE THE NAME AND/OR MODE OF A FILE   FCOR0021
       ENTRY   RSFILE        TO UNLOCK INTERLOCKED FILE                 FCOR0022
       ENTRY   DELFIL        TO DELETE A FILE                           FCOR0023
       ENTRY   FSTATE        TO RETURN FILE STATUS INFORMATION          FCOR0024
       ENTRY   MOVFIL        TO MOVE A FILE FROM UFD TO UFD             FCOR0025
       ENTRY   SETFIL        TO CREATE A FILE ENTRY FOR LOAD ROUTINE    FCOR0026
       ENTRY   LINK          TO CREATE A LINK TO A FILE                 FCOR0027
       ENTRY   UNLINK        TO DELETE A LINK TO A FILE                 FCOR0028
       ENTRY   ALLOT         TO ALLOT SECONDARY STORAGE QUOTAS          FCOR0029
       ENTRY   STORGE        TO RETURN SECONDARY STORAGE INFO. TO USER  FCOR0030
       ENTRY   MOUNT         TO MOUNT A TAPE                            FCOR0031
       ENTRY   UMOUNT        TO UNMOUNT A TAPE                          FCOR0032
       ENTRY   VERIFY        TO VERIFY A TAPE LABEL (FOLLOWS MOUNT)     FCOR0033
       ENTRY   LABEL         TO WRITE A TAPE LABEL (FOLLOWS MOUNT)      FCOR0034
       ENTRY   TAPFIL        TO DECLARE A FILE TO EXIST ON A TAPE       FCOR0035
       ENTRY   IODIAG        TO RETURN ERROR DIAGNOSTIC INFORMATION     FCOR0036
       REM                                                              FCOR0037
       REM     ..... THE FOLLOWING ENTRIES ARE AVAILABLE TO CTSS ONLY   FCOR0038
       REM                                                              FCOR0039
       ENTRY   SETUSR        TO SET UP I/O USER STATUS TABLE            FCOR0040
       ENTRY   CHNGUS        TO CHANGE TO NEW USER OF FILE SYSTEM       FCOR0041
       ENTRY   SETRAP        TO SET SUPERVISORY INTERRUPT PROCEDURE     FCOR0042
       ENTRY   USTAT         TO SET A.F.S.T. AND QUEUE STORAGE          FCOR0043
       ENTRY   USAVE         TO SAVE STATUS OF ALL ACTIVE FILES         FCOR0044
       ENTRY   SETAB         TO SET MEMORY SWITCHES                     FCOR0045
       ENTRY   GETUSR        TO GET SLOTNO AND MEMORY SWITCHES          FCOR0046
       ENTRY   IOSTOP        TO HALT INPUT/OUTPUT                       FCOR0047
       ENTRY   IOSTRT        TO RESTART INPUT/OUTPUT                    FCOR0048
       ENTRY   IORSET        TO INFORM FILE SYSTEM OF MACHINE RESET     FCOR0049
       ENTRY   IOFINI        TO FINISH ALL QUEUED I/O REQUESTS          FCOR0050
       ENTRY   IOINIT        TO INITIALIZE I/O SYSTEM                   FCOR0051
       REM                                                              FCOR0052
       REM     ..... ENTRIES TO FILE COORDINATOR UTILITY ROUTINES ......FCOR0053
       REM                                                              FCOR0054
       ENTRY   GTDYTM        TO PICK UP CURRENT DATE/TIME, RETURN IN AC FCOR0055
       ENTRY   GETDAY        TO PICK UP DATE ONLY IN AC (IN BCD)        FCOR0056
       ENTRY   STAFIL        TO ENTER ACTIVE FILE FOR SLOT '0'          FCOR0057
       ENTRY   GTAFIL        TO FIND ACTIVE FILE FOR SLOT '0'           FCOR0058
       ENTRY   RELEAS        TO RELEASE FILE FROM ACTIVE STATUS         FCOR0059
       ENTRY   MOVE          TO MOVE WORDS BETWEEN MEMORIES A AND B     FCOR0060
       ENTRY   RCHECK        TO RELOCATE AND CHECK ADDRESSES            FCOR0061
       ENTRY   RECADR        TO COMPUTE LINEAR ADDRESS FROM RECORD COUNTFCOR0062
       ENTRY   GETEFA        TO COMPUTE EFFECTIVE ADDRESS OF WORD IN AC FCOR0063
       ENTRY   SSTRAP        TO INTERRUPT SUPERVISORY SYSTEM            FCOR0064
       REM                                                              FCOR0065
       REM     ..... ENTRIES TO FILE COORDINATOR STATUS INFORMATION ....FCOR0066
       REM                                                              FCOR0067
       ENTRY   UTABLE        POINTER TO CURRENT USER STATUS TABLE       FCOR0068
       ENTRY   USRTBL        TABLE OF POINTERS TO USER A.F.S.T. TABLES  FCOR0069
       ENTRY   PRIORT        SORTED USER PRIORITY TABLE                 FCOR0070
       ENTRY   SLOTNO        CURRENT I/O SLOT NO. OF CURRENT USER       FCOR0071
       REM                                                              FCOR0072
       ENTRY   FS.TST        SPECIAL PRIVILEGES SWITCH (DAEMON)         FCOR0073
       REM                                                              FCOR0074
       REM     ..... ENTRIES TO BUFFER CONTROL MODULE ..................FCOR0075
       REM                                                              FCOR0076
       EXTERN  BOPEN,BASIGN,BREAD,BWRITE,BTRUNC,BCHECK,BSAVE,BCLOSE     FCOR0077
       REM                                                              FCOR0078
       REM     ..... ENTRIES TO I/O CONTROL MODULE ..................   FCOR0079
       REM                                                              FCOR0080
       EXTERN  IOHALT,IOBEGN,IORST,DRAIN                                FCOR0081
       REM                                                              FCOR0082
       REM     ..... ENTRIES TO UFD AND MFD SEARCH MODULE ..............FCOR0083
       REM                                                              FCOR0084
       EXTERN  SEARCH,UPDFIL,ADDFIL,REMOVE,REWRIT,GETQU,SETQU,IFILES    FCOR0085
       REM                                                              FCOR0086
       REM     ..... ENTRIES TO TAPE MOUNT AND UNMOUNT MODULE ..........FCOR0087
       REM                                                              FCOR0088
       EXTERN  MNTTAP,UMTTAP,UMTALL,VERTAP,LBLTAP                       FCOR0089
       REM                                                              FCOR0090
       REM     ..... ENTRIES TO EXTERNAL UTILITY ROUTINES ...........   FCOR0091
       REM                                                              FCOR0092
       EXTERN  FILXIT,IDRUMS,IDISKS,UPDRUM,UPDISK                       FCOR0093
       REM                                                              FCOR0094
       REM                                                              FCOR0095
       REM                                                              FCOR0097
       EJECT                                                            FCOR0098
       INSERT  IOEQU         INSERT I/O SYSTEM EQUIVALENCE PACKAGE      FCOR0099
       EJECT                                                            FCOR0100
       REM     ............ PARAMETER DEFINITIONS ..............        FCOR0101
       REM                                                              FCOR0102
PMAX   EQU     1             MAX. NUMBER OF FILE POINTER WORDS          FCOR0103
SFILES EQU     5             NUMBER OF ACTIVE FILES FOR FILE SYSTEM     FCOR0104
LDEPTH EQU     2             MAX. LEVEL OF FILE LINKING ALLOWED         FCOR0105
SVWRDS EQU     8             NO. OF WORDS/ACTIVE FILE ON 'SAVE' COMMANDSFCOR0106
RGRACE EQU     80            NO. OF RECORDS USER MAY EXCEED QUOTA       FCOR0107
       REM                                                              FCOR0108
1QL    EQU     1+7*4         QUEUE STORAGE FOR DEVICE 1                 FCOR0109
2QL    EQU     0             .. 2                                       FCOR0110
       REM                                                              FCOR0111
       REM     MODE AND STATUS BIT DEFINITIONS                          FCOR0112
       REM                                                              FCOR0113
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR0114
       REM                                                              FCOR0115
       REM     FILE- AND REFERENCE-MODES                                FCOR0116
       REM                                                              FCOR0117
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR0118
       REM                                                              FCOR0119
M.M    BOOL    400000        DAEMON RE-LOAD (MICK'S MODE)               FCOR0120
P.M    BOOL    200000        PROTECTED                                  FCOR0121
L.M    BOOL    100000        SYSTEM-TRAP (LINKABLE)                     FCOR0122
V.M    BOOL    040000        PRIVATE                                    FCOR0123
W.M    BOOL    020000        WRITE-ONLY                                 FCOR0124
R.M    BOOL    010000        READ-ONLY                                  FCOR0125
S.M    BOOL    004000        DATE-REMOVE (SECONDARY)                    FCOR0126
T.M    BOOL    002000        TEMPORARY                                  FCOR0127
       REM                                                              FCOR0128
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR0129
       REM                                                              FCOR0130
       REM     FILE REFERENCE STATUS                                    FCOR0131
       REM                                                              FCOR0132
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR0133
       REM                                                              FCOR0134
S.S    BOOL    400000        'SAVED' (USAVE)                            FCOR0135
W.S    BOOL    200000        OPEN/WRITING                               FCOR0136
R.S    BOOL    100000        OPEN/READING                               FCOR0137
       EJECT                                                            FCOR0138
       REM     ................ MACRO DEFINTIONS .......................FCOR0139
       REM                                                              FCOR0140
SEARCH MACRO   DIR,FILNAM,NOFILE  SEARCH USER OR MASTER FILE DIRECTORY  FCOR0141
       TSX     SEARCH,4      CALL SEARCH MODULE                         FCOR0142
       IFF     1,DIR,UFD     IS DIR .E. 'UFD'                           FCOR0143
       EFA     PROBNO,1      IF SO SET TO SEARCH CURRENT UFD            FCOR0144
       IFF     0,DIR,UFD     OTHERWISE                                  FCOR0145
       EFA     DIR           SET TO SEARCH SPECIFIED DIRECTORY          FCOR0146
       EFA     FILNAM        POINTER TO FILE NAME                       FCOR0147
       EFA     FPROBN,2      POINTER TO SLOT IN A.F.S.T.                FCOR0148
       PAR     NOFILE,,UFDERR  ERROR RETURNS                            FCOR0149
SEARCH END                                                              FCOR0150
       REM                                                              FCOR0151
UPDFIL MACRO   DIR,FILNAM,NOFILE  UPDATE USER OR MASTER FILE DIRECTORY  FCOR0152
       TSX     UPDFIL,4      CALL SEARCH MODULE                         FCOR0153
       IFF     1,DIR,UFD     IS DIR .E. 'UFD'                           FCOR0154
       EFA     FPROBN,2      IF SO UPDATE UFD OF THIS FILE              FCOR0155
       IFF     0,DIR,UFD     OTHERWISE                                  FCOR0156
       EFA     DIR           UPDATE SPECIFIED DIRECTORY                 FCOR0157
       EFA     FILNAM        POINTER TO FILE NAME                       FCOR0158
       EFA     FPROBN,2      POINTER TO FILE ENTRY IN A.F.S.T.          FCOR0159
       PAR     NOFILE,,UFDERR  ERROR RETURNS                            FCOR0160
UPDFIL END                                                              FCOR0161
       REM                                                              FCOR0162
ADDFIL MACRO   DIR,NOROOM    ADD FILE TO USER OR MASTER FILE DIRECTORY  FCOR0163
       TSX     ADDFIL,4      CALL SEARCH MODULE                         FCOR0164
       IFF     1,DIR,UFD     IS DIR .E. 'UFD'                           FCOR0165
       EFA     FPROBN,2      IF SO ADD FILE TO CURRENT USER'S UFD       FCOR0166
       IFF     0,DIR,UFD     OTHERWISE                                  FCOR0167
       EFA     DIR           ADD FILE TO SPECIFIED DIRECTORY            FCOR0168
       EFA     FPROBN,2      POINTER TO FILE ENTRY                      FCOR0169
       PAR     NOROOM,,UFDERR  ERROR RETURNS                            FCOR0170
ADDFIL END                                                              FCOR0171
       REM                                                              FCOR0172
REMOVE MACRO   DIR,FILNAM,NOFILE  DELETE FILE FROM UFD OR MFD           FCOR0173
       TSX     REMOVE,4      CALL SEARCH MODULE                         FCOR0174
       IFF     1,DIR,UFD     IS DIR .E. 'UFD'                           FCOR0175
       EFA     FPROBN,2      IF SO DELETE FROM CURRENT USER'S UFD       FCOR0176
       IFF     0,DIR,UFD     OTHERWISE                                  FCOR0177
       EFA     DIR           DELETE FROM SPECIFIED DIRECTORY            FCOR0178
       EFA     FILNAM        POINTER TO FILE NAME                       FCOR0179
       PAR     NOFILE,,UFDERR  ERROR RETURNS                            FCOR0180
REMOVE END                                                              FCOR0181
       REM                                                              FCOR0182
REWRIT MACRO   DIR,NOFILE    UPDATE UFD OR MFD STATUS                   FCOR0183
       TSX     REWRIT,4      CALL SEARCH MODULE                         FCOR0184
       IFF     1,DIR,UFD     IS DIR .E. 'UFD'                           FCOR0185
       EFA     PROBNO,1      IF SO UPDATE CURRENT USER FILE DIRECTORY   FCOR0186
       IFF     0,DIR,UFD     OTHERWISE                                  FCOR0187
       EFA     DIR           UPDATE SPECIFIED DIRECTORY                 FCOR0188
       PAR     NOFILE,,UFDERR  ERROR RETURNS                            FCOR0189
REWRIT END                                                              FCOR0190
       REM                                                              FCOR0191
GETQU  MACRO   DIR           GET RECORD QUOTA,,USED FROM UFD            FCOR0192
       TSX     GETQU,4       CALL SEARCH MODULE                         FCOR0193
       EFA     DIR           POINTER TO USER MFD ENTRY                  FCOR0194
       EFA     0,3           DEVICE NUMBER                              FCOR0195
       PAR     QUMERR,,UFDERR  ERROR RETURNS                            FCOR0196
GETQU  END                                                              FCOR0197
       REM                                                              FCOR0198
SETQU  MACRO   DIR           SET RECORD QUOTA,,USED IN UFD              FCOR0199
       TSX     SETQU,4       CALL SEARCH MODULE                         FCOR0200
       EFA     DIR           POINTER TO USER MFD ENTRY                  FCOR0201
       EFA     0,3           DEVICE NUMBER                              FCOR0202
       PAR     QUMERR,,UFDERR  ERROR RETURNS                            FCOR0203
SETQU  END                                                              FCOR0204
       REM                                                              FCOR0205
CHKUFD MACRO   DIR,NODIR     CHECK FOR SPECIFIED FILE DIRECTORY         FCOR0206
       TSX     SEARCH,4      SEARCH M.F.D. (FILE) FOR UFD               FCOR0207
       EFA     MFD           ..                                         FCOR0208
       EFA     DIR           POINTER TO UFD                             FCOR0209
       EFA     CHKTMP        SCRAP RETURN INFO                          FCOR0210
       PAR     NODIR,,UFDERR ERROR RETURNS                              FCOR0211
CHKUFD END                                                              FCOR0212
       REM                                                              FCOR0213
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR0214
       REM                                                              FCOR0215
MOVE1  MACRO   FMEM,FROM,TMEM,TO,ERRTN  MOVE WORD BETWEEN HOME AND USER FCOR0216
       TSX     MOVE,4        CALL MOVE ROUTINE                          FCOR0217
       PAR     FMEM,,TMEM    ..                                         FCOR0218
       EFA     FROM          ..                                         FCOR0219
       EFA     TO            ..                                         FCOR0220
       EFA     1             .. MOVE ONE WORD                           FCOR0221
       PAR     ERRTN         ..                                         FCOR0222
MOVE1  END                                                              FCOR0223
       REM                                                              FCOR0224
GETPAR MACRO   EFA           PICK UP PARAMETER FROM USER CALL           FCOR0225
       XEC     PARMEM        SET ECC FOR USER'S MEMORY                  FCOR0226
       CAL     EFA           PICK UP PARAMETER                          FCOR0227
       HOMOP                 RESET ECC TO 'HOME'                        FCOR0228
GETPAR END                                                              FCOR0229
       REM                                                              FCOR0230
       MACRO                 USER SAVE MACRO                            FCOR0231
NAME   SAVE    UCODE,SFLAG,PLIST  ..                                    FCOR0232
NAME   SXA     IR4,4         SAVE IR4 FIRST                             FCOR0233
       TSX     SAVE,4        CALL USER SAVE ROUTINE                     FCOR0234
       PAR     =H'NAME       ENTRY NAME                                 FCOR0235
       PAR     =O'UCODE'     RESTRICTION CODE                           FCOR0236
       IFF     1,SFLAG,S     IS SFLAG .E. S                             FCOR0237
       PAR     =O77777       IF SO SET FLAG TO INSURE USER SIGNED ON    FCOR0238
       IFF     0,SFLAG,S     OTHERWISE                                  FCOR0239
       PAR     =0            SET TO SKIP SIGNED-ON TEST                 FCOR0240
       IRP     PLIST                                                    FCOR0241
       PAR     PLIST         PARAMETER LIST PROTOTYPE                   FCOR0242
       IRP                                                              FCOR0243
SAVE   END                                                              FCOR0244
       REM                                                              FCOR0245
       MACRO                 SUPERVISOR SAVE MACRO                      FCOR0246
NAME   SSAVE   PLIST         ..                                         FCOR0247
NAME   SXA     IR4,4         SAVE IR4 FIRST                             FCOR0248
       TSX     SSAVE,4       CALL SUPERVISOR SAVE ROUTINE               FCOR0249
       PAR     =H'NAME       ENTRY NAME                                 FCOR0250
       PAR     =0            NULL RESTRICTION CODE                      FCOR0251
       PAR     =0            SKIP SIGNED-ON TEST                        FCOR0252
       IRP     PLIST                                                    FCOR0253
       PAR     PLIST         PARAMETER LIST PROTOTYPE                   FCOR0254
       IRP                                                              FCOR0255
SSAVE  END                                                              FCOR0256
       REM                                                              FCOR0257
ERROR  MACRO   N             STANDARD ERROR PROCEDURE                   FCOR0258
       XEC     ERR'N         EXECUTE ERROR PROCEDURE                    FCOR0259
       RMT                   DEFINE (ERR'N) IF NECESSARY                FCOR0260
       IFF     ERR'N,0,1     ..                                         FCOR0261
       DFINE   ERR'N,ERROR,N ..                                         FCOR0262
       RMT                   ..                                         FCOR0263
ERROR  END                                                              FCOR0264
       REM                                                              FCOR0265
IOERR  MACRO   N             STANDARD I/O ERROR PROCEDURE               FCOR0266
       XEC     IOE'N         EXECUTE I/O ERROR PROCEDURE                FCOR0267
       RMT                   DEFINE (IOE'N) IF NECESSARY                FCOR0268
       IFF     IOE'N,0,1     ..                                         FCOR0269
       DFINE   IOE'N,IOERR,N ..                                         FCOR0270
       RMT                   ..                                         FCOR0271
IOERR  END                                                              FCOR0272
       REM                                                              FCOR0273
DFINE  MACRO   LOC,NAME,N    DEFINE ERROR PROCEDURE                     FCOR0274
LOC    TSX     NAME,4        GO TO ERROR ROUTINE                        FCOR0275
       PAR     N             .. ERROR CODE                              FCOR0276
DFINE  END                                                              FCOR0277
       REM                                                              FCOR0278
GTSTAT MACRO   NAME,ERRTN    GET ACTIVE FILE STATUS FROM A.F.S.T.       FCOR0279
       TSX     GTSTAT,4      PICK UP ACTIVE FILE STATUS                 FCOR0280
       PAR     NAME,,ERRTN   ..                                         FCOR0281
GTSTAT END                                                              FCOR0282
       REM                                                              FCOR0283
RELEAS MACRO   RPROB         RELEASE FILE FROM ACTIVE STATUS            FCOR0284
       STZ     RPROB         ..                                         FCOR0285
RELEAS END                                                              FCOR0286
       REM                                                              FCOR0287
RTNFIL MACRO   ERRTN         NORMAL CLOSE OUT OF ACTIVE FILE            FCOR0288
       TSX     RTNFIL,4      .. CALLS RELEAS                            FCOR0289
       PAR     ERRTN         .. POSSIBLE ERROR RETURN                   FCOR0290
RTNFIL END                                                              FCOR0291
       REM                                                              FCOR0292
USTORE MACRO   PARAM,ENDRTN  MOVE WORD TO USER ARRAY AND BUMP ADDRESS   FCOR0293
       TSX     USTORE,4      ..                                         FCOR0294
       PAR     PARAM,,ENDRTN .. RETURN TO ENDRTN AT END OF ARRAY        FCOR0295
USTORE END                                                              FCOR0296
       REM                                                              FCOR0297
SSTRAP MACRO   ICODE,IR4,ILC,INFO,COUNT  INTERRUPT SUPERVISOR           FCOR0298
       TSX     SSTRAP,4      CALL SUPERVISOR INTERRUPT PROCEDURE        FCOR0299
       PAR     SLOTNO        ..                                         FCOR0300
       PAR     =ICODE        ..                                         FCOR0301
       PAR     IR4           ..                                         FCOR0302
       PAR     ILC           ..                                         FCOR0303
       PAR     INFO,,COUNT   ..                                         FCOR0304
SSTRAP END                                                              FCOR0305
       REM                                                              FCOR0306
LXTC   MACRO   WORD,TAG      LOAD INDEX FROM TAG COMPLEMENTED           FCOR0307
       CAL     WORD          GET WORD                                   FCOR0308
       ARS     15            TAG TO ADDRESS                             FCOR0309
       ANA     =O7           MODULO 2.P.3                               FCOR0310
       PAC     0,TAG         -TAG TO INDEX REGISTER                     FCOR0311
LXTC   END                                                              FCOR0312
       REM                                                              FCOR0313
EXIT   MACRO   IR4SAV,RTNLOC COMMON EXIT FROM I/O SYSTEM                FCOR0314
       TSX     FILXIT,4      EXIT THROUGH SUPERVISOR EXIT ROUTINE       FCOR0315
       LXA     IR4SAV,4      ..                                         FCOR0316
               RTNLOC        ..                                         FCOR0317
EXIT   END                                                              FCOR0318
       REM                                                              FCOR0319
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR0320
       REM                                                              FCOR0321
       REM     ...... ERROR RETURNS FROM SEARCH MODULE .............    FCOR0322
       REM                                                              FCOR0323
UFDERR ERROR   100           ERROR(100), I/O ERROR UFD OR MFD           FCOR0324
       REM                                                              FCOR0325
QUMERR ERROR   101           ERROR(101), UFD UNKNOWN MACHINE ERROR      FCOR0326
       EJECT                                                            FCOR0327
       REM                                                              FCOR0328
       MACRO                 MACRO TO GENERATE CALLS TO STRATEGY MODULESFCOR0329
SYMBOL GNCALL  NAME          ..                                         FCOR0330
       PMC     ON            ..                                         FCOR0331
SYMBOL SYN     *-1           .. DEFINE SYMBOL FOR TABLE REFERENCE       FCOR0332
       PMC     OFF           ..                                         FCOR0333
       SERNAM  NAME,FMAX,(1,2,3,4,5,6,7)  .. GENERATE CALLS             FCOR0334
GNCALL END                                                              FCOR0335
       REM                                                              FCOR0336
SERNAM MACRO   NAME,MAX,LIST,SYM  GENERATE STRATEGY MODULE CALLS        FCOR0337
       IRP     LIST          ..                                         FCOR0338
SYM    SET     LIST-1        ..                                         FCOR0339
       IFF     SYM/MAX,1,0   ..                                         FCOR0340
       CONC    NAME,LIST     ..                                         FCOR0341
       IRP                   ..                                         FCOR0342
SERNAM END                                                              FCOR0343
       REM                                                              FCOR0344
CONC   MACRO   NAME,NO       GENERATE A SINGLE CALL                     FCOR0345
       EXTERN  NAME'NO'      ..                                         FCOR0346
       PMC     ON            ..                                         FCOR0347
       TSX     NAME'NO,4     .. CALL TO STRATEGY MODULE                 FCOR0348
       PMC     OFF           ..                                         FCOR0349
CONC   END                                                              FCOR0350
       REM                                                              FCOR0351
       REM     ..... CONSTRUCT STRATEGY MODULE CALLING VECTORS .........FCOR0352
       REM                                                              FCOR0353
DFILEF GNCALL  DFILE         CALL TO DELETE A FILE                      FCOR0354
       REM                                                              FCOR0355
SCRAPF GNCALL  SCRAP         CALL TO SCRAP PREVIOUSLY REQUESTED I/O     FCOR0356
       REM                                                              FCOR0357
SINITF GNCALL  SINIT         CALL TO INITIALIZE STRATEGY MODULE         FCOR0358
       REM                                                              FCOR0359
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR0360
       REM                                                              FCOR0361
       REM     ..... INITIALIZE OTHER MODULES IN THIS ORDER ............FCOR0362
       REM                                                              FCOR0363
SETMOD SYN     *-1           OTHER MODULES THAT MUST BE INITIALIZED     FCOR0364
       TSX     IFILES,4      .. INITIALIZE SEARCH MODULE                FCOR0365
       TSX     IDRUMS,4      .. INITIALIZE DRUM TRACK MODULE            FCOR0366
       TSX     IDISKS,4      .. INITIALIZE DISK TRACK MODULES           FCOR0367
NINIT  SYN     *-SETMOD-1    .. COUNT OF ENTRIES TO BE INITIALIZED      FCOR0368
       REM                                                              FCOR0369
       REM     ..... MODULES TO BE CALLED BY UPDATE ....................FCOR0370
       REM                                                              FCOR0371
UPDMOD SYN     *-1           MODULES THAT SHOULD BE UPDATED             FCOR0372
       TSX     UPDRUM,4      .. UPDATE DRUM TRACK USAGE MODULE          FCOR0373
       TSX     UPDISK,4      .. UPDATE DISK TRACK USAGE MODULE          FCOR0374
NUPDAT SYN     *-UPDMOD-1    COUNT OF ENTRIES TO BE UPDATED             FCOR0375
       REM                                                              FCOR0376
       REM                                                              FCOR0378
       EJECT                                                            FCOR0379
       REM                                                              FCOR0380
       REM     UPDMFD.($PROBNO$,$PROGNO$)                               FCOR0381
       REM                                                              FCOR0382
UPDMFD SAVE    002,N,(FN)                                               FCOR0383
       REM                                                              FCOR0384
       AXC     FILTMP,2                                                 FCOR0385
       SEARCH  MFD,FILNAM,UPDM1  CHECK IF USER ALREADY IN MFD           FCOR0386
       ERROR   3             UPDMFD ERROR(3), USER ALREADY IN MFD       FCOR0387
       REM                                                              FCOR0388
UPDM1  CLA     FILNAM        USER NOT IN MFD, CONSTRUCT NEW MFD ENTRY   FCOR0389
       TZE     UMFDE5        ZERO PROBN IS USED FOR OTHER TESTS         FCOR0390
       LDQ     FILNAM+1      NAME 2 OF ATTACHED DIRECTORY               FCOR0391
       DST     FNAME1,2      PUT IN NEW ENTRY                           FCOR0392
       TSX     GTDYTM,4      ..                                         FCOR0393
       SLW     DAYTIM,2      .. DATE + TIME CREATED                     FCOR0394
       ANA     =O777777000000 ..                                        FCOR0395
       ORA     AUTHNO,1      ADD AUTHOR NUMBER FROM USER'S AFST         FCOR0396
       SLW     DATELU,2      .. DATE LAST USED                          FCOR0397
       CLA     =O210000100000  .. READ-ONLY, PROTECTED MODE             FCOR0398
       LDQ     TGPMAX        .. PMAX IN TAG                             FCOR0399
       DST     MODE,2        PUT IN MODE, DEVICE, PMAX, ETC             FCOR0400
       ADDFIL  MFD,UMFDME    ADD THIS ENTRY TO THE MFD                  FCOR0401
       AXC     1,3                                                      FCOR0402
UPDM2  ZAC                   SET RECORD QUOTAS TO ZERO                  FCOR0403
       SETQU   (FNAME1,2)    ..                                         FCOR0404
       TXL     *+2,3,-FMAX   ..                                         FCOR0405
       TXI     UPDM2,3,-1    ..                                         FCOR0406
       REWRIT  FILNAM,UMFDME UPDATE USER FILE DIRECTORY                 FCOR0407
       REWRIT  MFD,UMFDME    UPDATE MASTER FILE DIRECTORY               FCOR0408
       TRA     RETURN        RETURN TO CALLER                           FCOR0409
       REM                                                              FCOR0410
UMFDME ERROR   4             UPDMFD ERROR(4), MACHINE OR SYSTEM ERROR   FCOR0411
       REM                                                              FCOR0412
UMFDE5 ERROR   5             UPDMFD ERROR(5), ZERO PROBLEM NUMBER       FCOR0413
       REM                                                              FCOR0414
       EJECT                                                            FCOR0415
       REM                                                              FCOR0416
       REM     DELMFD.($PROBNO$,$PROGNO$)                               FCOR0417
       REM                                                              FCOR0418
DELMFD SAVE    002,N,(FN)                                               FCOR0419
       REM                                                              FCOR0420
       AXC     FILTMP,2                                                 FCOR0421
       SEARCH  MFD,FILNAM,DMFDME  FIND THIS MFD ENTRY                   FCOR0422
       AXC     1,3                                                      FCOR0423
DMFD1  GETQU   FILNAM        INSURE NO RECORDS USED                     FCOR0424
       PDX     0,4           ..                                         FCOR0425
       TXH     DMFDE4,4,0    .. ERROR IF ALL FILES NOT DELETED          FCOR0426
       TXL     *+2,3,-FMAX   ..                                         FCOR0427
       TXI     DMFD1,3,-1    ..                                         FCOR0428
       REWRIT  FILNAM,DMFDME INSURE THIS DIRECTORY IS CLOSED            FCOR0429
       TSX     DFILE,4       TRY TO DELETE THIS FILE                    FCOR0430
       REMOVE  MFD,FILNAM,DMFDME  REMOVE USER FROM MFD                  FCOR0431
       REWRIT  MFD,DMFDME        UPDATE MASTER FILE DIRECTORY           FCOR0432
       TRA     RETURN        RETURN TO CALLER                           FCOR0433
       REM                                                              FCOR0434
DMFDME ERROR   3             DELMFD ERROR(3), USER NOT FOUND IN MFD     FCOR0435
       REM                                                              FCOR0436
DMFDE4 ERROR   4             DELMFD ERROR(4), UFD STILL IN USE          FCOR0437
       REM                                                              FCOR0438
       EJECT                                                            FCOR0439
       REM                                                              FCOR0440
       REM     ATTACH.($PROBNO$,$PROGNO$)                               FCOR0441
       REM                                                              FCOR0442
ATTACH SAVE    002,N,(FN)                                               FCOR0443
       REM                                                              FCOR0444
       NZT     PROBNO,1      IS ANYONE CURRENTLY IN THIS SLOT           FCOR0445
       TRA     ATTCH1        NO, SKIP                                   FCOR0446
       REWRIT  UFD,ATTMER    YES, UPDATE HIS FILE DIRECTORY             FCOR0447
ATTCH1 NZT     FILNAM                                                   FCOR0448
       TRA     ATTCH2        ATTACH.(0,X),  AFST DE-ACTIVATED           FCOR0449
       CAL     FILNAM+1      CHECK FOR USAGE TABLE ENTRIES              FCOR0450
       ERA     UTFNAM        GENERIC SECOND NAME                        FCOR0451
       TNZ     ATTCH3        NOT RESTRICTED NAME                        FCOR0452
       CAL     FILNAM        CHECK FIRST NAME                           FCOR0453
       ERA     DRMNAM        IS IT DRUM USAGE                           FCOR0454
       TZE     ATTERR        YES, CANNOT BE 'EXECUTED'                  FCOR0455
       CAL     FILNAM        ..                                         FCOR0456
       ERA     DSKNAM        OR DISK USAGE                              FCOR0457
       TZE     ATTERR        ..                                         FCOR0458
ATTCH3 AXC     FILTMP,2      TEMPORARY SLOT FOR MFD SEARCH              FCOR0459
       SEARCH  MFD,FILNAM,ATTERR  FIND USER IN MFD                      FCOR0460
       LDI     F,2           MAKE SURE THERE'S NOT A LINK THERE SOMEHOW FCOR0461
       RFT     700000        TEST DEVICE FIELD                          FCOR0462
       TRA     *+2           OK                                         FCOR0463
       TRA     ATTMER        RE-USE ERROR CODE                          FCOR0464
ATTCH2 CLA     FILNAM        GET USER PROBLEM NO.                       FCOR0465
       LDQ     FILNAM+1      AND PROGRAMMER NO.                         FCOR0466
       DST     PROBNO,1      SAVE IN AFST                               FCOR0467
       TRA     RETURN        RETURN TO CALLER                           FCOR0468
       REM                                                              FCOR0469
ATTERR ERROR   3             ATTACH ERROR(3), USER NOT IN MFD           FCOR0470
       REM                                                              FCOR0471
ATTMER ERROR   4             ATTACH ERROR(4), MACHINE OR SYSTEM ERROR   FCOR0472
       REM                                                              FCOR0473
       REM     ATTNAM.(A(N)...N)                                        FCOR0474
       REM                                                              FCOR0475
ATTNAM SAVE    0,N,(ARY)                                                FCOR0476
       REM                                                              FCOR0477
       CAL     PROBNO,1      RETURN NAME OF DIRECTORY TO WHICH          FCOR0478
       USTORE  P1,RETURN     USER IS ATTACHED                           FCOR0479
       CAL     PROGNO,1      PROBN, PROGN                               FCOR0480
       USTORE  P1,RETURN     ..                                         FCOR0481
       CAL     AUTHNO,1      BINARY VALUE OF AUTHOR NUMBER              FCOR0482
       USTORE  P1,RETURN     ..                                         FCOR0483
       CAL     FPRIOR,1      USER FILE-PRIORITY SETTING                 FCOR0484
       USTORE  P1,RETURN     ..                                         FCOR0485
       TRA     RETURN                                                   FCOR0486
       REM                                                              FCOR0487
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR0488
       REM                                                              FCOR0489
       REM     UPDATE.                                                  FCOR0490
       REM                                                              FCOR0491
UPDATE SAVE    0,N,()                                                   FCOR0492
       REM                                                              FCOR0493
       TSX     UPDSYS,4      UPDATE ALL NECESSARY INFORMATION           FCOR0494
       PAR     UPDMER        .. POSSIBLE ERROR RETURN                   FCOR0495
       TRA     RETURN        RETURN TO CALLER                           FCOR0496
       REM                                                              FCOR0497
UPDMER ERROR   3             UPDATE ERROR(3), MACHINE OR SYSTEM ERROR   FCOR0498
       REM                                                              FCOR0499
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR0500
       REM                                                              FCOR0501
       REM     SETPRI.(PRIOR)                                           FCOR0502
       REM                                                              FCOR0503
SETPRI SAVE    0,S,(SPM)                                                FCOR0504
       REM                                                              FCOR0505
       CAL     P1            PICK UP USER FILE PRIORITY                 FCOR0506
       ANA     =O7           INSURE 3-BIT PRIORITY                      FCOR0507
       SLW     FPRIOR,1      .. SAVE FILE PRIORITY                      FCOR0508
       TRA     RETURN        AND RETURN                                 FCOR0509
       REM                                                              FCOR0510
       EJECT                                                            FCOR0511
       REM                                                              FCOR0512
       REM     OPEN.($STATUS$,$NAME1$,$NAME2$,MODE,DEVICE)              FCOR0513
       REM                                                              FCOR0514
OPEN   SAVE    0,S,(SPM,FN,SP,SP)                                       FCOR0515
       REM                                                              FCOR0516
       GTSTAT  FILNAM,OPN    CHECK IF THIS FILE IS ALREADY ACTIVE       FCOR0517
       ERROR   3             OPEN ERROR (3), FILE ALREADY ACTIVE        FCOR0518
       REM                                                              FCOR0519
OPN    TSX     CKSTAT,4      FIND ROOM IN ACTIVE FILE STATUS TABLE      FCOR0520
       PAR     OPNER4        .. POSSIBLE ERROR RETURN (NO ROOM)         FCOR0521
       PAC     0,2           -BASE OF ENTRY IN A.F.S.T. TO IR2          FCOR0522
       CLA     FILNAM        SET UP FILE NAME IN A.F.S.T.               FCOR0523
       LDQ     FILNAM+1      ..                                         FCOR0524
       DST     RNAME1,2      ..                                         FCOR0525
       CLA     PROBNO,1      SET UP PROBNO-PROGNO AS RPROBN-RPROGN      FCOR0526
       LDQ     PROGNO,1      ..                                         FCOR0527
       DST     RPROBN,2      ..                                         FCOR0528
       REM                                                              FCOR0529
       LDQ     P1            $STATUS$ TO MQ                             FCOR0530
       LDI     =0            SET UP FILE STATUS                         FCOR0531
       AXT     6,4           .. (READ, WRITE OR READ/WRITE)             FCOR0532
OPN1   ZAC                   ..                                         FCOR0533
       LGL     6             ..                                         FCOR0534
       LAS     =H00000R      ..                                         FCOR0535
       TRA     *+2           ..                                         FCOR0536
       SIL     100000        .. SET READ STATUS FOR 'R'                 FCOR0537
       SUB     =H00000W      ..                                         FCOR0538
       TNZ     *+3           ..                                         FCOR0539
       SIL     200000        .. HERE FOR 'W' SET WRITE STATUS           FCOR0540
       TRA     OPN2          .. AND SKIP OUT                            FCOR0541
       TIX     OPN1,4,1      ..                                         FCOR0542
       REM                                                              FCOR0543
OPN2   LFT     300000        DID USER SPECIFY EITHER READ OR WRITE      FCOR0544
       TRA     OPN3          YES, SKIP TO SAVE FILE STATUS (R, W OR RW) FCOR0545
       RELEAS  (RPROBN,2)    NO, REMOVE FILE FROM A.F.S.T.              FCOR0546
       ERROR   5             OPEN ERROR(5), ILLEGAL STATUS              FCOR0547
       REM                                                              FCOR0548
OPN3   STI     STATUS        SAVE FILE STATUS                           FCOR0549
       SEARCH  UFD,FILNAM,OPN4  TRY TO FIND FILE IN UFD FILE            FCOR0550
       TSX     CKLINK,4      CHECK FOR 'LINKED' FILE                    FCOR0551
       PAR     OPN4.1,,OPNER7 .. LINK NOT FOUND RETURN                  FCOR0552
       TSX     CHKACT,4      CHECK IF THIS FILE ALREADY ACTIVE          FCOR0553
       PAR     OPNER3        .. ERROR IF THIS FILE ALREADY ACTIVE       FCOR0554
       REM                                                              FCOR0555
       LDI     URCODE,1      FILE FOUND, GET USER RESTRICTION CODE      FCOR0556
       LFT     000030        IS USER PRIVELEGED COMMAND OR DAEMON       FCOR0557
       TRA     OPN3.3        YES, IGNORE ALL MODE CHECKS                FCOR0558
       LDI     MODE,2        NO, PICK UP FILE MODE                      FCOR0559
       LNT     400000        IS THIS FILE CURRENTLY BEING LOADED        FCOR0560
       TRA     OPN3A         NO, SKIP                                   FCOR0561
       RELEAS  (RPROBN,2)    YES, REMOVE FILE FROM ACTIVE STATUS        FCOR0562
       ERROR   16            OPEN ERROR(16), FILE BEING LOADED          FCOR0563
       REM                                                              FCOR0564
OPN3A  LNT     004000        HAS FILE BEEN 'REMOVED'                    FCOR0565
       TRA     OPN3B         NO, SKIP THIS SECTION                      FCOR0566
       RELEAS  (RPROBN,2)    REMOVE FROM ACTIVE STATUS                  FCOR0567
       ERROR   20            OPEN ERROR(20), FILE HAS BEEN 'REMOVED'    FCOR0568
       REM                                                              FCOR0569
OPN3B  SYN     *             ..                                         FCOR0570
       REM                                                              FCOR0571
*      LNT     100000        TEST IF FILE IS TO BE 'TRAPPED'            FCOR0572
*      TRA     OPN3C         NO, CONTINUE                               FCOR0573
*      HTR     *             ADD NECESSARY CODE HERE                    FCOR0574
       REM                                                              FCOR0575
*OPN3C SYN     *             ..                                         FCOR0576
       REM                                                              FCOR0577
       LDI     RMODE,2       RELOAD FILE MODE                           FCOR0578
       LNT     040000        IS FILE IN PRIVATE MODE                    FCOR0579
       TRA     OPN3.1        NO, SKIP                                   FCOR0580
       LDI     URCODE,1      YES, GET USER RESTRICTION CODE             FCOR0581
       RFT     10            IS USER ALLOWED TO READ PRIVATE FILES      FCOR0582
       TRA     OPN3.1        YES, SKIP                                  FCOR0583
       CAL     AUTHOR,2      NO, GET AUTHOR                             FCOR0584
       ANA     =O777777      ..                                         FCOR0585
       SUB     AUTHNO,1      IS THIS USER THE 'AUTHOR' OF THIS FILE     FCOR0586
       TZE     OPN3.1        YES, SKIP TO OPEN THIS FILE                FCOR0587
       RELEAS  (RPROBN,2)    NO, REMOVE FILE FROM ACTIVE FILE TABLE     FCOR0588
       ERROR   8             USER MAY NOT READ FILE ERROR(8)            FCOR0589
       REM                                                              FCOR0590
OPN3.1 LDI     RMODE,2       IS FILE IN READ-ONLY MODE                  FCOR0591
       LNT     010000        ..                                         FCOR0592
       TRA     OPN3.2        NO, SKIP                                   FCOR0593
       LDI     STATUS        YES, IS USER TRYING TO WRITE THIS FILE     FCOR0594
       LNT     200000        ..                                         FCOR0595
       TRA     OPN3.2        NO, SKIP                                   FCOR0596
       RELEAS  (RPROBN,2)    YES, REMOVE FILE FROM ACTIVE FILE TABLE    FCOR0597
       ERROR   9             OPEN ERROR(9), CANNOT WRITE READ-ONLY FILE FCOR0598
       REM                                                              FCOR0599
OPN3.2 LDI     RMODE,2       IS FILE IN WRITE-ONLY MODE                 FCOR0600
       LNT     020000        ..                                         FCOR0601
       TRA     OPN3.3        NO, SKIP                                   FCOR0602
       LDI     STATUS        YES, IS USER TRYING TO READ THIS FILE      FCOR0603
       LNT     100000        ..                                         FCOR0604
       TRA     OPN3.3        NO, SKIP                                   FCOR0605
       RELEAS  (RPROBN,2)    YES, REMOVE FILE FROM ACTIVE FILE TABLE    FCOR0606
       ERROR   10            OPEN ERROR(10), CANNOT READ WRITE-ONLY FILEFCOR0607
       REM                                                              FCOR0608
OPN3.3 LDI     ILOCK,2       IS THIS FILE CURRENTLY INTERLOCKED         FCOR0609
       LNT     001000        ..                                         FCOR0610
       TRA     OPN3.4        NO, SKIP                                   FCOR0611
OPNBSY RELEAS  (RPROBN,2)    YES, REMOVE FILE FROM A.F.S.T.             FCOR0612
       TSX     LOCK,4        TELL SUPERVISOR OF INTERLOCKED FILE        FCOR0613
       EXIT    IR4,ILC       AND RETURN TO USER AT 0,4                  FCOR0614
       REM                                                              FCOR0615
OPN3.4 LDI     STATUS        SET FILE STATUS IN ACTIVE TABLE            FCOR0616
       CAL     RWSTAT,2      ..                                         FCOR0617
       OAI                   ..                                         FCOR0618
       STI     RWSTAT,2      ..                                         FCOR0619
       LNT     200000        DOES THIS USER INTEND TO MODIFY THIS FILE  FCOR0620
       TRA     OPN3.5        NO, SKIP                                   FCOR0621
       LDI     ILOCK,2       YES, IS ANYONE CURRENTLY READING THIS FILE FCOR0622
       LFT     000777        ..                                         FCOR0623
       TRA     OPNBSY        YES, THIS USER WILL HAVE TO WAIT           FCOR0624
       SIL     001000        NO, INTERLOCK THIS FILE                    FCOR0625
       STI     ILOCK,2       .. AND LET THIS USER MODIFY IT             FCOR0626
       TSX     REFMFD,4      BUT LETS FIRST MAKE SURE                   FCOR0627
       EFA     FPROBN,2      THAT IT ISN'T IN M.F.D.                    FCOR0628
       ZET     FS.TST        SEE IF HE IS ALLOWED                       FCOR0629
       TRA     OPN3.6        OK, IF YOU SAY SO                          FCOR0630
       TRA     OPNR18        NASTY, NASTY                               FCOR0631
       REM                                                              FCOR0632
OPN3.5 LDI     MODE,2        HERE IF USER ONLY INTENDS TO READ FILE     FCOR0633
       LNT     002000        IS FILE IN TEMPORARY MODE                  FCOR0634
       TRA     OPN35A        NO, SKIP                                   FCOR0635
       LDI     ILOCK,2       YES, PICK UP INTERLOCK FLAGS               FCOR0636
       LFT     000777        IS ANYONE ELSE USING THIS FILE             FCOR0637
       TRA     OPNBSY        ONLY ONE USER AT A TIME ON TEMP. FILE      FCOR0638
       REM                                                              FCOR0639
OPN35A CAL     ILOCK,2       INCREASE NO. OF USERS READING THIS FILE    FCOR0640
       ACL     =1B17         ..                                         FCOR0641
       SLW     ILOCK,2       ..                                         FCOR0642
       TSX     REFMFD,4      NEW RULES, IF FS.TST IS SET                FCOR0643
       EFA     FPROBN,2      AND READ IS FROM MFD                       FCOR0644
       ZET     FS.TST        LET UPDFIL GO THROUGH                      FCOR0645
OPN3.6 UPDFIL  UFD,(FNAME1,2),OPNMER  UPDATE FILE ENTRY IN UFD          FCOR0646
       TRA     OPN5          SKIP TO CALL STRATEGY MODULE               FCOR0647
       REM                                                              FCOR0648
OPNMER RELEAS  (RPROBN,2)    HERE IF FILE NOT FOUND ON UPDFIL           FCOR0649
       ERROR   11            OPEN ERROR(11), MACHINE ERROR              FCOR0650
       REM                                                              FCOR0651
OPN4   CLA     RPROBN,2      HERE IF FILE DOES NOT YET EXIST            FCOR0652
       LDQ     RPROGN,2      ..                                         FCOR0653
       DST     FPROBN,2      .. TRY TO CREATE NEW FILE ENTRY            FCOR0654
       CLA     RNAME1,2      .. FILE NAME(1)                            FCOR0655
       LDQ     RNAME2,2      ..                                         FCOR0656
       DST     FNAME1,2      ..                                         FCOR0657
       STZ     RMODE,2       SET MODE TO 0                              FCOR0658
       CHKUFD  (FPROBN,2),OPER19 CHECK FOR AVAILABLE U.F.D.             FCOR0659
       TRA     OPN4.A                                                   FCOR0660
       REM                                                              FCOR0661
OPN4.1 CLA     LPROBN,2      HERE IF 'LINKED' FILE DOES NOT EXIST       FCOR0662
       LDQ     LPROGN,2      ..                                         FCOR0663
       DST     FPROBN,2      .. TRY TO CREATE NEW FILE ENTRY            FCOR0664
       CLA     LNAME1,2      .. FILE NAME(1)                            FCOR0665
       LDQ     LNAME2,2      .. (2)                                     FCOR0666
       DST     FNAME1,2      ..                                         FCOR0667
       REM                                                              FCOR0668
       LDI     URCODE,1      GET USER RESTRICTION CODE                  FCOR0669
       LFT     30            IGNORE MODE CHECKS FOR DAEMON              FCOR0670
       TRA     OPN4.A        .. OR PRIVILEGED COMMAND                   FCOR0671
       LDI     RMODE,2       PICK UP MODE OF LINK                       FCOR0672
       LNT     010000        IS FILE READ-ONLY TO THIS USER             FCOR0673
       TRA     OPN41A        .. NO, SKIP                                FCOR0674
       LDI     STATUS        .. YES, IS USER TRYING TO WRITE THIS FILE  FCOR0675
       LNT     200000        ..                                         FCOR0676
       TRA     OPN41A        .. NO, SKIP                                FCOR0677
       RELEAS  (RPROBN,2)    .. YES, REMOVE FILE FROM A.F.S.T.          FCOR0678
       ERROR   9             .. OPEN ERROR(9), ATTEMPT TO WRITE R/O FILEFCOR0679
       REM                                                              FCOR0680
OPN41A LDI     RMODE,2       RELOAD EFFECTIVE FILE MODE                 FCOR0681
       LNT     020000        IS FILE WRITE-ONLY TO THIS USER            FCOR0682
       TRA     OPN4.A        .. NO, SKIP                                FCOR0683
       LDI     STATUS        .. YES, IS USER TRYING TO READ FILE        FCOR0684
       LNT     100000        ..                                         FCOR0685
       TRA     OPN4.A        .. NO, SKIP                                FCOR0686
       RELEAS  (RPROBN,2)    .. YES, REMOVE FILE FROM A.F.S.T.          FCOR0687
       ERROR   10            .. OPEN ERROR(10), CANNOT READ WRITE-ONLY FFCOR0688
       REM                                                              FCOR0689
OPN4.A LDI     STATUS        PICK UP FILE ACTIVE STATUS (RW BITS)       FCOR0690
       LFT     200000        IS THIS FILE TO BE WRITTEN                 FCOR0691
       TRA     OPN4.B        YES, SKIP TO SET UP NEW FILE               FCOR0692
       RELEAS  (RPROBN,2)    NO, REMOVE ENTRY FROM A.F.S.T.             FCOR0693
       ERROR   12            OPEN ERROR(12), FILE NOT FOUND             FCOR0694
       REM                                                              FCOR0695
OPN4.B TSX     REFMFD,4      SEE IF USER ATTACHED TO 'M.F.D. (FILE)'    FCOR0696
       EFA     FPROBN,2      ..                                         FCOR0697
       ZET     FS.TST        CHECK SWITCH                               FCOR0698
       TRA     OPN4.C        IT'S ALRIGHT ANYWAY                        FCOR0699
OPNR18 RELEAS  (RPROBN,2)    USER TRIED TO WRITE FILE IN MFD            FCOR0700
       ERROR   18            OPEN ERROR(18), ILLEGAL USE OF MFD         FCOR0701
       REM                                                              FCOR0702
OPN4.C TSX     GTDYTM,4      .. SET UP DATE AND TIME FILE CREATED       FCOR0703
       SLW     DAYTIM,2      ..                                         FCOR0704
       ANA     =O777777000000  .. GET DATE ALONE                        FCOR0705
       ORA     AUTHNO,1      .. + AUTHOR OF FILE                        FCOR0706
       SLW     DATELU,2      ..                                         FCOR0707
       LDI     M.IL.F        .. SET UP MODE,ILOCK,F,RCOUNT              FCOR0708
       SIL     001000        .. INTERLOCK THIS FILE WHILE WRITING       FCOR0709
       STI     MODE,2        ..                                         FCOR0710
       CAL     STATUS        .. SET UP RWSTAT,NORECS,P,LCOUNT           FCOR0711
       ORA     TGPMAX        .. PMAX IN TAG                             FCOR0712
       SLW     RWSTAT,2      ..                                         FCOR0713
       REM                                                              FCOR0714
       CLA     P4            MODE OF FILE IF SPECIFIED                  FCOR0715
       TMI     OPN4.2        SKIP IF NOT SPECIFIED                      FCOR0716
       ALS     28            SAVE AS HIGH ORDER 8 BITS                  FCOR0717
       ORS     MODE,2        ..                                         FCOR0718
       REM                                                              FCOR0719
OPN4.2 CAL     MODE,2        SET UP RMODE TO BE THE SAME AS MODE        FCOR0720
       ANA     =O776000000000 MASK ALL BUT MODE BITS                    FCOR0721
       ORS     RMODE,2       ..                                         FCOR0722
       CLA     P5            DID USER SPECIFY A DEVICE                  FCOR0723
       TMI     OPN4.3        NO, SKIP                                   FCOR0724
       PAX     0,5           YES, DEVICE TO IR5                         FCOR0725
       ALS     15            DEVICE NUMBER TO AC TAG                    FCOR0726
       STT     F,2           SAVE IT IN ACTIVE FILE STATUS TABLE        FCOR0727
       TXL     *+2,5,0       ERROR IF DEVICE .E. 0                      FCOR0728
       TXL     OPN4.3,5,FMAX OK IF DEVICE .E. 1-FMAX                    FCOR0729
       RELEAS  (RPROBN,2)    HERE FOR ILLEGAL DEVICE SPECIFICATION      FCOR0730
       ERROR   13            OPEN ERROR(13), ILLEGAL DEVICE             FCOR0731
       REM                                                              FCOR0732
OPN4.3 LXTC    (F,2),3       -DEVICE TO IR3                             FCOR0733
       GETQU   (FPROBN,2)    GET QUOTA FOR THIS DEVICE                  FCOR0734
       PAX     0,4           .. INTO IR4                                FCOR0735
       TXH     OPN4.4,4,0    SKIP IF USER ALLOTTED SPACE ON THIS DEVICE FCOR0736
       RELEAS  (RPROBN,2)    HERE IF NO SPACE, CLEAR THIS ENTRY         FCOR0737
       ERROR   14            OPEN ERROR(14), NO SPACE ALLOTTED          FCOR0738
       REM                                                              FCOR0739
OPN4.4 ADDFIL  UFD,OPNMER    ADD NEW FILE TO USER FILE DIRECTORY        FCOR0740
       REM                                                              FCOR0741
OPN5   LDI     MODE,2        RELOAD FILE MODE                           FCOR0742
       LFT     002000        IS FILE IN TEMPORARY MODE                  FCOR0743
       TRA     OPN5.1        YES, SKIP TO OPEN FILE                     FCOR0744
       LDI     RWSTAT,2      NO, CHECK FILE ACTIVE STATUS               FCOR0745
       LNT     200000        IS FILE OPEN FOR WRITING                   FCOR0746
       TRA     OPN5.1        NO, SKIP                                   FCOR0747
       CAL     NORECS,2      WAS ENTRY CREATED BY 'TAPFIL'              FCOR0748
       PDX     ,5            TEST RECORD LENGTH                         FCOR0749
       TXL     *+3,5,-2      IF = 32767, CAME FROM 'TAPFIL'             FCOR0750
       PXD     ,0            CLEAR AC                                   FCOR0751
       STD     NORECS,2      MUST HAVE NORECS 0 SO 'BUCM' WON'T SCREAM  FCOR0752
       LDI     URCODE,1      PICK UP USER RESTRICTION CODE              FCOR0753
       LFT     30            IGNORE RECORD QUOTA FOR DAEMON/PRIV. COMD. FCOR0754
       TRA     OPN5.1        ..                                         FCOR0755
       LXTC    (F,2),3       GET RECORD QUOTA,,USED FOR THIS DEVICE     FCOR0756
       GETQU   (FPROBN,2)    ..                                         FCOR0757
       TSX     ADDREC,4      CHECK FOR RECORD QUOTA OVERFLOW            FCOR0758
       PAR     =0            ..                                         FCOR0759
       PAR     OPER15        ..                                         FCOR0760
OPN5.1 CAL     FPRIOR,1      SET UP USER FILE PRIORITY                  FCOR0761
       TNZ     *+2           .. SKIP IF USER HAS SET A FILE PRIORITY    FCOR0762
       CAL     =1            .. OTHERWISE FORCE FILE PRIORITY OF '1'    FCOR0763
       SLW     TEMP          SAVE PRIORITY ASSIGNED TO THIS FILE        FCOR0764
       TSX     BOPEN,4       TELL BUFFER CONTROL MODULE OF OPEN FILE    FCOR0765
       EFA     0,2           ..                                         FCOR0766
       PAR     TEMP,,OPNERR  ..                                         FCOR0767
       TRA     RETURN        AND RETURN TO USER                         FCOR0768
       REM                                                              FCOR0769
OPNER3 RELEAS  (RPROBN,2)    OPEN ERROR(3), FILE ALREADY ACTIVE         FCOR0770
       ERROR   3             ..                                         FCOR0771
       REM                                                              FCOR0772
OPNER4 ERROR   4             OPEN ERROR(4), NO ROOM IN A.F.S.T.         FCOR0773
       REM                                                              FCOR0774
OPER15 RTNFIL  OPNMER        RECORD QUOTA OVERFLOW, REMOVE ACTIVE FILE  FCOR0775
       ERROR   15            OPEN ERROR(15), RECORD QUOTA OVERFLOW      FCOR0776
       REM                                                              FCOR0777
OPNERR RTNFIL  OPNMER        HERE FOR INPUT OR OUTPUT ERROR             FCOR0778
       IOERR   17            OPEN ERROR(17), I/O ERROR                  FCOR0779
       REM                                                              FCOR0780
OPNER7 RELEAS  (RPROBN,2)    LINKAGE DEPTH EXCEEDED                     FCOR0781
       ERROR   7             OPEN ERROR(7), TOO MANY LINKS              FCOR0782
       REM                                                              FCOR0783
OPER19 RELEAS  (RPROBN,2)    REMOVE ACTIVE FILE                         FCOR0784
       ERROR   19            OPEN ERROR(19), U.F.D. NOT FOUND           FCOR0785
       EJECT                                                            FCOR0786
       REM                                                              FCOR0787
       REM     BUFFER.($NAME1$,$NAME2$,BUFFER(RCOUNT)...RCOUNT)         FCOR0788
       REM                                                              FCOR0789
BUFFER SAVE    0,N,(FN,BARY)                                            FCOR0790
       REM                                                              FCOR0791
       GTSTAT  FILNAM,ASNER3 FIND ACTIVE FILE STATUS                    FCOR0792
       PAC     0,2           -BASE OF THIS ENTRY TO IR2                 FCOR0793
       REM                                                              FCOR0794
ASN1   CAL     BUFADR,2      PICK UP OLD BUFFER ADDRESS IF ANY          FCOR0795
       ANA     =O77777       ..                                         FCOR0796
       TZE     ASN2          SKIP IF NO PREVIOUSLY ASSIGNED BUFFER      FCOR0797
       TSX     BSAVE,4       OTHERWISE, NORMALIZE ACTIVE FILE STATUS    FCOR0798
       EFA     0,2           ..                                         FCOR0799
       PAR     MEM,,BUF      ..                                         FCOR0800
       PAR     ASIOER,,QWAIT ..                                         FCOR0801
       PAR     ASNER4        ..                                         FCOR0802
ASN2   TSX     BASIGN,4      TELL B.C.M. OF NEW BUFFER                  FCOR0803
       EFA     0,2           ..                                         FCOR0804
       PAR     P3,,ASNER5    ..                                         FCOR0805
       TRA     RETURN        RETURN TO USER                             FCOR0806
       REM                                                              FCOR0807
ASIOER IOERR   6             BUFFER ERROR(6), INPUT/OUTPUT ERROR        FCOR0808
       REM                                                              FCOR0809
ASNER3 ERROR   3             BUFFER ERROR(3), NOT AN ACTIVE FILE        FCOR0810
       REM                                                              FCOR0811
ASNER4 ERROR   4             BUFFER ERROR(4), PREVIOUS I/O OUT OF BOUNDSFCOR0812
       REM                                                              FCOR0813
ASNER5 ERROR   5             BUFFER ERROR(5), NEW BUFFER TOO SMALL      FCOR0814
       REM                                                              FCOR0815
       EJECT                                                            FCOR0816
       REM                                                              FCOR0817
       REM     RDFILE.($NAME1$,$NAME2$,RELLOC,A(N)...N,EOF,EOFCT)       FCOR0818
       REM                                                              FCOR0819
RDFILE SAVE    0,N,(FN,SPM,MARY,ADR,ADR)                                FCOR0820
       REM                                                              FCOR0821
       STZ     WAITSW        SET SWITCH FOR NO WAITING                  FCOR0822
       TRA     READ1         AND GO TO COMMON READ SECTION              FCOR0823
       REM                                                              FCOR0824
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR0825
       REM                                                              FCOR0826
       REM     RDWAIT.($NAME1$,$NAME2$,RELLOC,A(N)...N,EOF,EOFCT)       FCOR0827
       REM                                                              FCOR0828
RDWAIT SAVE    0,N,(FN,SPM,MARY,ADR,ADR)                                FCOR0829
       REM                                                              FCOR0830
       STL     WAITSW        SET SWITCH TO WAIT UNTIL I/O DONE          FCOR0831
       REM                                                              FCOR0832
READ1  GTSTAT  FILNAM,RDFER3 PICK UP ACTIVE FILE STATUS                 FCOR0833
       PAC     0,2           -BASE OF THIS ENTRY TO IR2                 FCOR0834
       LDI     RWSTAT,2      GET READ-WRITE STATUS OF FILE              FCOR0835
       LNT     100000        IS FILE IN READ STATUS                     FCOR0836
       TRA     RDFER4        NO, ERROR                                  FCOR0837
       TSX     REFMFD,4      SEE IF EFFECTIVE DIRECTORY IS MFD          FCOR0838
       EFA     FPROBN,2      ..                                         FCOR0839
       ZET     FS.TST        IF SUPER-PRIVILEGED USER ON MFD,           FCOR0840
       TRA     *+2           OR ORDINARY USER ON ORD. FILE              FCOR0841
       TRA     RDFMFD        .. SKIP FOR READ OUT OF MFD                FCOR0842
       TSX     BREAD,4       CALL BCM TO EXECUTE FILE READ REQUEST      FCOR0843
       EFA     0,2           ..                                         FCOR0844
       PAR     MEM,,BUF      ..                                         FCOR0845
       PAR     P3,,RDEOF1    ..                                         FCOR0846
       PAR     P4,,QWAIT     ..                                         FCOR0847
       PAR     RDIOER,,RDFER6  ..                                       FCOR0848
       PAR     RDFER5        ..                                         FCOR0849
       TRA     RDF2          SKIP TO RETURN SECTION                     FCOR0850
       REM                                                              FCOR0851
RDEOF1 TSX     SETEOF,4      SET UP EOF RETURN ON EOF                   FCOR0852
RDF2   NZT     WAITSW        WAS THIS CALL TO 'RDWAIT'                  FCOR0853
       TRA     RETURN        NO, RETURN TO USER                         FCOR0854
RDF3   TSX     BCHECK,4      YES, WAIT UNTIL I/O COMPLETE               FCOR0855
       EFA     0,2           ..                                         FCOR0856
       PAR     MEM,,BUF      ..                                         FCOR0857
       PAR     RDIOER,,RETURN  ..                                       FCOR0858
       PAR     RDFER6        ..                                         FCOR0859
       TRA     RDF3          LOOP UNTIL I/O IS COMPLETED                FCOR0860
       REM                                                              FCOR0861
       EJECT                                                            FCOR0862
       REM                                                              FCOR0863
       REM     RDFMFD ..... SPECIAL READ SECTION FOR FILE FROM MFD      FCOR0864
       REM                                                              FCOR0865
RDFMFD REWRIT  (FNAME1,2),RDFER8  REWRITE THIS FILE DIRECTORY           FCOR0866
       SEARCH  MFD,(FNAME1,2),RDFER8  GET FRESH COPY OF UFD             FCOR0867
       LDI     RWSTAT,2      SET NEW COPY OF FILE IN READ STATUS        FCOR0868
       SIL     100000        ..                                         FCOR0869
       STI     RWSTAT,2      ..                                         FCOR0870
       TSX     BREAD,4       CALL BCM TO EXECUTE FILE READ REQUEST      FCOR0871
       EFA     0,2           ..                                         FCOR0872
       PAR     MEM,,BUF      ..                                         FCOR0873
       PAR     P3,,RDEOF2    ..                                         FCOR0874
       PAR     P4,,*-4       ..                                         FCOR0875
       PAR     RDIOER,,RDFER6  ..                                       FCOR0876
       PAR     RDFER5        ..                                         FCOR0877
       AXC     RETURN,3      SET FOR NORMAL RETURN                      FCOR0878
       TRA     RDFM1         SKIP ON NORMAL RETURN, (NO EOF)            FCOR0879
       REM                                                              FCOR0880
RDEOF2 TSX     SETEOF,4      SET UP EOF RETURN ON EOF                   FCOR0881
RDFM1  CAL     IOTASK,2      WAIT UNTIL ALL I/O IS COMPLETED            FCOR0882
       PDX     0,5           ..                                         FCOR0883
       TXH     RDFM1,5,0     .. LOOP UNTIL I/O FINISHED                 FCOR0884
       TRA     RDF2          GO TO MAIN READ SECTION FOR RETURN         FCOR0885
       REM                                                              FCOR0886
RDFER3 ERROR   3             RDFILE ERROR(3), NOT AN ACTIVE FILE        FCOR0887
       REM                                                              FCOR0888
RDFER4 ERROR   4             RDFILE ERROR(4), FILE NOT IN READ STATUS   FCOR0889
       REM                                                              FCOR0890
RDFER5 ERROR   5             RDFILE ERROR(5), NO BUFFER ASSIGNED        FCOR0891
       REM                                                              FCOR0892
RDFER6 ERROR   6             RDFILE ERROR(6), I/O REQUEST OUT OF BOUNDS FCOR0893
       REM                                                              FCOR0894
RDIOER IOERR   7             RDFILE ERROR(7), INPUT/OUTPUT ERROR        FCOR0895
       REM                                                              FCOR0896
RDFER8 ERROR   8             RDFILE ERROR(8), UFD HAS BEEN DELETED      FCOR0897
       REM                                                              FCOR0898
       EJECT                                                            FCOR0899
       REM                                                              FCOR0900
       REM     WRFILE.($NAME1$,$NAME2$,RELLOC,A(N)...N,EOF,EOFCT)       FCOR0901
       REM                                                              FCOR0902
WRFILE SAVE    0,N,(FN,SPM,MARY,ADR,ADR)                                FCOR0903
       REM                                                              FCOR0904
       STZ     WAITSW        SET SWITCH FOR NO WAITING                  FCOR0905
       TRA     WRITE1        AND GO TO COMMON WRITE SECTION             FCOR0906
       REM                                                              FCOR0907
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR0908
       REM                                                              FCOR0909
       REM     WRWAIT.($NAME1$,$NAME2$,RELLOC,A(N)...N,EOF,EOFCT)       FCOR0910
       REM                                                              FCOR0911
WRWAIT SAVE    0,N,(FN,SPM,MARY,ADR,ADR)                                FCOR0912
       REM                                                              FCOR0913
       STL     WAITSW        SET SWITCH TO WAIT UNTIL I/O DONE          FCOR0914
       REM                                                              FCOR0915
WRITE1 GTSTAT  FILNAM,WRFER3 PICK UP ACTIVE FILE STATUS                 FCOR0916
       PAC     0,2           -BASE OF THIS ENTRY TO IR2                 FCOR0917
       LDI     RWSTAT,2      GET READ-WRITE STATUS OF FILE              FCOR0918
       LNT     200000        IS FILE IN WRITE STATUS                    FCOR0919
       TRA     WRFER4        NO, ERROR                                  FCOR0920
       LDI     URCODE,1      YES, PICK UP USER RESTRICTION CODE         FCOR0921
       LFT     000030        IS USER PRIVELEGED COMMAND OR DAEMON       FCOR0922
       TRA     WRFA          YES, IGNORE QUOTA, CHECK ON WRITE-ONLY     FCOR0923
       NZT     P3            NO, DID USER SPECIFY A RELATIVE ADDRESS    FCOR0924
       TRA     WRFA          NO, SKIP                                   FCOR0925
       LDI     RMODE,2       YES, PICK UP RMODE                         FCOR0926
       LFT     020000        IS FILE IN WRITE ONLY MODE TO THIS USER    FCOR0927
       TRA     WRFER9        IF SO, ERROR                               FCOR0928
WRFA   CAL     NORECS,2      PICK UP NO. OF RECORDS TO THIS FILE        FCOR0929
       PDX     0,5           .. INTO IR5                                FCOR0930
       TXH     WFER10,5,-RGRACE  ERROR IF NORECS.G.32767-RGRACE         FCOR0931
       LXTC    (F,2),3       -F TO IR3                                  FCOR0932
       GETQU   (FPROBN,2)    GET RECORD QUOTA FOR THIS DEVICE           FCOR0933
       SLW     SAVEQU        .. SAVE IT                                 FCOR0934
       LDI     URCODE,1      RELOAD USER RESTRICTION CODE               FCOR0935
       LFT     30            IS USER DAEMON OR PRIV. COMMAND            FCOR0936
       TRA     WRF1          YES, IGNORE RECORD QUOTA                   FCOR0937
       LDI     MODE,2        CHECK MODE OF FILE                         FCOR0938
       LFT     002000        CHECK FOR 'T' MODE                         FCOR0939
       TRA     WRF6          IF 'T', NOT LONGER THAN QUOTA              FCOR0940
       TSX     SUBREC,4      CHECK FOR USED.G.ALLOT+EXTEND              FCOR0941
       PAR     EXTEND        ..                                         FCOR0942
       PAR     WRFER6        .. ERROR RETURN, EXTENSION EXHAUSTED       FCOR0943
       TRA     WRF1                                                     FCOR0944
       REM                                                              FCOR0945
WRF6   CAL     NORECS,2      'T', GET NO. OF RECORDS IN THIS FILE       FCOR0946
       ANA     =O77777000000 ..                                         FCOR0947
       ARS     2             DIVIDE BY 4                                FCOR0948
       PDX     ,7            AND PLACE IN XR7                           FCOR0949
       TIX     *+2,7,RGRACE/4 IF .G. RGRACE/4, THEN DECREASE            FCOR0950
       AXT     0,7           OTHERWISE, MAKE IT ZERO                    FCOR0951
       SXD     SAVEQU,7      PLACE IN DECREMENT WITH RECORD QUOTA       FCOR0952
       CAL     SAVEQU        RESTORE USER RECORD QUOTA                  FCOR0953
       TSX     ADDREC,4      INSURE TEMP FILE LENGTH .L. 4*QUOTA+RGRACE FCOR0954
       PAR     =0            ..                                         FCOR0955
       PAR     WRFER6        .. IF SO, ERROR                            FCOR0956
WRF1   CAL     NORECS,2      SAVE NO. OF RECORDS USED FOR THIS FILE     FCOR0957
       PDX     0,5           .. NORECS TO ADDRESS OF AC                 FCOR0958
       PXA     0,5           ..                                         FCOR0959
       SLW     TEMP          SAVE RECORDS USED FOR THIS FILE            FCOR0960
       TSX     BWRITE,4      CALL B.C.M. TO EXECUTE WRITE REQUEST       FCOR0961
       EFA     0,2           ..                                         FCOR0962
       PAR     MEM,,BUF      ..                                         FCOR0963
       PAR     P3,,WREOF     ..                                         FCOR0964
       PAR     P4,,QWAIT     ..                                         FCOR0965
       PAR     WRIOER,,WRFER7  ..                                       FCOR0966
       PAR     WRFER5        ..                                         FCOR0967
       LDI     MODE,2        RELOAD FILE MODE                           FCOR0968
       LFT     002000        IS IT TEMPORARY                            FCOR0969
       TRA     WRF2          YES, SKIP                                  FCOR0970
       CAL     NORECS,2      NO, PICK UP NO. OF RECORDS IN THIS FILE    FCOR0971
       PDX     0,5           .. NORECS TO ADDRESS OF AC                 FCOR0972
       PXA     0,5           ..                                         FCOR0973
       SUB     TEMP          CHECK IF FILE INCREASED IN LENGTH          FCOR0974
       TZE     WRF2          SKIP IF NO CHANGE IN FILE LENGTH           FCOR0975
       STO     TEMP          OTHERWISE SAVE DIFFERENCE                  FCOR0976
       CAL     SAVEQU        NO, RESTORE USER QUOTA,,USED               FCOR0977
       TSX     ADDREC,4      AND UPDATE USER RECORD COUNT               FCOR0978
       PAR     TEMP          .. WITH NO. OF RECORDS ADDED TO FILE       FCOR0979
       PAR     *+1           .. IGNORE ERROR RETURN                     FCOR0980
       SETQU   (FPROBN,2)    REPLACE RECORD QUOTA,,USED IN UFD          FCOR0981
       TRA     WRF2          SKIP TO CHECK WAITSW                       FCOR0982
       REM                                                              FCOR0983
WREOF  TSX     SETEOF,4      SET UP EOF RETURN ON EOF                   FCOR0984
WRF2   NZT     WAITSW        WAS THIS CALL TO 'WRWAIT'                  FCOR0985
       TRA     WRF4          NO, SKIP                                   FCOR0986
WRF3   TSX     BCHECK,4      YES, WAIT UNTIL I/O COMPLETED              FCOR0987
       EFA     0,2           ..                                         FCOR0988
       PAR     MEM,,BUF      ..                                         FCOR0989
       PAR     WRIOER,,WRF4  ..                                         FCOR0990
       PAR     WRFER7        ..                                         FCOR0991
       TRA     WRF3          LOOP UNTIL I/O IS COMPLETED                FCOR0992
       REM                                                              FCOR0993
WRF4   LDI     RMODE,2       RELOAD FILE MODE                           FCOR0994
       LNT     020000        IS FILE 'APPEND-ONLY'                      FCOR0995
       TRA     RETURN        NO, RETURN                                 FCOR0996
WRF5   TSX     BSAVE,4       YES, INSURE ALL I/O IS COMPLETED           FCOR0997
       EFA     0,2           ..                                         FCOR0998
       PAR     MEM,,BUF      ..                                         FCOR0999
       PAR     WRIOER,,WRF5  ..                                         FCOR1000
       PAR     WRFER7        ..                                         FCOR1001
       TRA     RETURN        RETURN TO USER                             FCOR1002
       REM                                                              FCOR1003
WRIOER IOERR   8             WRFILE ERROR(8), INPUT/OUTPUT ERROR        FCOR1004
       REM                                                              FCOR1005
WRFER3 ERROR   3             WRFILE ERROR(3), NOT AN ACTIVE FILE        FCOR1006
       REM                                                              FCOR1007
WRFER4 ERROR   4             WRFILE ERROR(4), FILE NOT IN WRITE STATUS  FCOR1008
       REM                                                              FCOR1009
WRFER5 ERROR   5             WRFILE ERROR(5), NO BUFFER ASSIGNED        FCOR1010
       REM                                                              FCOR1011
WRFER6 ERROR   6             WRFILE ERROR(6), RECORD QUOTA EXHAUSTED    FCOR1012
       REM                                                              FCOR1013
WRFER7 ERROR   7             WRFILE ERROR(7), I/O REQUEST OUT OF BOUNDS FCOR1014
       REM                                                              FCOR1015
WRFER9 ERROR   9             WRFILE ERROR(9), ILLEGAL USE OF W-O FILE   FCOR1016
       REM                                                              FCOR1017
WFER10 ERROR   10            WRFILE ERROR(10), MAX. FILE LENGTH EXCEEDEDFCOR1018
       REM                                                              FCOR1019
       EJECT                                                            FCOR1020
       REM                                                              FCOR1021
       REM     TRFILE.($NAME1$,$NAME2$,RELLOC)                          FCOR1022
       REM                                                              FCOR1023
TRFILE SAVE    0,N,(FN,SPM)                                             FCOR1024
       REM                                                              FCOR1025
       GTSTAT  FILNAM,TRFER3 PICK UP ACTIVE FILE STATUS                 FCOR1026
       PAC     0,2           -BASE OF THIS ENTRY TO IR2                 FCOR1027
       LDI     RWSTAT,2      GET READ-WRITE STATUS OF FILE              FCOR1028
       LNT     200000        IS FILE IN WRITE STATUS                    FCOR1029
       TRA     TRFER4        NO, ERROR                                  FCOR1030
       LDI     URCODE,1      PICK UP USER RESTRICTION CODE              FCOR1031
       LFT     30            IS THIS NORMAL USER                        FCOR1032
       TRA     TRF0          IGNORE CHECK ON WRITE-ONLY FOR DAEMON      FCOR1033
       LDI     RMODE,2       YES, PICK MODE FOR THIS USER               FCOR1034
       LFT     020000        IS FILE WRITE-ONLY TO THIS USER            FCOR1035
       TRA     TRFER9        IF SO, ERROR                               FCOR1036
TRF0   CAL     NORECS,2      PICK UP NO. OF RECORDS IN THIS FILE        FCOR1037
       PDX     0,5           .. NORECS TO ADDRESS                       FCOR1038
       PXA     0,5           ..                                         FCOR1039
       SLW     TEMP          ..                                         FCOR1040
       TSX     BTRUNC,4      CALL B.C.M. TO TRUNCATE FILE               FCOR1041
       EFA     0,2           ..                                         FCOR1042
       PAR     MEM,,BUF      ..                                         FCOR1043
       PAR     P3,,TREOF     ..                                         FCOR1044
       PAR     TRIOER,,QWAIT ..                                         FCOR1045
       PAR     TRFER6,,TRFER5  ..                                       FCOR1046
       LDI     MODE,2        GET FILE MODE                              FCOR1047
       LFT     002000        IS FILE IN TEMPORARY MODE                  FCOR1048
       TRA     TRF1          YES, SKIP                                  FCOR1049
       CAL     NORECS,2      NO, PICK UP NEW NO. OF RECORDS IN FILE     FCOR1050
       PDX     0,5           .. NORECS TO ADDRESS                       FCOR1051
       PXA     0,5           ..                                         FCOR1052
       SUB     TEMP          CHECK IF FILE LENGTH CHANGED               FCOR1053
       TZE     TRF1          SKIP IF NORECS IS STILL THE SAME           FCOR1054
       STO     TEMP          OTHERWISE SAVE THE DIFFERENCE              FCOR1055
       LXTC    (F,2),3       -F TO IR3                                  FCOR1056
       GETQU   (FPROBN,2)    GET RECORDS ALLOTTED,,USED                 FCOR1057
       TSX     ADDREC,4      AND REDUCE USER RECORDS USED               FCOR1058
       PAR     TEMP          .. BY NO. OF RECORDS DELETED               FCOR1059
       PAR     *+1           .. IGNORE ERROR RETURN                     FCOR1060
       SETQU   (FPROBN,2)    REPLACE QUOTA,,USED IN UFD                 FCOR1061
TRF1   TRA     RETURN        RETURN TO USER                             FCOR1062
       REM                                                              FCOR1063
TREOF  ERROR   7             TRFILE ERROR(7), RELLOC TOO LARGE FOR FILE FCOR1064
       REM                                                              FCOR1065
TRIOER IOERR   8             TRFILE ERROR(8), INPUT/OUTPUT ERROR        FCOR1066
       REM                                                              FCOR1067
TRFER3 ERROR   3             TRFILE ERROR(3), NOT AN ACTIVE FILE        FCOR1068
       REM                                                              FCOR1069
TRFER4 ERROR   4             TRFILE ERROR(4), FILE NOT IN WRITE STATUS  FCOR1070
       REM                                                              FCOR1071
TRFER5 ERROR   5             TRFILE ERROR(5), NO BUFFER ASSIGNED        FCOR1072
       REM                                                              FCOR1073
TRFER6 ERROR   6             TRFILE ERROR(6), I/O REQUEST OUT OF BOUNDS FCOR1074
       REM                                                              FCOR1075
TRFER9 ERROR   9             TRFILE ERROR(9), ILLEGAL USE OF W-O FILE   FCOR1076
       REM                                                              FCOR1077
       EJECT                                                            FCOR1078
       REM                                                              FCOR1079
       REM     FCHECK.($NAME1$,$NAME2$,FINISH)                          FCOR1080
       REM                                                              FCOR1081
FCHECK SAVE    0,N,(FN,ADR)                                             FCOR1082
       REM                                                              FCOR1083
       GTSTAT  FILNAM,CHKER3 PICK UP ACTIVE FILE STATUS                 FCOR1084
       PAC     0,2           -BASE OF ENTRY TO IR2                      FCOR1085
       TSX     BCHECK,4      CALL B.C.M. TO CHECK IF FILE BUSY          FCOR1086
       EFA     0,2           ..                                         FCOR1087
       PAR     MEM,,BUF      ..                                         FCOR1088
       PAR     CKIOER,,CKFIN ..                                         FCOR1089
       PAR     CHKER4        ..                                         FCOR1090
       TRA     RETURN        RETURN TO USER                             FCOR1091
       REM                                                              FCOR1092
CKFIN  CLA     P3            HERE WHEN I/O FINISHED, GET USER RETURN    FCOR1093
       TMI     RETURN        EXIT IF NO RETURN SPECIFIED                FCOR1094
       STA     RTNILC        OTHERWISE SET UP 'FINISH' RETURN TO USER   FCOR1095
       TRA     RETURN        AND RETURN                                 FCOR1096
       REM                                                              FCOR1097
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR1098
       REM                                                              FCOR1099
       REM     FWAIT.($NAME1$,$NAME2$)                                  FCOR1100
       REM                                                              FCOR1101
FWAIT  SAVE    0,N,(FN)                                                 FCOR1102
       REM                                                              FCOR1103
       GTSTAT  FILNAM,CHKER3 PICK UP ACTIVE FILE STATUS                 FCOR1104
       PAC     0,2           -BASE OF ENTRY TO IR2                      FCOR1105
FWAT1  TSX     BCHECK,4      CALL B.C.M. TO WAIT UNTIL I/O FINISHED     FCOR1106
       EFA     0,2           ..                                         FCOR1107
       PAR     MEM,,BUF      ..                                         FCOR1108
       PAR     CKIOER,,FWAT2 ..                                         FCOR1109
       PAR     CHKER4        ..                                         FCOR1110
       TRA     QWAIT         LET USER LOOP ON HIS OWN TIME              FCOR1111
       REM                                                              FCOR1112
FWAT2  TRA     RETURN        RETURN WHEN I/O DONE FOR THIS FILE         FCOR1113
       REM                                                              FCOR1114
CKIOER IOERR   5             FCHECK ERROR(5), INPUT/OUTPUT ERROR        FCOR1115
       REM                                                              FCOR1116
CHKER3 ERROR   3             FCHECK ERROR(3), NOT AN ACTIVE FILE        FCOR1117
       REM                                                              FCOR1118
CHKER4 ERROR   4             FCHECK ERROR(4), I/O REQUEST OUT OF BOUNDS FCOR1119
       REM                                                              FCOR1120
       EJECT                                                            FCOR1121
       REM                                                              FCOR1122
       REM     CLOSE.($NAME1$,$NAME2$)                                  FCOR1123
       REM                                                              FCOR1124
CLOSE  SAVE    0,N,(SPM,SP)                                             FCOR1125
       REM                                                              FCOR1126
       CAL     P1            GET FIRST FILE NAME                        FCOR1127
       SLW     FILNAM        ..                                         FCOR1128
       CAL     P2            GET SECOND FILE NAME IF SPECIFIED          FCOR1129
       SLW     FILNAM+1      ..                                         FCOR1130
       ERA     NULPAR        WAS A SECOND FILE NAME SPECIFIED           FCOR1131
       TZE     CLSALL        NO, CHECK FOR CLOSE.($ALL$)                FCOR1132
       GTSTAT  FILNAM,CLSER3 YES, PICK UP ACTIVE FILE STATUS            FCOR1133
       PAC     ,2            PUT INTO INDEX                             FCOR1134
       TSX     FCLOSE,4      CLOSE OUT THIS FILE                        FCOR1135
       TRA     RETURN        AND RETURN                                 FCOR1136
       REM                                                              FCOR1137
CLSER3 ERROR   3             CLOSE ERROR(3), NOT AN ACTIVE FILE         FCOR1138
       REM                                                              FCOR1139
CLSALL CLA     FILNAM        HERE IF NO SECOND FILE NAME GIVEN          FCOR1140
       SUB     =HALL         CHECK FOR CLOSE.($ALL$)                    FCOR1141
       TZE     CLSAL1        .. FOUND, CLOSE OUT ALL FILES              FCOR1142
       CLA     FILNAM        .. LOOK FOR RIGHT ADJUSTED VERSION         FCOR1143
       SUB     =H   ALL      ..                                         FCOR1144
       TNZ     SEQERR        .. SEQUENCE ERROR IF NOT 'ALL'             FCOR1145
CLSAL1 STZ     ANYFIL+1      INITIALIZE SEARCH THRU A.F.S.T.            FCOR1146
CLSGET GTSTAT  ANYFIL,RETURN GET ANY ACTIVE FILE ENTRY                  FCOR1147
       PAC     ,2            BASE TO X7                                 FCOR1148
       CLA     RNAME1,2      GET NAME1                                  FCOR1149
       LDQ     RNAME2,2      NAME2 OF FILE REFERENCE                    FCOR1150
       DST     FILNAM        SAVE FOR DIAGNOSTICS                       FCOR1151
       TSX     FCLOSE,4      AND CLOSE OUT THE FILE                     FCOR1152
       TRA     CLSGET        GET NEXT ACTIVE FILE ENTRY OR RETURN       FCOR1153
       REM                                                              FCOR1154
FCLOSE SXA     FCLIR4,4      HERE TO CLOSE OUT FILE                     FCOR1155
       LXTC    (F,2),3       -F TO IR3                                  FCOR1156
       TSX     BCLOSE,4      CALL B.C.M. TO CLOSE OUT THIS FILE         FCOR1157
       EFA     0,2           ..                                         FCOR1158
       PAR     MEM,,BUF      ..                                         FCOR1159
       PAR     CLIOER,,QWAIT ..                                         FCOR1160
       PAR     CLSER4        ..                                         FCOR1161
       RTNFIL  CLSMER        RETURN FILE TO INACTIVE STATUS             FCOR1162
       LXA     FCLIR4,4      AND RETURN                                 FCOR1163
       TRA     1,4           ..                                         FCOR1164
       REM                                                              FCOR1165
SEQERR ERROR   1             ERROR(1), ILLEGAL CALLING SEQUENCE         FCOR1166
       REM                                                              FCOR1167
CLSER4 XEC     SCRAPF,3      HERE FOR BUFFER OUT OF BOUNDS, SCRAP FILE  FCOR1168
       EFA     0,2           .. DIRECTLY THROUGH STRATEGY MODULE        FCOR1169
       PAR     QWAIT         ..                                         FCOR1170
       RTNFIL  CLSMER        RETURN FILE TO INACTIVE STATUS             FCOR1171
       ERROR   4             CLOSE ERROR(4), I/O REQUEST OUT OF BOUNDS  FCOR1172
       REM                                                              FCOR1173
CLIOER IOERR   5             CLOSE ERROR(5), INPUT/OUTPUT ERROR         FCOR1174
       REM                                                              FCOR1175
CLSMER ERROR   6             CLOSE ERROR(6), MACHINE OR SYSTEM ERROR    FCOR1176
       REM                                                              FCOR1177
       EJECT                                                            FCOR1178
       REM                                                              FCOR1179
       REM     RESETF.                                                  FCOR1180
       REM                                                              FCOR1181
RESETF SAVE    0,N,()                                                   FCOR1182
       REM                                                              FCOR1183
       STZ     ANYFIL+1      INITIALIZE SEARCH THRU A.F.S.T.            FCOR1184
RSTF1  GTSTAT  ANYFIL,RETURN GET ANY ACTIVE FILE ENTRY                  FCOR1185
       PAC     0,2           -BASE OF ENTRY TO IR2                      FCOR1186
       CLA     RNAME1,2      .. (AS AT CLOSE)                           FCOR1187
       LDQ     RNAME2,2      ..                                         FCOR1188
       DST     FILNAM        ..                                         FCOR1189
       LXTC    (F,2),3       -F TO IR3                                  FCOR1190
       TSX     IOHALT,4      STOP I/O                                   FCOR1191
       PAR     =0            STOP ALL I/O                               FCOR1192
       XEC     SCRAPF,3      SCRAP ALL PENDING I/O FOR THIS FILE        FCOR1193
       EFA     0,2           .. THROUGH STRATEGY MODULE                 FCOR1194
       PAR     RSTBSY        ..                                         FCOR1195
       TSX     IOBEGN,4      RESTART I/O NOW                            FCOR1196
       PAR     =0            RATHER THAN WORRY ABOUT ERROR LATER        FCOR1197
       RTNFIL  RSTER3        RETURN FILE TO INACTIVE STATUS             FCOR1198
       TRA     RSTF1         GET NEXT ACTIVE FILE OR RETURN             FCOR1199
       REM                                                              FCOR1200
RSTBSY TSX     IOBEGN,4      RESTART BLOCKED I/O                        FCOR1201
       PAR     =0            FOR ALL (NON-BLOCKED) USERS                FCOR1202
       TRA     QWAIT         RETURN TO USER AT (0,4)                    FCOR1203
       REM                                                              FCOR1204
RSTER3 ERROR   3             RESETF ERROR(3), MACHINE OR SYSTEM ERROR   FCOR1205
       REM                                                              FCOR1206
       EJECT                                                            FCOR1207
       REM                                                              FCOR1208
       REM     CHFILE.($OLDNM1$,$OLDNM2$,NEWMOD,$NEWNM1$,$NEWNM2$)      FCOR1209
       REM                                                              FCOR1210
CHFILE SAVE    0,S,(FN,SP,SP,SP)                                        FCOR1211
       REM                                                              FCOR1212
       AXC     FILTMP,2      TRY TO FIND FILE IN U.F.D.(FILE)           FCOR1213
       SEARCH  UFD,FILNAM,CHFER4  ..                                    FCOR1214
       TSX     CKLINK,4      CHECK FOR 'LINKED' FILE                    FCOR1215
       PAR     CHFER5,,CHFER6  .. ERROR IF 'LINKED' FILE NOT FOUND      FCOR1216
       TSX     REFMFD,4      BUT HE CAN'T CHANGE ANYTHING IN M.F.D      FCOR1217
       EFA     FPROBN,2      ..                                         FCOR1218
       ZET     FS.TST        ERROR RETURN FROM 'REFMFD',                FCOR1219
       TRA     *+2           CHECK FOR SPECIAL 'MICK'EY MOUSE           FCOR1220
       TRA     CHFER3        HOO-HAH                                    FCOR1221
       CLA     FNAME1,2      GET NAME1                                  FCOR1222
       LDQ     FNAME2,2      ..                                         FCOR1223
       DST     RNAME1,2      PUT BOTH IN AFENTRY                        FCOR1224
       TSX     CHKACT,4      CHECK IF THIS FILE IS ALREADY ACTIVE       FCOR1225
       PAR     CHER12        .. ERROR IF THIS FILE IS ACTIVE            FCOR1226
       REM                                                              FCOR1227
       CAL     AUTHOR,2      IS THIS USER THE AUTHOR OF THIS FILE       FCOR1228
       ANA     =O777777      ..                                         FCOR1229
       SUB     AUTHNO,1      ..                                         FCOR1230
       TZE     CHF3          .. YES, HE MAY CHANGE OWN FILES            FCOR1231
       REM                                                              FCOR1232
       LDI     RMODE,2       FILE FOUND, GET FILE MODE                  FCOR1233
       LNT     040000        IS FILE IN PRIVATE MODE                    FCOR1234
       TRA     CHF2          NO, SKIP                                   FCOR1235
       LDI     URCODE,1      YES, GET USER RESTRICTION CODE             FCOR1236
       RFT     10            IS USER ALLOWED TO REFERENCE PRIVATE FILES FCOR1237
       TRA     CHF2          YES, SKIP                                  FCOR1238
       ERROR   7             NO, CHFILE ERROR(7), PRIVATE FILE          FCOR1239
       REM                                                              FCOR1240
CHF2   LDI     RMODE,2       RELOAD FILE MODE                           FCOR1241
       LNT     200000        IS FILE IN PROTECTED MODE                  FCOR1242
       TRA     CHF3          NO, SKIP                                   FCOR1243
       LDI     URCODE,1      YES, GET USER RESTRICTION CODE             FCOR1244
       RFT     04            MAY USER MODIFY PROTECTED FILES            FCOR1245
       TRA     CHF3          YES, SKIP                                  FCOR1246
       ERROR   8             CHFILE ERROR(8), PROTECTED FILE            FCOR1247
       REM                                                              FCOR1248
CHF3   LDI     ILOCK,2       GET FILE INTERLOCK SWITCH                  FCOR1249
       LFT     001777        IS FILE CURRENTLY IN USE                   FCOR1250
       TRA     CHFBSY        YES, SKIP TO INTERRUPT SUPERVISOR          FCOR1251
       STZ     TEMP          NO, CLEAR TEMP (RECORDS TO CHARGE)         FCOR1252
       CLA     P3            GET NEW MODE IF SPECIFIED                  FCOR1253
       TMI     CHF4          SKIP IF MODE UNCHANGED                     FCOR1254
       ALS     28            TO HIGH ORDER 8 BITS OF AC                 FCOR1255
       SLW     NEWMOD        SAVE NEW FILE MODE                         FCOR1256
       LDI     MODE,2        PICK UP OLD FILE MODE                      FCOR1257
       CAL     NORECS,2      COMPUTE NO. RECORDS CHARGED TO FILE        FCOR1258
       PDX     ,5            ..                                         FCOR1259
       PXA     ,5            ..                                         FCOR1260
       SSM                   .. SET TO REDUCE NO. OF RECORDS            FCOR1261
       LNT     002000        IS FILE IN TEMPORARY MODE                  FCOR1262
       STO     TEMP          .. NO, SAVE NO. RECORDS CHARGED TO FILE    FCOR1263
       RIL     776000        RESET OLD FILE MODE                        FCOR1264
       OSI     NEWMOD        ADD NEW FILE MODE FROM CALL                FCOR1265
       STI     MODE,2        SAVE AS NEW FILE MODE                      FCOR1266
       PXA     ,5            RELOAD NO. RECORDS IN FILE                 FCOR1267
       ADD     TEMP          COMPUTE DIFFERENCE                         FCOR1268
       LNT     002000        IS FILE NOW IN TEMPORARY MODE              FCOR1269
       STO     TEMP          .. NO, SAVE DIFFERENCE                     FCOR1270
       REM                                                              FCOR1271
CHF4   CAL     P4            NEW FILE NAME 1 IF SPECIFIED               FCOR1272
       STZ     NAMESW        RESET FILE NAME CHANGED SWITCH             FCOR1273
       LAS     NULPAR        IS NEW NAME1 SPECIFIED                     FCOR1274
       TRA     *+2           YES                                        FCOR1275
       TRA     CHF5          NO, SKIP                                   FCOR1276
       SLW     FNAME1,2      YES, STORE NEW FNAME1                      FCOR1277
       STL     NAMESW        AND INDICATE THAT FILE NAME HAS CHANGED    FCOR1278
       REM                                                              FCOR1279
CHF5   CAL     P5            NEW FILE NAME 2 IF SPECIFIED               FCOR1280
       LAS     NULPAR        IS NEW NAME2 SPECIFIED                     FCOR1281
       TRA     *+2           YES                                        FCOR1282
       TRA     CHF6          NO, SKIP                                   FCOR1283
       SLW     FNAME2,2      YES, STORE NEW FNAME2                      FCOR1284
       STL     NAMESW        AND INDICATE THAT FILE NAME HAS CHANGED    FCOR1285
       REM                                                              FCOR1286
CHF6   NZT     NAMESW        HAS FILE NAME CHANGED                      FCOR1287
       TRA     CHF7          NO, SKIP TO ENTER CHANGES                  FCOR1288
       ZET     FNAME1,2      CHECK THAT BOTH NEW                        FCOR1289
       TRA     *+3           FILE NAMES                                 FCOR1290
       NZT     FNAME2,2      ARE NOT                                    FCOR1291
       TRA     SEQERR        COMPLETELY ZERO                            FCOR1292
       TSX     GTDYTM,4      YES, PICK UP DATE AND TIME OF DAY          FCOR1293
       SLW     DAYTIM,2      AND UPDATE DATE/TIME LAST MODIFIED         FCOR1294
       SEARCH  (FPROBN,2),(FNAME1,2),CHF7  SEE IF FILE ALREADY EXISTS   FCOR1295
       ERROR   10            CHFILE ERROR(10), FILE NAME CONFLICT       FCOR1296
       REM                                                              FCOR1297
CHF7   NZT     TEMP          SHOULD USER RECORDS USED BE UPDATED        FCOR1298
       TRA     CHF9          NO, SKIP                                   FCOR1299
       LXTC    (F,2),3       YES, -F TO IR3                             FCOR1300
       GETQU   (FPROBN,2)    PICK UP RECORD QUOTA,,USED                 FCOR1301
       TSX     ADDREC,4      UPDATE USER NO. OF RECORDS USED            FCOR1302
       PAR     TEMP          .. BY + OR - C(TEMP)                       FCOR1303
       PAR     *+2           .. SKIP ON RECORD QUOTA OVERFLOW           FCOR1304
       TRA     CHF8          .. OTHERWISE GO UPDATE UFD                 FCOR1305
       LDI     URCODE,1      PICK UP USER RESTRICTION CODE              FCOR1306
       LFT     30            IGNORE RECORD QUOTA OVERFLOW               FCOR1307
       TRA     CHF8          .. FOR DAEMON OR PRIVILEGED COMMAND        FCOR1308
       LDQ     TEMP          PICK UP AMOUNT OF CHANGE                   FCOR1309
       TQP     CHFER9        .. ERROR IF RECORD USAGE INCREASE          FCOR1310
CHF8   SETQU   (FPROBN,2)    UPDATE RECORD QUOTA,,USED IN UFD           FCOR1311
       REM                                                              FCOR1312
CHF9   CAL     AUTHNO,1      CHANGE FILE 'AUTHOR' NUMBER                FCOR1313
       TZE     *+3           .. SKIP IF NO 'AUTHOR' SPECIFIED           FCOR1314
       STT     AUTHOR,2      ..                                         FCOR1315
       STA     AUTHOR,2      ..                                         FCOR1316
       UPDFIL  UFD,(RNAME1,2),CHFMER  UPDATE CHANGED FILE ENTRY IN UFD  FCOR1317
       TRA     RETURN        AND RETURN                                 FCOR1318
       REM                                                              FCOR1319
CHFBSY TSX     LOCK,4        TELL SUPERVISOR OF INTERLOCKED FILE        FCOR1320
       EXIT    IR4,ILC       AND RETURN TO USER AT 0,4                  FCOR1321
       REM                                                              FCOR1322
CHFMER ERROR   11            CHFILE ERROR(11), MACHINE ERROR            FCOR1323
       REM                                                              FCOR1324
CHFER3 ERROR   3             CHFILE ERROR(3), RESTRICTED FILE NAME      FCOR1325
       REM                                                              FCOR1326
CHFER4 ERROR   4             CHFILE ERROR(4), FILE NOT FOUND            FCOR1327
       REM                                                              FCOR1328
CHFER5 ERROR   5             CHFILE ERROR(5), LINK NOT FOUND            FCOR1329
       REM                                                              FCOR1330
CHFER9 ERROR   9             CHFILE ERROR(9), RECORD QUOTA OVERFLOW     FCOR1331
       REM                                                              FCOR1332
CHER12 ERROR   12            CHFILE ERROR(12), FILE ALREADY ACTIVE      FCOR1333
       REM                                                              FCOR1334
CHFER6 ERROR   6             CHFILE ERROR(6), LINKAGE DEPTH EXCEEDED    FCOR1335
       REM                                                              FCOR1336
       EJECT                                                            FCOR1337
       REM                                                              FCOR1338
       REM     RSFILE.($NAME1$,$NAME2$)                                 FCOR1339
       REM                                                              FCOR1340
RSFILE SAVE    22,S,(FN)                                                FCOR1341
       REM                                                              FCOR1342
       ENK                   GET CONSOLE ENTRY KEYS                     FCOR1343
       RQL     22            ALLOW CALL ONLY IF                         FCOR1344
       TQP     RSFER2        .. KEY 22 DOWN                             FCOR1345
       REM                                                              FCOR1346
       AXC     FILTMP,2      TRY TO FIND FILE IN U.F.D.                 FCOR1347
       SEARCH  UFD,FILNAM,RSFER3 ..                                     FCOR1348
       TSX     CKLINK,4      SEE IF 'LINKED' FILE                       FCOR1349
       PAR     RSFER4,,RSFER5 .. ERROR, LINKED FILE NOT FOUND           FCOR1350
       TSX     CHKACT,4      SEE IF THIS FILE IS ACTIVE                 FCOR1351
       PAR     RSFER6        .. ERROR IF ACTIVE FILE                    FCOR1352
       REM                                                              FCOR1353
       LDI     RWSTAT,2      RESET READ/WRITE STATUS FLAGS              FCOR1354
       RIL     700000        .. OF THIS FILE                            FCOR1355
       STI     RWSTAT,2      ..                                         FCOR1356
       TSX     UNLOCK,4      RESET INTERLOCK, TELL SUPERVISOR           FCOR1357
       UPDFIL  UFD,(FNAME1,2),RSFMER AND UPDATE FILE ENTRY              FCOR1358
       TRA     RETURN        EXIT                                       FCOR1359
       REM                                                              FCOR1360
RSFER2 ERROR   2             RSFILE ERROR(2), UNAUTHORIZED USE OF CALL  FCOR1361
       REM                                                              FCOR1362
RSFER3 ERROR   3             RSFILE ERROR(3), FILE NOT FOUND            FCOR1363
       REM                                                              FCOR1364
RSFER4 ERROR   4             RSFILE ERROR(4), LINK NOT FOUND            FCOR1365
       REM                                                              FCOR1366
RSFER5 ERROR   5             RSFILE ERROR(5), LINK DEPTH EXCEEDED       FCOR1367
       REM                                                              FCOR1368
RSFER6 ERROR   6             RSFILE ERROR(6), ATTEMPT TO RESET ACTIVE FIFCOR1369
       REM                                                              FCOR1370
RSFMER ERROR   7             RSFILE ERROR(7), SYSTEM OR MACHINE ERROR   FCOR1371
       REM                                                              FCOR1372
       EJECT                                                            FCOR1373
       REM                                                              FCOR1374
       REM     DELFIL.($NAME1$,$NAME2$)                                 FCOR1375
       REM                                                              FCOR1376
DELFIL SAVE    0,S,(FN)                                                 FCOR1377
       REM                                                              FCOR1378
       AXC     FILTMP,2      TRY TO FIND THIS FILE IN UFD               FCOR1379
       SEARCH  UFD,FILNAM,DELER3  ..                                    FCOR1380
       TSX     CKLINK,4      CHECK FOR 'LINKED' FILE                    FCOR1381
       PAR     DELER4,,DELER5  .. ERROR, LINK NOT FOUND                 FCOR1382
       TSX     REFMFD,4      HE DOESN'T EVEN GET TO TRY                 FCOR1383
       EFA     FPROBN,2      TO REMOVE AN ENTRY FROM M.F.D.             FCOR1384
       ZET     FS.TST        BUT SINCE 'DELMFD' CROAKS,                 FCOR1385
       TRA     *+2           GOTTA LET HIM REMOVE AN UN-LOADED ENTRY    FCOR1386
       TRA     DELER6        SAY THAT IT IS PROTECTED                   FCOR1387
       TSX     CHKACT,4      CHECK IF THIS FILE IS ALREADY ACTIVE       FCOR1388
       PAR     DELER8        .. ERROR IF THIS FILE IS ACTIVE            FCOR1389
       REM                                                              FCOR1390
       LDI     RMODE,2       FILE FOUND, GET FILE MODE                  FCOR1391
       LFT     270000        IS FILE P,V,R OR W                         FCOR1392
       TRA     DELER6        MODE MUST BE CHANGED                       FCOR1393
       LDI     ILOCK,2       GET FILE INTERLOCK SWITCH                  FCOR1394
       LFT     001777        IS FILE CURRENTLY IN USE                   FCOR1395
       TRA     DELBSY        YES, SKIP TO INTERRUPT SUPERVISOR          FCOR1396
       TSX     DFILE,4       NO, TRY TO DELETE THIS FILE                FCOR1397
       LDI     MODE,2        RELOAD FILE MODE                           FCOR1398
       LFT     002000        WAS FILE IN TEMPORARY MODE                 FCOR1399
       TRA     DEL2          YES, SKIP IGNORING RECORD QUOTA            FCOR1400
       CAL     NORECS,2      NO, GET NO. OF RECORDS IN THIS FILE        FCOR1401
       ARS     18            ..                                         FCOR1402
       ANA     =O77777       ..                                         FCOR1403
       SLW     TEMP          SAVE NO. OF RECORDS IN THIS FILE           FCOR1404
       LXTC    (F,2),3       PICK UP -DEVICE(F) IN IR3                  FCOR1405
       GETQU   (FPROBN,2)    PICK UP RECORD QUOTA,,USED                 FCOR1406
       TSX     SUBREC,4      REDUCE USED BY NO, OF RECORDS IN THIS FILE FCOR1407
       PAR     TEMP          ..                                         FCOR1408
       PAR     *+1           .. IGNORE ERROR RETURN                     FCOR1409
       SETQU   (FPROBN,2)    UPDATE QUOTA,,USED                         FCOR1410
       REM                                                              FCOR1411
DEL2   REMOVE  UFD,(FNAME1,2),DELMER  REMOVE THIS FILE FROM UFD         FCOR1412
       TRA     RETURN        AND RETURN                                 FCOR1413
       REM                                                              FCOR1414
DELBSY TSX     LOCK,4        TELL SUPERVISOR OF INTERLOCKED FILE        FCOR1415
       EXIT    IR4,ILC       AND RETURN TO USER AT 0,4                  FCOR1416
       REM                                                              FCOR1417
DELMER ERROR   7             DELFIL ERROR(7), MACHINE ERROR             FCOR1418
       REM                                                              FCOR1419
DELER3 ERROR   3             DELFIL ERROR(3), FILE NOT FOUND            FCOR1420
       REM                                                              FCOR1421
DELER4 ERROR   4             DELFIL ERROR(4), LINK NOT FOUND            FCOR1422
       REM                                                              FCOR1423
DELER6 ERROR   6             DELFIL ERROR(6), FILE IS PROTECTED         FCOR1424
       REM                                                              FCOR1425
DELER8 ERROR   8             DELFIL ERROR(8), FILE ALREADY ACTIVE       FCOR1426
       REM                                                              FCOR1427
DELER5 ERROR   5             DELFIL ERROR(5), LINK DEPTH EXCEEDED       FCOR1428
       REM                                                              FCOR1429
       EJECT                                                            FCOR1430
       REM                                                              FCOR1431
       REM     FSTATE.($NAME1$,$NAME2$,A(N)...N)                        FCOR1432
       REM                                                              FCOR1433
FSTATE SAVE    0,N,(FN,ARY)                                             FCOR1434
       REM                                                              FCOR1435
       GTSTAT  FILNAM,FSTAT1 CHECK IF THIS FILE IS ACTIVE               FCOR1436
       PAC     0,2           HERE IF FILE IS ACTIVE, GET BASE OF ENTRY  FCOR1437
       TRA     FSTAT2        AND RETURN STATUS OF ACTIVE FILE           FCOR1438
       REM                                                              FCOR1439
FSTAT1 NZT     PROBNO,1      IS USER ATTACHED                           FCOR1440
       TRA     FSTER2        NO, ERROR                                  FCOR1441
       AXC     FILTMP,2      HERE IF FILE NOT ACTIVE, LOOK IN UFD       FCOR1442
       SEARCH  UFD,FILNAM,FSTER3  ..                                    FCOR1443
       TSX     CKLINK,4      CHECK FOR 'LINKED' FILE                    FCOR1444
       PAR     FSTER4,,FSTER5 .. ERROR, LINK NOT FOUND                  FCOR1445
       CAL     =O1000001     FUDGE UP DUMMY READ/WRITE POINTERS         FCOR1446
       SLW     REDWRD,2      .. READ POINTER AT WORD 1                  FCOR1447
       CAL     LCOUNT,2      ..                                         FCOR1448
       PDX     ,7            CHECK NORECS OF THIS FILE                  FCOR1449
       TXH     *+2,7,0       SKIP IF NON-ZERO LENGTH                    FCOR1450
       CLA     =1B17         ELSE, FUDGE UP A FILE SIZE                 FCOR1451
       ADD     =1            PUT WRITE POINTER AFTER END OF FILE        FCOR1452
       SLW     WRTWRD,2      .. WRITE POINTER AFTER END OF FILE         FCOR1453
       REM                                                              FCOR1454
FSTAT2 CAL     LCOUNT,2      PZE LCOUNT,,NORECS                         FCOR1455
       TSX     RECADR,4      COMPUTE RECORD ADDRESS FROM LCOUNT,,NORECS FCOR1456
       USTORE  P3,RETURN     SAVE LENGTH OF FILE IN USER'S MEMORY       FCOR1457
       LDQ     RMODE,2       GET FILE MODE                              FCOR1458
       RQL     8             MOVE LINK BIT TO SIGN                      FCOR1459
       XCL                   ..                                         FCOR1460
       ANA     =O-377        REMOVE EXCESS BITS                         FCOR1461
       USTORE  P3,RETURN     SAVE MODE IN USER'S MEMORY                 FCOR1462
       CAL     RWSTAT,2      GET FILE STATUS (0-3)                      FCOR1463
       ARS     33            .. RIGHT ADJUST IN AC                      FCOR1464
       ANA     =3            .. 2-BIT STATUS                            FCOR1465
       ADD     =1            CHANGE STATUS (0-3) TO (1-4)               FCOR1466
       USTORE  P3,RETURN     SAVE STATUS IN USER'S MEMORY               FCOR1467
       CAL     F,2           GET DEVICE ON WHICH FILE RESIDES           FCOR1468
       ARS     15            .. RIGHT ADJUST IN AC                      FCOR1469
       ANA     =7            .. 3-BIT DEVICE                            FCOR1470
       USTORE  P3,RETURN     SAVE DEVICE IN USER'S MEMORY               FCOR1471
       CAL     REDWRD,2      GET READ POINTER PZE REDWRD,,REDREC        FCOR1472
       TSX     RECADR,4      COMPUTE ADDRESS OF NEXT RECORD TO BE READ  FCOR1473
       USTORE  P3,RETURN     SAVE NEXT READ ADDRESS IN USER'S MEMORY    FCOR1474
       CAL     WRTWRD,2      PZE WRTWRD,,WRTREC                         FCOR1475
       TSX     RECADR,4      COMPUTE ADDRESS OF NEXT WORD TO BE WRITTEN FCOR1476
       USTORE  P3,RETURN     SAVE NEXT WRITE ADDRESS IN USER'S MEMORY   FCOR1477
       CAL     DAYTIM,2      DATE AND TIME FILE WAS CREATED OR          FCOR1478
       USTORE  P3,RETURN     .. LAST MODIFIED TO USER                   FCOR1479
       CAL     DATELU,2      DATE FILE WAS LAST USED AND                FCOR1480
       USTORE  P3,RETURN     .. AUTHOR OF FILE TO USER                  FCOR1481
       TRA     RETURN        RETURN TO USER                             FCOR1482
       REM                                                              FCOR1483
FSTER2 ERROR   2             FSTATE ERROR(2), ILLEGAL USE OF CALL       FCOR1484
       REM                                                              FCOR1485
FSTER3 ERROR   3             FSTATE ERROR(3), FILE NOT FOUND            FCOR1486
       REM                                                              FCOR1487
FSTER4 ERROR   4             FSTATE ERROR(4), LINK NOT FOUND            FCOR1488
       REM                                                              FCOR1489
FSTER5 ERROR   5             FSTATE ERROR (5), LINK DEPTH EXCEEDED      FCOR1490
       REM                                                              FCOR1491
       EJECT                                                            FCOR1492
       REM                                                              FCOR1493
       REM     MOVFIL.($NAME1$,$NAME2$,$PROBNO$,$PROGNO$)               FCOR1494
       REM                                                              FCOR1495
MOVFIL SAVE    002,S,(FN,SPM,SPM)                                       FCOR1496
       REM                                                              FCOR1497
       AXC     FILTMP,2      TRY TO FIND THIS FILE IN UFD               FCOR1498
       SEARCH  UFD,FILNAM,MOVER3  ..                                    FCOR1499
       CAL     F,2           PICK UP DEVICE NO.                         FCOR1500
       ANA     =O700000      .. FROM TAG                                FCOR1501
       SLW     TEMP          SAVE FOR LATER CHECKING                    FCOR1502
       TZE     MOV0          SEE IF THIS IS A 'LINKED' FILE             FCOR1503
       TSX     CHKACT,4      CHECK IF THIS IS IN ACTIVE STATUS          FCOR1504
       PAR     MOVER8        .. ERROR IF FILE IS ACTIVE                 FCOR1505
       REM                                                              FCOR1506
       LDI     MODE,2        PICK UP FILE MODE                          FCOR1507
       LFT     200000        IS FILE PROTECTED                          FCOR1508
       TRA     MOVER5        YES, ERROR                                 FCOR1509
       LDI     ILOCK,2       NO, PICK UP FILE INTERLOCK SWITCH          FCOR1510
       LFT     001777        IS FILE CURRENTLY IN USE                   FCOR1511
       TRA     MOVBSY        YES, SKIP TO INTERRUPT SUPERVISOR          FCOR1512
MOV0   CLA     P3            NO, SET UP NEW PROBLEM                     FCOR1513
       LDQ     P4            AND PROGRAMMER                             FCOR1514
       DST     FPROBN,2      SAVE A CYCLE HERE AND THERE                FCOR1515
       TSX     REFMFD,4      BUT NO MOVING TO M.F.D.                    FCOR1516
       EFA     FPROBN,2      ..                                         FCOR1517
       TRA     MOVR10        ..                                         FCOR1518
       CHKUFD  (FPROBN,2),MOVER9  SEE IF TARGET DIRECTORY IS IN M.F.D.  FCOR1519
       SEARCH  (FPROBN,2),FILNAM,MOV1  CHECK IF FILE ALREADY EXISTS     FCOR1520
       ERROR   6             MOVFIL ERROR(6), FILE ALREADY EXISTS       FCOR1521
       REM                                                              FCOR1522
MOV1   NZT     TEMP          CHECK FOR LINKED FILE                      FCOR1523
       TRA     MOV3          FILE IS A LINK, SKIP DATE UPDATE           FCOR1524
       TSX     GTDYTM,4      UPDATE CREATION TIME FOR FILE              FCOR1525
       SLW     DAYTIM,2      ..                                         FCOR1526
MOV3   ADDFIL  (FPROBN,2),MOVMER  ADD FILE TO UFD OF FPROBN-FPROGN      FCOR1527
       REMOVE  (PROBNO,1),(FNAME1,2),MOVMER  REMOVE FROM CURRENT UFD    FCOR1528
       NZT     TEMP          CHECK FOR LINKED FILE                      FCOR1529
       TRA     MOV2          NO RECORD USAGE TO BE UPDATED IF A LINK    FCOR1530
       LDI     MODE,2        PICK UP FILE MODE                          FCOR1531
       LFT     002000        IS FILE IN TEMPORARY MODE                  FCOR1532
       TRA     MOV2          YES, SKIP                                  FCOR1533
       CAL     NORECS,2      NO, PICK UP NO. OF RECORDS USED BY FILE    FCOR1534
       ARS     18            .. INTO ADDRESS                            FCOR1535
       ANA     =O77777       ..                                         FCOR1536
       SLW     TEMP          .. SAVE NO. OF RECORDS IN THIS FILE        FCOR1537
       LXTC    (F,2),3       -DEVICE TO IR3                             FCOR1538
       GETQU   (PROBNO,1)    REDUCE RECORDS USED FOR CURRENT USER       FCOR1539
       TSX     SUBREC,4      ..                                         FCOR1540
       PAR     TEMP          ..                                         FCOR1541
       PAR     *+1           .. IGNORE ERROR RETURN                     FCOR1542
       SETQU   (PROBNO,1)    ..                                         FCOR1543
       GETQU   (FPROBN,2)    UPDATE RECORDS USED FOR U.F.D.             FCOR1544
       TSX     ADDREC,4      .. TO WHICH FILE WAS MOVED                 FCOR1545
       PAR     TEMP          ..                                         FCOR1546
       PAR     *+1           .. IGNORE ERROR RETURN                     FCOR1547
       SETQU   (FPROBN,2)    ..                                         FCOR1548
MOV2   TRA     RETURN        RETURN TO USER                             FCOR1549
       REM                                                              FCOR1550
MOVBSY TSX     LOCK,4        TELL SUPERVISOR OF INTERLOCKED FILE        FCOR1551
       EXIT    IR4,ILC       AND RETURN TO USER AT 0,4                  FCOR1552
       REM                                                              FCOR1553
MOVER3 ERROR   3             MOVFIL ERROR(3), FILE NOT FOUND            FCOR1554
       REM                                                              FCOR1555
MOVER5 ERROR   5             MOVFIL ERROR(5), FILE PROTECTED            FCOR1556
       REM                                                              FCOR1557
MOVMER ERROR   7             MOVFIL ERROR(7), MACHINE OR SYSTEM ERROR   FCOR1558
       REM                                                              FCOR1559
MOVER8 ERROR   8             MOVFIL ERROR(8), FILE IN ACTIVE STATUS     FCOR1560
       REM                                                              FCOR1561
MOVER9 ERROR   9             MOVFIL ERROR(9), U.F.D. NOT FOUND          FCOR1562
       REM                                                              FCOR1563
MOVR10 ERROR   10            MOVFIL ERROR(10), MOVING TO M.F.D. (FILE)  FCOR1564
       EJECT                                                            FCOR1565
       REM                                                              FCOR1566
       REM     SETFIL.($NAME1$,$NAME2$,DAYTIM,DATELU,MODE,DEVICE)       FCOR1567
       REM                                                              FCOR1568
SETFIL SAVE    016,S,(FN,SPM,SPM,SP,SP)                                 FCOR1569
       REM                                                              FCOR1570
       AXC     FILTMP,2      SEE IF FILE ALREADY EXISTS                 FCOR1571
       SEARCH  UFD,FILNAM,SETFL1  ..                                    FCOR1572
       CAL     F,2           FIND DEVICE NO.                            FCOR1573
       ANA     =O700000      CHECK FOR 'LINK'                           FCOR1574
       TZE     STFER5        ERROR, FILE IS LINK                        FCOR1575
       CLA     P3            HERE IF FILE ALREADY EXISTS,               FCOR1576
       LDQ     P4            SET DAYTIM, DLU, AUTH DIRECTLY             FCOR1577
       DST     DAYTIM,2      .. SET NEW DATE AND TIME CREATED           FCOR1578
       TSX     REFMFD,4      ..                                         FCOR1579
       EFA     FPROBN,2      ..                                         FCOR1580
       ZET     FS.TST        NOTE FALLING INTO MACRO CODE...            FCOR1581
       UPDFIL  UFD,FILNAM,SETFME  REPLACE OLD ENTRY IN UFD              FCOR1582
       TRA     RETURN        AND RETURN                                 FCOR1583
       REM                                                              FCOR1584
SETFL1 CLA     PROBNO,1      HERE TO CREATE NEW FILE ENTRY              FCOR1585
       LDQ     PROGNO,1      ..                                         FCOR1586
       DST     FPROBN,2      ..                                         FCOR1587
       CLA     FILNAM        .. FILE NAME(1)                            FCOR1588
       LDQ     FILNAM+1      .. (2)                                     FCOR1589
       DST     FNAME1,2      ..                                         FCOR1590
       CLA     P3            .. DATE AND TIME CREATED FROM CALLER       FCOR1591
       LDQ     P4            .. DATE LAST USED, AUTHOR                  FCOR1592
       DST     DAYTIM,2      ..                                         FCOR1593
       CLA     M.IL.F        .. NORMAL MODE AND DEVICE                  FCOR1594
       LDQ     TGPMAX        .. PMAX IN TAG                             FCOR1595
       DST     MODE,2        ..                                         FCOR1596
       STZ     POINTR,2      .. RESET POINTR                            FCOR1597
       CLA     P5            PICK UP MODE IF SPECIFIED                  FCOR1598
       TMI     SETFL2        SKIP IF MODE NOT PROVIDED                  FCOR1599
       ALS     28            SAVE AS HIGH ORDER 8 BITS                  FCOR1600
       ORS     MODE,2        SET NEW FILE MODE                          FCOR1601
SETFL2 CLA     P6            PICK UP DEVICE IF SPECIFIED                FCOR1602
       TMI     SETFL3        SKIP IF NOT PROVIDED                       FCOR1603
       PAX     0,4           NEW DEVICE TO IR4                          FCOR1604
       TXL     STFER3,4,0    ERROR IF DEVICE .E. 0                      FCOR1605
       TXH     STFER3,4,FMAX ERROR IF DIVICE .G. FMAX                   FCOR1606
       ALS     15            DEVICE TO TAG                              FCOR1607
       STT     F,2           SET NEW FILE DEVICE                        FCOR1608
SETFL3 ADDFIL  UFD,SETFME    ADD NEW FILE ENTRY TO UFD                  FCOR1609
       TRA     RETURN        AND RETURN                                 FCOR1610
       REM                                                              FCOR1611
STFER3 ERROR   3             SETFIL ERROR(3), ILLEGAL DEVICE NUMBER     FCOR1612
       REM                                                              FCOR1613
SETFME ERROR   4             SETFIL ERROR(4), MACHINE OR SYSTEM ERROR   FCOR1614
       REM                                                              FCOR1615
STFER5 ERROR   5             SETFIL ERROR(5), FILE IS A 'LINK'          FCOR1616
       EJECT                                                            FCOR1617
       REM                                                              FCOR1618
       REM     LINK.(RNAME1,RNAME2,LPROBN,LPROGN,LNAME1,LNAME2,MODE)    FCOR1619
       REM                                                              FCOR1620
LINK   SAVE    002,S,(FN,SPM,SPM,SP,SP,SP)                              FCOR1621
       REM                                                              FCOR1622
       TSX     REFMFD,4      NO LINKS IN MFD, PLEASE                    FCOR1623
       EFA     PROBNO,1      ATTACHED DIRECTORY                         FCOR1624
       TRA     LNKER6        .. ERROR                                   FCOR1625
       AXC     FILTMP,2                                                 FCOR1626
       SEARCH  UFD,FILNAM,LNK1  CHECK IF FILE ALREADY IN UFD            FCOR1627
       ERROR   3             LINK ERROR(3), FILE ALREADY IN UFD         FCOR1628
       REM                                                              FCOR1629
LNK1   CLA     PROBNO,1      CONSTRUCT 'LINKED' FILE ENTRY              FCOR1630
       LDQ     PROGNO,1      ..                                         FCOR1631
       DST     FPROBN,2      ..                                         FCOR1632
       CLA     FILNAM        NAME1                                      FCOR1633
       LDQ     FILNAM+1      NAME2 OF LINK                              FCOR1634
       DST     FNAME1,2      ..                                         FCOR1635
       DST     LNAME1,2      AND NAME OF LINKEE                         FCOR1636
       CLA     P3            PROBN,                                     FCOR1637
       LDQ     P4            PROGN OF LINKEE                            FCOR1638
       DST     LPROBN,2      ..                                         FCOR1639
       STZ     F,2           .. DEVICE .E. 0 INDICATES 'LINKED' FILE    FCOR1640
       CAL     P5            CHECK IF LNAME1 PROVIDED                   FCOR1641
       ERA     NULPAR        ..                                         FCOR1642
       TZE     LNK2          .. SKIP IF LNAME1 NOT GIVEN                FCOR1643
       CAL     P5            OTHERWISE USE THIS AS LNAME1               FCOR1644
       SLW     LNAME1,2      ..                                         FCOR1645
LNK2   CAL     P6            CHECK IF LNAME2 IS PROVIDED                FCOR1646
       ERA     NULPAR        ..                                         FCOR1647
       TZE     LNK3          .. SKIP IF LNAME2 NOT GIVEN                FCOR1648
       CAL     P6            OTHERWISE USE THIS AS LNAME2               FCOR1649
       SLW     LNAME2,2      ..                                         FCOR1650
LNK3   CLA     P7            PICK UP MODE IF PROVIDED                   FCOR1651
       TMI     LNK4          .. SKIP IF MODE NOT GIVEN                  FCOR1652
       ALS     28            .. MODE TO HIGH ORDER 8 BITS               FCOR1653
       ORS     MODE,2        .. SAVE 'LINKED' FILE MODE                 FCOR1654
LNK4   ZET     LNAME1,2      AS AT 'CHFILE'                             FCOR1655
       TRA     *+3           CHECK THAT                                 FCOR1656
       NZT     LNAME2,2      BOTH FILE NAMES FOR LINK                   FCOR1657
       TRA     SEQERR        ARE NOT ZERO                               FCOR1658
       ADDFIL  UFD,LNKMER    ADD NEW 'LINKED' FILE TO UFD               FCOR1659
       CHKUFD  (LPROBN,2),LNKER5 CHECK IF $PROBNO$,$PROGNO$ IN MFD      FCOR1660
       TRA     RETURN        AND RETURN                                 FCOR1661
       REM                                                              FCOR1662
LNKMER ERROR   4             LINK ERROR(4), MACHINE ERROR               FCOR1663
       REM                                                              FCOR1664
LNKER5 ERROR   5             LINK ERROR(5), PROBNO-PROGNO NOT IN MFD    FCOR1665
       REM                                                              FCOR1666
LNKER6 ERROR   6             LINK ERROR(6), USER ATTACHED TO MFD        FCOR1667
       EJECT                                                            FCOR1668
       REM                                                              FCOR1669
       REM     UNLINK.($LNAME1$,$LNAME2$)                               FCOR1670
       REM                                                              FCOR1671
UNLINK SAVE    002,S,(FN)                                               FCOR1672
       REM                                                              FCOR1673
       AXC     FILTMP,2                                                 FCOR1674
       SEARCH  UFD,FILNAM,ULKER3  FIND FILE IN UFD                      FCOR1675
       CAL     F,2           PICK UP DEVICE NO.                         FCOR1676
       ANA     =O700000      .. FROM TAG                                FCOR1677
       TNZ     ULKER4        .. 'LINKED' FILE MUST HAVE F=0             FCOR1678
       REMOVE  UFD,(FNAME1,2),ULKMER  REMOVE LINKED FILE FROM UFD       FCOR1679
       TRA     RETURN        AND RETURN                                 FCOR1680
       REM                                                              FCOR1681
ULKER3 ERROR   3             UNLINK ERROR(3), FILE NOT FOUND            FCOR1682
       REM                                                              FCOR1683
ULKER4 ERROR   4             UNLINK ERROR(4), NOT A 'LINKED' FILE       FCOR1684
       REM                                                              FCOR1685
ULKMER ERROR   5             UNLINK ERROR(5), MACHINE ERROR             FCOR1686
       REM                                                              FCOR1687
       EJECT                                                            FCOR1688
       REM                                                              FCOR1689
       REM     ALLOT.(DEVICE,ALLOT,USED)                                FCOR1690
       REM                                                              FCOR1691
ALLOT  SAVE    002,S,(SPM,SPM,SP)                                       FCOR1692
       REM                                                              FCOR1693
       LAC     P1,3          -DEVICE NUMBER TO IR3                      FCOR1694
       TXL     ALTER3,3,0    ERROR IF DEVICE=0                          FCOR1695
       TXL     ALTER3,3,-FMAX-1  OR DEVICE .G. FMAX                     FCOR1696
       GETQU   (PROBNO,1)    GET QUOTA,,USED FROM UFD                   FCOR1697
       SLW     SAVEQU        .. SAVE IT                                 FCOR1698
       CAL     P2            SET UP NEW RECORD QUOTA                    FCOR1699
       STA     SAVEQU        ..                                         FCOR1700
       CLA     P3            GET NEW RECORDS USED                       FCOR1701
       TMI     ALT1          SKIP IF NOT SPECIFIED                      FCOR1702
       ALS     18            SET NEW RECORDS USED                       FCOR1703
       STD     SAVEQU        .. FOR THIS DEVICE                         FCOR1704
ALT1   CAL     SAVEQU        SAVE NEW QUOTA,,USED IN UFD                FCOR1705
       SETQU   (PROBNO,1)    ..                                         FCOR1706
       TRA     RETURN        AND RETURN                                 FCOR1707
       REM                                                              FCOR1708
ALTER3 ERROR   3             ALLOT ERROR(3), ILLEGAL DEVICE NO.         FCOR1709
       REM                                                              FCOR1710
       EJECT                                                            FCOR1711
       REM                                                              FCOR1712
       REM     STORGE.(DEVICE,ALLOT,USED)                               FCOR1713
       REM                                                              FCOR1714
STORGE SAVE    0,S,(SPM,ADR,ADR)                                        FCOR1715
       REM                                                              FCOR1716
       LAC     P1,3          -DEVICE NUMBER TO IR3                      FCOR1717
       TXL     STRER3,3,0    ERROR IF DEVICE ZERO                       FCOR1718
       TXL     STRER3,3,-FMAX-1  OR DEVICE .G. FMAX                     FCOR1719
       GETQU   (PROBNO,1)    GET QUOTA,,USED FROM UFD                   FCOR1720
       SLW     SAVEQU        .. SAVE IT                                 FCOR1721
       CLA     P2            ADDRESS USED TO STORE NO. OF WORDS ALLOTED FCOR1722
       TMI     STR1          SKIP IF NOT SPECIFIED                      FCOR1723
       PAC     0,2           -ADDRESS TO IR2                            FCOR1724
       CAL     SAVEQU        PICK UP NO. OF WORDS ALLOTTED              FCOR1725
       ANA     =O77777       ..                                         FCOR1726
       SLW     TEMP          .. SAVE IT                                 FCOR1727
       MOVE1   HOME,TEMP,CALL,(0,2),STRER4  MOVE TO USER'S MEMORY       FCOR1728
STR1   CLA     P3            ADDRESS USED TO STORE NO. OF WORDS USED    FCOR1729
       TMI     STR2          SKIP IF NOT SPECIFIED                      FCOR1730
       PAC     0,2           -ADDRESS TO IR2                            FCOR1731
       CAL     SAVEQU        PICK UP ALLOT,,USED                        FCOR1732
       ARS     18            .. GET NO. OF WORDS USED                   FCOR1733
       ANA     =O77777       ..                                         FCOR1734
       SLW     TEMP          .. SAVE IT                                 FCOR1735
       MOVE1   HOME,TEMP,CALL,(0,2),STRER4  MOVE TO USER'S MEMORY       FCOR1736
STR2   TRA     RETURN        AND RETURN TO USER                         FCOR1737
       REM                                                              FCOR1738
STRER3 ERROR   3             STORGE ERROR(3), ILLEGAL DEVICE NO.        FCOR1739
       REM                                                              FCOR1740
STRER4 ERROR   4             STORGE ERROR(4), MACHINE OR SYSTEM ERROR   FCOR1741
       REM                                                              FCOR1742
       EJECT                                                            FCOR1743
       REM                                                              FCOR1744
       REM     THE FOLLOWING CALLS REFER TO TAPE FILES ONLY ..........  FCOR1745
       REM                                                              FCOR1746
       REM     MOUNT.(CHANNO,UNITNO,MESSAG(N)...N)                      FCOR1747
       REM                                                              FCOR1748
MOUNT  SAVE    0,N,(SP,SPM,ARY)                                         FCOR1749
       REM                                                              FCOR1750
       TSX     MVHOME,4      MOVE MESSAGE TO HOME MEMORY                FCOR1751
       PAR     P3            ..                                         FCOR1752
       TSX     MNTTAP,4      CALL TAPE STRATEGY MODULE TO MOUNT TAPE    FCOR1753
       EFA     0,1           ..                                         FCOR1754
       PAR     P2,,P1        .. (PUT UNITNO FIRST IN CALL, FOR SYMMETRY)FCOR1755
       PAR     P3,,QWAIT     ..                                         FCOR1756
       PAR     MNTER3,,MNTER4  ..                                       FCOR1757
       TRA     RETURN        AND RETURN                                 FCOR1758
       REM                                                              FCOR1759
MNTER3 ERROR   3             MOUNT ERROR(3), NO TAPE AVAILABLE          FCOR1760
       REM                                                              FCOR1761
MNTER4 ERROR   4             MOUNT ERROR(4), AUTHOR-UNIT CONFLICT       FCOR1762
       REM                                                              FCOR1763
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR1764
       REM                                                              FCOR1765
       REM     UMOUNT.(UNITNO,MESSAG(N)...N)                            FCOR1766
       REM                                                              FCOR1767
UMOUNT SAVE    0,N,(SPM,ARY)                                            FCOR1768
       REM                                                              FCOR1769
       TSX     MVHOME,4      MOVE MESSAGE TO HOME MEMORY                FCOR1770
       PAR     P2            ..                                         FCOR1771
       REM                                                              FCOR1772
       CAL     P1            CHECK 'UNITNO'                             FCOR1773
       ERA     =HALL         IS IT 'ALL' (LJ)                           FCOR1774
       TZE     UMT1          YES                                        FCOR1775
       CAL     P1            ..                                         FCOR1776
       ERA     =H   ALL      OR (RJ)                                    FCOR1777
       TZE     UMT1          ..                                         FCOR1778
       REM                                                              FCOR1779
       TSX     UMTTAP,4      CALL TAPE STRATEGY TO UNMOUNT TAPE         FCOR1780
       EFA     0,1           ..                                         FCOR1781
       PAR     P1,,QWAIT     ..                                         FCOR1782
       PAR     P2,,UMTER3    ..                                         FCOR1783
       TRA     RETURN        AND RETURN                                 FCOR1784
       REM                                                              FCOR1785
UMT1   TSX     UMTALL,4      UNMOUNT ALL TAPES FOR THIS LOSER           FCOR1786
       EFA     0,1           BASE OF AFST,FOR 'AUTHOR'                  FCOR1787
       PAR     P2,,UMTER3    P2 = MESSAG,,N                             FCOR1788
       TRA     RETURN                                                   FCOR1789
       REM                                                              FCOR1790
UMTER3 ERROR   3             UMOUNT ERROR(3), TAPE CURRENTLY IN USE     FCOR1791
       REM                                                              FCOR1792
       EJECT                                                            FCOR1793
       REM                                                              FCOR1794
       REM     VERIFY.(UNITNO,LABEL(N)...N)                             FCOR1795
       REM                                                              FCOR1796
VERIFY SAVE    0,N,(SPM,ARY)                                            FCOR1797
       REM                                                              FCOR1798
       TSX     VERTAP,4      CALL TAPE STRATEGY TO VERIFY LABEL         FCOR1799
       EFA     0,1           ..                                         FCOR1800
       PAR     P1,,QWAIT     ..                                         FCOR1801
       PAR     P2,,MEM       ..                                         FCOR1802
       PAR     VERR3,,VERR4  ..                                         FCOR1803
       PAR     VERR5,,VERR6  ..                                         FCOR1804
       PAR     VERR7         ..                                         FCOR1805
       TRA     RETURN        AND RETURN                                 FCOR1806
       REM                                                              FCOR1807
VERR3  ERROR   3             ERROR(3), TAPE FILE DOES NOT EXIST         FCOR1808
       REM                                                              FCOR1809
VERR4  ERROR   4             ERROR(4), MACHINE ERROR OR BAD STATUS      FCOR1810
       REM                                                              FCOR1811
VERR5  ERROR   5             ERROR(5), MOUNT FAILED, ILLEGAL OPERATION  FCOR1812
       REM                                                              FCOR1813
VERR6  ERROR   6             ERROR(6), MOUNT FAILED, OPNS. DIFFICULTIES FCOR1814
       REM                                                              FCOR1815
VERR7  ERROR   7             ERROR(7), LABEL DOES NOT MATCH             FCOR1816
       REM                                                              FCOR1817
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR1818
       REM                                                              FCOR1819
       REM     LABEL.(UNITNO,LABEL(N)...N)                              FCOR1820
       REM                                                              FCOR1821
LABEL  SAVE    0,N,(SPM,ARY)                                            FCOR1822
       REM                                                              FCOR1823
       TSX     LBLTAP,4      CALL TAPE STRATEGY TO WRITE LABEL          FCOR1824
       EFA     0,1           ..                                         FCOR1825
       PAR     P1,,QWAIT     ..                                         FCOR1826
       PAR     P2,,MEM       ..                                         FCOR1827
       PAR     LBER3,,LBER4  ..                                         FCOR1828
       PAR     LBER5,,LBER6  ..                                         FCOR1829
       TRA     RETURN        AND RETURN                                 FCOR1830
       REM                                                              FCOR1831
LBER3  ERROR   3             ERROR(3), TAPE FILE DOES NOT EXIST         FCOR1832
       REM                                                              FCOR1833
LBER4  ERROR   4             ERROR(4), MACHINE ERROR OR BAD STATUS      FCOR1834
       REM                                                              FCOR1835
LBER5  ERROR   5             ERROR(5), MOUNT FAILED, ILLEGAL OPERATION  FCOR1836
       REM                                                              FCOR1837
LBER6  ERROR   6             ERROR(6), MOUNT FAILED, OPNS. DIFFICULTIES FCOR1838
       EJECT                                                            FCOR1839
       REM                                                              FCOR1840
       REM     TAPFIL.($NAME1$,$NAME2$,UNITNO,FILENO)                   FCOR1841
       REM                                                              FCOR1842
TAPFIL SAVE    0,S,(FN,SPM,SP)                                          FCOR1843
       REM                                                              FCOR1844
       TSX     REFMFD,4      RATHER STICKY WICKET IF                    FCOR1845
       EFA     PROBNO,1      U.F.D. IS ON A TAPE                        FCOR1846
       TRA     TAPER6        I SAY THERE                                FCOR1847
       REM                                                              FCOR1848
       AXC     FILTMP,2      CHECK IF FILE ALREADY EXISTS               FCOR1849
       SEARCH  UFD,FILNAM,TAP1  ..                                      FCOR1850
       ERROR   3             TAPFIL ERROR(3), FILE ALREADY EXISTS       FCOR1851
       REM                                                              FCOR1852
TAP1   AXC     3,3           GET QUOTA FOR DEVICE 3 (TAPE)              FCOR1853
       GETQU   (PROBNO,1)    ..                                         FCOR1854
       ANA     =O77777       MASK OFF THE QUOTA                         FCOR1855
       TZE     TAPER5        ERROR IF NO TAPE QUOTA                     FCOR1856
       REM                                                              FCOR1857
       CLA     PROBNO,1      CONSTRUCT FILE ENTRY                       FCOR1858
       LDQ     PROGNO,1      ..                                         FCOR1859
       DST     FPROBN,2      ..                                         FCOR1860
       CLA     FILNAM        .. FILE NAME(1)                            FCOR1861
       LDQ     FILNAM+1      .. (2)                                     FCOR1862
       DST     FNAME1,2      ..                                         FCOR1863
       TSX     GTDYTM,4      .. SET UP DATE AND TIME FILE CREATED       FCOR1864
       SLW     DAYTIM,2      ..                                         FCOR1865
       ANA     =O777777000000  .. GET DATE ALONE                        FCOR1866
       ORA     AUTHNO,1      .. + AUTHOR OF FILE                        FCOR1867
       SLW     DATELU,2      ..                                         FCOR1868
       CAL     TPUNIT        .. MODE AND DEVICE FOR TAPE FILE           FCOR1869
       SLW     F,2           ..                                         FCOR1870
       CAL     TGPMAX        .. PMAX IN TAG                             FCOR1871
       ORA     =O77777000000 .. SET NORECS TO -1                        FCOR1872
       SLW     NORECS,2      ..                                         FCOR1873
       CAL     P3            .. PICK UP LOGICAL UNIT NO.                FCOR1874
       ANA     =O77777       .. MODULO 2.P.15                           FCOR1875
       SLW     POINTR,2      .. SET UP FILE POINTER                     FCOR1876
       CLA     P4            .. PICK UP FILE NO. IF SPECIFIED           FCOR1877
       TMI     *+3           .. SKIP IF NOT SPECIFIED                   FCOR1878
       ALS     18            .. FILE NO. TO DECREMENT                   FCOR1879
       STD     POINTR,2      .. SET FILE NO. IN FILE ENTRY              FCOR1880
       ADDFIL  UFD,TAPMER    ENTER NEW FILE IN UFD                      FCOR1881
       TRA     RETURN        AND RETURN                                 FCOR1882
       REM                                                              FCOR1883
TAPMER ERROR   4             TAPFIL ERROR(4), MACHINE OR SYSTEM ERROR   FCOR1884
       REM                                                              FCOR1885
TAPER5 ERROR   5             TAPFIL ERROR(5), NO TAPE QUOTA ALLOTTED    FCOR1886
       REM                                                              FCOR1887
TAPER6 ERROR   6             TAPFIL ERROR(6), USER ATTACHED TO M.F.D.   FCOR1888
       EJECT                                                            FCOR1889
       REM                                                              FCOR1890
       REM     ............... ERROR DIAGNOSTIC ROUTINE 'IODIAG' .......FCOR1891
       REM                                                              FCOR1892
       REM     IODIAG.(A(N)...N)                                        FCOR1893
       REM                                                              FCOR1894
IODIAG SAVE    0,N,(ARY)                                                FCOR1895
       REM                                                              FCOR1896
       CAL     ERRILC,1      LOCATION OF CALL CAUSING ERROR             FCOR1897
       USTORE  P1,RETURN     .. STORE IN USER'S MEMORY                  FCOR1898
       CAL     ERNAME,1      NAME OF ENTRY IN WHICH ERROR OCCURRED      FCOR1899
       USTORE  P1,RETURN     .. STORE IN USER'S MEMORY                  FCOR1900
       CAL     ERCODE,1      ERROR CODE                                 FCOR1901
       USTORE  P1,RETURN     .. TO USER                                 FCOR1902
       CAL     IOCODE,1      INPUT/OUTPUT ERROR CODE IF ANY             FCOR1903
       USTORE  P1,RETURN     ..                                         FCOR1904
       CAL     ENAME1,1      NAME(1) OF FILE INVOLVED IN ERROR          FCOR1905
       USTORE  P1,RETURN     ..                                         FCOR1906
       CAL     ENAME2,1      NAME(2) OF FILE INVOLVED IN ERROR          FCOR1907
       USTORE  P1,RETURN     ..                                         FCOR1908
       CAL     ERCALL,1      LOCATION OF CALL TO ERROR OR IOERR         FCOR1909
       USTORE  P1,RETURN     ..                                         FCOR1910
       TRA     RETURN        RETURN TO USER                             FCOR1911
       REM                                                              FCOR1912
       EJECT                                                            FCOR1913
       REM                                                              FCOR1914
       REM     CALLS AVAILABLE TO THE SUPERVISORY SYSTEM ONLY           FCOR1915
       REM                                                              FCOR1916
       REM                                                              FCOR1917
       REM     SETUSR.(USERNO,URCODE,AUTHNO,LIMITS,RELOC,PRIOR)         FCOR1918
       REM                                                              FCOR1919
SETUSR CLA*    1,4           GET SLOT NUMBER IF SPECIFIED               FCOR1920
       TMI     SETU1         SKIP IF NOT SPECIFIED                      FCOR1921
       STO     SLOTNO        OTHERWISE SET NEW USER SLOT NO.            FCOR1922
       LAC     SLOTNO,7      -SLOT NUMBER TO IR7                        FCOR1923
       CAL     USRTBL,7      PICK UP ADDRESS OF USER STATUS TABLE       FCOR1924
       SLW     UTABLE        .. FOR THIS USER SLOT                      FCOR1925
SETU1  LAC     UTABLE,7                                                 FCOR1926
       CLA*    2,4           USER RESTRICTION CODE IF SPECIFIED         FCOR1927
       TMI     SETU2         SKIP IF NOT SPECIFIED                      FCOR1928
       STO     URCODE,7      OTHERWISE SET USER RESTRICTION CODE        FCOR1929
SETU2  CLA*    3,4           GET AUTHOR NUMBER IF SPECIFIED             FCOR1930
       TMI     SETU3         SKIP IF NOT SPECIFIED                      FCOR1931
       STO     AUTHNO,7      OTHERWISE SET UP USER AUTHOR NO.           FCOR1932
SETU3  CLA*    4,4           PROTECTION LIMITS IF SPECIFIED             FCOR1933
       TMI     SETU4         SKIP IF NOT SPECIFIED                      FCOR1934
       STO     LIMITS,7      OTHERWISE SET USER PROTECTION LIMITS       FCOR1935
SETU4  CLA*    5,4           USER RELOCATION IF SPECIFIED               FCOR1936
       TMI     SETU5         SKIP IF NOT SPECIFIED                      FCOR1937
       STO     RELOC,7       OTHERWISE SET USER RELOCATION              FCOR1938
SETU5  CLA*    6,4           PICK UP USER PRIORITY IF SPECIFIED         FCOR1939
       TMI     SETU6         SKIP IF NOT SPECIFIED                      FCOR1940
       ALS     18            PRIORITY TO DECREMENT                      FCOR1941
       ORA     SLOTNO        USER SLOT NUMBER TO ADDRESS                FCOR1942
       SLW     TEMP          SAVE SLOT,,PRIOR                           FCOR1943
       AXT     DUSERS,6                                                 FCOR1944
STU5.1 CAL     PRIORT+DUSERS,6  SEARCH PRIORITY TABLE                   FCOR1945
       ANA     =O77777       .. FOR THIS USER NUMBER                    FCOR1946
       SUB     SLOTNO        ..                                         FCOR1947
       TNZ     *+2           ..                                         FCOR1948
       STZ*    STU5.1        .. RESET THIS SLOT WHEN FOUND              FCOR1949
       TIX     STU5.1,6,1    ..                                         FCOR1950
       AXT     DUSERS,6                                                 FCOR1951
       CAL     TEMP          PZE  SLOT,,PRIOR                           FCOR1952
STU5.2 ZET     PRIORT+DUSERS,6  REPLACE USER IN PRIORITY TABLE          FCOR1953
       TRA     STU5.3        ..                                         FCOR1954
       SLW*    STU5.2        .. EMPTY SLOT FOUND SET THIS USER          FCOR1955
       TRA     STU5.4        .. AND GO SORT PRIORITY TABLE              FCOR1956
STU5.3 TIX     STU5.2,6,1    ..                                         FCOR1957
       HTR     *             MACHINE ERROR, SHOULD NEVER GET HERE       FCOR1958
       REM                                                              FCOR1959
STU5.4 TSX     SORT,7        SORT PRIORITY TABLE                        FCOR1960
       PAR     PRIORT,,DUSERS  ..                                       FCOR1961
SETU6  TRA     7,4           AND RETURN                                 FCOR1962
       REM                                                              FCOR1963
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR1964
       REM                                                              FCOR1965
       REM     CHNGUS.(USERNO)                                          FCOR1966
       REM                                                              FCOR1967
CHNGUS CAL*    1,4           SET NEW USER OF FILE SYSTEM                FCOR1968
       SLW     SLOTNO        ..                                         FCOR1969
       LAC     SLOTNO,7      -NEW SLOT NUMBER TO IR7                    FCOR1970
       CAL     USRTBL,7      SET ADDRESS OF NEW USER'S STATUS TABLE     FCOR1971
       SLW     UTABLE        ..                                         FCOR1972
       TRA     2,4           AND RETURN                                 FCOR1973
       REM                                                              FCOR1974
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR1975
       REM                                                              FCOR1976
       REM     SETRAP.(IFUNCT)                                          FCOR1977
       REM                                                              FCOR1978
SETRAP CAL     1,4           GET ADDRESS OF SUPERVISORY TRAP LOCATION   FCOR1979
       STA     SSCALL        .. SET UP INTERRUPT TO SUPERVISOR          FCOR1980
       TRA     2,4           AND RETURN                                 FCOR1981
       REM                                                              FCOR1982
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR1983
       REM                                                              FCOR1984
       REM     USTAT.(ARRAY(N)...N, Q1(N)...N, ... , QFMAX(N)...N)      FCOR1985
       REM                                                              FCOR1986
USTAT  SSAVE   (ARY)                                                    FCOR1987
       DUP     1,FMAX        EXTEND PROTOTYPE BY FMAX                   FCOR1988
       PAR     ARY           ..                                         FCOR1989
       REM                                                              FCOR1990
       LAC     SLOTNO,1      -USER SLOT NUMBER TO IR1                   FCOR1991
       LXD     P1,3          ACTIVE STATUS TABLE WORD COUNT             FCOR1992
       TXH     USTAT2,3,TBLMIN-1  SKIP IF TABLE SIZE OK                 FCOR1993
       ERROR   3             USTAT ERROR(3), TABLE TOO SMALL            FCOR1994
       REM                                                              FCOR1995
USTAT2 CAL     P1            SET UP ACTIVE FILE STATUS TABLE ADDRESS    FCOR1996
       SLW     USRTBL,1      ..                                         FCOR1997
       PAC     0,2           CLEAR ACTIVE FILE STATUS TABLE             FCOR1998
       STZ     0,2           ..                                         FCOR1999
       TNX     *+2,3,1       ..                                         FCOR2000
       TXI     *-2,2,-1      ..                                         FCOR2001
       LAC     P1,1          -BASE OF A.F.S.T. TO IR1                   FCOR2002
       AXC     1,2                                                      FCOR2003
USTAT3 CAL     P1,2          SET I/O QUEUE ADDRESSES                    FCOR2004
       SLW     QUEUE1,1      ..                                         FCOR2005
       PAC     0,3           .. -BASE OF QUEUE STORAGE TO IR4           FCOR2006
       TXL     *+2,3,0       .. SKIP IF ZERO                            FCOR2007
       STZ     0,3           .. OTHERWISE, RESET FIRST LOCATION IN QUEUEFCOR2008
       TXL     USTAT4,2,-FMAX  ..                                       FCOR2009
       TXI     *+1,1,-1      ..                                         FCOR2010
       TXI     USTAT3,2,-1   ..                                         FCOR2011
USTAT4 TRA     RETURN        AND RETURN                                 FCOR2012
       REM                                                              FCOR2013
       EJECT                                                            FCOR2014
       REM                                                              FCOR2015
       REM     USAVE.(COUNT,ARRAY(N)...N)                               FCOR2016
       REM                                                              FCOR2017
USAVE  SSAVE   (ADR,ARY)                                                FCOR2018
       REM                                                              FCOR2019
       LAC     P2,3          -BASE OF SUPERVISOR BUFFER TO IR3          FCOR2020
       STZ     COUNT         RESET COUNT FOR NO. OF ACTIVE FILES        FCOR2021
       STZ     ANYFIL+1      INITIALIZE SEARCH THROUGH A.F.S.T.         FCOR2022
USAVE1 GTSTAT  ANYFIL,USAVE4 GET ANY ACTIVE FILE ENTRY                  FCOR2023
       PAC     0,2           -BASE OF ENTRY TO IR2                      FCOR2024
       LXD     P2,4          ARRAY COUNT                                FCOR2025
       TXL     USVER3,4,SVWRDS-1  ERROR IF COUNT TOO SMALL              FCOR2026
       TXI     *+1,4,-SVWRDS REDUCE COUNT BY SVWRDS                     FCOR2027
       SXD     P2,4          ..                                         FCOR2028
       CAL     RPROBN,2      MOVE PROBLEM NUMBER                        FCOR2029
       SLW     0,3           ..                                         FCOR2030
       CAL     RPROGN,2      MOVE PROGRAMMER NUMBER                     FCOR2031
       SLW     1,3           ..                                         FCOR2032
       CAL     RNAME1,2      MOVE FILE NAME(1)                          FCOR2033
       SLW     2,3           ..                                         FCOR2034
       CAL     RNAME2,2      MOVE FILE NAME(2)                          FCOR2035
       SLW     3,3           ..                                         FCOR2036
       LDI     RWSTAT,2      GET FILE STATUS (R, W, RW)                 FCOR2037
       ZAC                                                              FCOR2038
       LFT     100000        CHECK FOR READ STATUS                      FCOR2039
       ORA     =HR00000      SET 'R' FOR READ STATUS                    FCOR2040
       LFT     200000        CHECK FOR WRITE STATUS                     FCOR2041
       ORA     =H0W0000      SET 'W' FOR WRITE STATUS                   FCOR2042
       SLW     4,3           MOVE R, W, OR RW TO BUFFER                 FCOR2043
       CAL     RCOUNT,2      PICK UP RECORD WORD COUNT                  FCOR2044
       ANA     =O77777       ..                                         FCOR2045
       ALS     18            .. INTO DECREMENT                          FCOR2046
       SLW     TEMP          SAVE IT                                    FCOR2047
       CAL     BUFADR,2      PICK UP BUFFER ADDRESS IF ANY              FCOR2048
       ANA     =O77777       ..                                         FCOR2049
       TZE     *+2           SKIP IF NO BUFFER ADDRESS PROVIDED         FCOR2050
       ORA     TEMP          BRING BACK RECORD COUNT TO DECR.           FCOR2051
       SLW     5,3           MOVE BUFFER ADDRESS TO BUFFER              FCOR2052
       STZ     6,3           CLEAR OUT SLOTS FOR READ                   FCOR2053
       STZ     7,3           .. AND WRITE ADDRESSES                     FCOR2054
       LDI     R,2           PICK UP READ STATUS IF SPECIFIED           FCOR2055
       LNT     100000        IS READ STATUS ON                          FCOR2056
       TRA     USAVE2        NO, SKIP                                   FCOR2057
       CAL     REDWRD,2      PZE REDWDR,,REDREC                         FCOR2058
       TSX     RECADR,4      COMPUTE LINEAR READ ADDRESS                FCOR2059
       SLW     6,3           MOVE TO BUFFER                             FCOR2060
USAVE2 LDI     W,2           PICK UP WRITE STATUS IF SPECIFIED          FCOR2061
       LNT     200000        IS WRITE STATUS ON                         FCOR2062
       TRA     USAVE3        NO, SKIP                                   FCOR2063
       CAL     WRTWRD,2      PZE WRTWRD,,WRTREC                         FCOR2064
       TSX     RECADR,4      COMPUTE LINNEAR WRITE ADDRESS              FCOR2065
       SLW     7,3           MOVE TO BUFFER                             FCOR2066
USAVE3 LDI     S,2           SET SAVED BIT IN A.F.S.T ENTRY             FCOR2067
       SIL     400000        ..                                         FCOR2068
       STI     S,2           ..                                         FCOR2069
       LXA     COUNT,5       UPDATE COUNT OF NO. OF WORDS SAVED         FCOR2070
       TXI     *+1,5,SVWRDS  .. IN USER ARRAY                           FCOR2071
       SXA     COUNT,5       ..                                         FCOR2072
       TXI     USAVE1,3,-SVWRDS  BACK FOR NEXT ENTRY                    FCOR2073
       REM                                                              FCOR2074
USAVE4 LAC     P1,4          HERE FOR END OF A.F.S.T.                   FCOR2075
       CAL     COUNT         MOVE COUNT OF NO. OF ACTIVE FILES          FCOR2076
       SLW     0,4           .. TO SUPERVISOR BUFFER                    FCOR2077
       TRA     RETURN        AND RETURN                                 FCOR2078
       REM                                                              FCOR2079
USVER3 ERROR   3             USAVE ERROR(3), BUFFER TOO SMALL           FCOR2080
       REM                                                              FCOR2081
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2082
       REM                                                              FCOR2083
       REM     SETAB.(CALLER,BUFFER,MEMORY)                             FCOR2084
       REM                                                              FCOR2085
SETAB  CLA*    1,4           CALLER IF SPECIFIED                        FCOR2086
       TMI     *+2           SKIP IF NOT SPECIFIED                      FCOR2087
       STO     CALL          OTHERWISE SET MEMORY OF CALLER             FCOR2088
       CLA*    2,4           BUFFER IF SPECIFIED                        FCOR2089
       TMI     *+2           SKIP IF NOT SPECIFIED                      FCOR2090
       STO     BUF           OTHERWISE SET USER BUFFER                  FCOR2091
       CLA*    3,4           MEMORY IF SPECIFIED                        FCOR2092
       TMI     *+2           SKIP IF NOT SPECIFIED                      FCOR2093
       STO     MEM           OTHERWISE SET USER MEMORY                  FCOR2094
       TRA     4,4           AND RETURN                                 FCOR2095
       REM                                                              FCOR2096
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2097
       REM                                                              FCOR2098
       REM     GETUSR.(ARY(4)...4)                                      FCOR2099
       REM                                                              FCOR2100
GETUSR CAL     1,4           MUST BE 'TXH  ARY,,N'                      FCOR2101
       PAC     0,5           -BASE ADDRESS TO IR5                       FCOR2102
       PDX     0,6           COUNT TO IR6                               FCOR2103
       CAL     SLOTNO        RETURN DISK USER NO.                       FCOR2104
       SLW     0,5           ..                                         FCOR2105
       TNX     GETUS1,6,1    REDUCE COUNT                               FCOR2106
       CAL     CALL          MEMORY FLAG FOR 'CALLER'                   FCOR2107
       SLW     1,5           ..                                         FCOR2108
       TNX     GETUS1,6,1    ..                                         FCOR2109
       CAL     BUF           MEMORY FLAG FOR 'BUFFER'                   FCOR2110
       SLW     2,5           ..                                         FCOR2111
       TNX     GETUS1,6,1    ..                                         FCOR2112
       CAL     MEM           MEMORY FLAG FOR 'MEMORY'                   FCOR2113
       SLW     3,5           ..                                         FCOR2114
GETUS1 TRA     2,4           RETURN                                     FCOR2115
       REM                                                              FCOR2116
       EJECT                                                            FCOR2117
       REM                                                              FCOR2118
       REM     IOSTOP.(SLOTNO)                                          FCOR2119
       REM                                                              FCOR2120
IOSTOP SSAVE   (SPM)                                                    FCOR2121
       REM                                                              FCOR2122
       LXA     P1,4          SLOT NUMBER OF USER TO BE STOPPED          FCOR2123
       TXL     STOP1,4,DUSERS  SKIP IF SLOT NUMBER IS LEGAL             FCOR2124
       ERROR   3             IOSTOP ERROR(3), ILLEGAL USER SLOT NO.     FCOR2125
       REM                                                              FCOR2126
STOP1  TSX     IOHALT,4      STOP ALL I/O FOR THIS USER                 FCOR2127
       PAR     P1            .. ON ALL DEVICES                          FCOR2128
       TRA     RETURN        AND RETURN                                 FCOR2129
       REM                                                              FCOR2130
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2131
       REM                                                              FCOR2132
       REM     IOSTRT.(SLOTNO)                                          FCOR2133
       REM                                                              FCOR2134
IOSTRT SSAVE   (SPM)                                                    FCOR2135
       REM                                                              FCOR2136
       LXA     P1,4          SLOT NUMBER OF USER TO BE STARTED          FCOR2137
       TXL     START1,4,DUSERS  SKIP IF SLOT NUMBER IS LEGAL            FCOR2138
       ERROR   3             IOSTRT ERROR(3), ILLEGAL USER SLOT NO.     FCOR2139
       REM                                                              FCOR2140
START1 TSX     IOBEGN,4      RESTART ANY WAITING I/O FOR THIS USER      FCOR2141
       PAR     P1            .. ON ALL DEVICES                          FCOR2142
       TRA     RETURN        AND RETURN                                 FCOR2143
       REM                                                              FCOR2144
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *     FCOR2145
       REM                                                              FCOR2146
       REM     IORSET.                                                  FCOR2147
       REM                                                              FCOR2148
IORSET SSAVE   ()                                                       FCOR2149
       REM                                                              FCOR2150
       TSX     IORST,4       INFORM I/O CONTROL OF MACHINE RESET        FCOR2151
       TRA     RETURN                                                   FCOR2152
       REM                                                              FCOR2153
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2154
       REM                                                              FCOR2155
       REM     IOFINI.                                                  FCOR2156
       REM                                                              FCOR2157
IOFINI SSAVE   ()                                                       FCOR2158
       REM                                                              FCOR2159
       LAC     UTABLE,1                                                 FCOR2160
       TSX     IOBEGN,4      INSURE I/O IS NOT BLOCKED                  FCOR2161
       PAR     =0            ..                                         FCOR2162
       TSX     DRAIN,4       WAIT UNTIL ALL PENDING I/O IS PROCESSED    FCOR2163
       TSX     UPDSYS,4      UPDATE ALL SYSTEM INFORMATION              FCOR2164
       PAR     FINMER        .. POSSIBLE ERROR RETURN                   FCOR2165
       TSX     DRAIN,4       AND WAIT ON I/O AGAIN                      FCOR2166
       TRA     RETURN        AND RETURN                                 FCOR2167
       REM                                                              FCOR2168
FINMER ERROR   3             IOFINI ERROR(3), MACHINE OR SYSTEM ERROR   FCOR2169
       REM                                                              FCOR2170
       EJECT                                                            FCOR2171
       REM                                                              FCOR2172
       REM     .......... INTIALIZATION ENTRY FOR FILE SYSTEM ......... FCOR2173
       REM                                                              FCOR2174
       REM     IOINIT.(ERRLOC,DATLOC,TIMLOC,ENABLE)                     FCOR2175
       REM                                                              FCOR2176
IOINIT SSAVE   (ADR,ADR,ADR,ADR)                                        FCOR2177
       REM                                                              FCOR2178
       CAL     P1            SET UP LOCATION OF SUPERVISOR ERROR RETURN FCOR2179
       STA     ERRLOC        ..                                         FCOR2180
       CAL     P2            SET UP LOCATION OF DATE                    FCOR2181
       STA     DATLOC        ..                                         FCOR2182
       CAL     P3            SET UP LOCATION OF TIME IN 60THS           FCOR2183
       STA     TIMLOC        ..                                         FCOR2184
       CAL     P4            SET UP LOCATION OF COMMON ENABLE WORD      FCOR2185
       STA     ENABLE        ..                                         FCOR2186
       AXC     1,3                                                      FCOR2187
INIT1  XEC     SINITF,3      INITIALIZE ALL STRATEGY MODULES            FCOR2188
       PAR     ENABLE        ..                                         FCOR2189
       TXL     *+2,3,-FMAX   ..                                         FCOR2190
       TXI     INIT1,3,-1    ..                                         FCOR2191
       AXC     1,3           INITIALIZE ALL OTHER MODULES               FCOR2192
INIT2  XEC     SETMOD,3      ..                                         FCOR2193
       PAR     FRSTER,,FRSTER ERR. RTN. FOR 'IFILES'                    FCOR2194
       TXL     *+2,3,-NINIT  ..                                         FCOR2195
       TXI     INIT2,3,-1    ..                                         FCOR2196
       TRA     RETURN        AND RETURN                                 FCOR2197
       REM                                                              FCOR2198
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2199
       REM                                                              FCOR2200
       REM     ....... END OF MAIN SECTION OF FILE COORDINATOR .........FCOR2201
       REM     ....... UTILITY ROUTINES FOLLOW                          FCOR2202
       REM                                                              FCOR2203
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2204
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2205
       EJECT                                                            FCOR2206
       REM                                                              FCOR2207
       REM     SSAVE AND SAVE ..... SAVE AND PICK UP PARAMETERS         FCOR2208
       REM                                                              FCOR2209
SSAVE  STI     SVSI          HERE FROM ENTRY FROM SUPERVISOR            FCOR2210
       LDI     HOME          PICK UP 'HOME' POINTER                     FCOR2211
       STI     GTCALL        SET UP TO GET ALL PARAMETERS               FCOR2212
       STI     GTMEM         .. FROM 'HOME' MEMORY                      FCOR2213
       STI     GTBUF         ..                                         FCOR2214
       TRA     SAVE1                                                    FCOR2215
       REM                                                              FCOR2216
SAVE   STI     SVSI          HERE FROM NORMAL ENTRY TO FILE SYSTEM      FCOR2217
       LDI     CALL          POINTER TO CALLING MEMORY                  FCOR2218
       STI     GTCALL        SET TO GET CALLING SEQUENCE                FCOR2219
       LDI     MEM           SET TO GET DATA AND CHECK LIMITS           FCOR2220
       STI     GTMEM         ..                                         FCOR2221
       LDI     BUF           SET TO CHECK BUFFER ADDRESSES              FCOR2222
       STI     GTBUF         ..                                         FCOR2223
       REM                                                              FCOR2224
SAVE1  ENB*    ENABLE        INSURE ALL TRAPS ENABLED                   FCOR2225
       SXA     TMPIR4,4                                                 FCOR2226
       REM                                                              FCOR2227
       SXA     SVIR12,1      SAVE BASIC MACHINE CONDITIONS              FCOR2228
       SXD     SVIR12,2                                                 FCOR2229
       SXA     SVIR35,3                                                 FCOR2230
       SXD     SVIR35,5                                                 FCOR2231
       SXA     SVIR67,6                                                 FCOR2232
       SXD     SVIR67,7                                                 FCOR2233
       CAL*    1,4           PICK UP NAME OF ENTRY CALLED               FCOR2234
       SLW     IOCALL        .. SAVE IT                                 FCOR2235
       STZ     FILNAM        RESET PREVIOUS FILE NAME                   FCOR2236
       STZ     FILNAM+1      ..                                         FCOR2237
       CAL     GTCALL        MEMORY CONTAINING CALLING SEQUENCE         FCOR2238
       ANA     =O3           .. (1-3)                                   FCOR2239
       PAC     0,1                                                      FCOR2240
       CAL     ICFLAG,1      PICK UP MEMORY FLAGS FOR ILC               FCOR2241
       SLW     ILC           ..                                         FCOR2242
       CAL     SETMEM,1      PICK UP ECC CONTROL INSTRUCTION FOR        FCOR2243
       SLW     PARMEM        .. USER'S MEMORY                           FCOR2244
       LAC     IR4,4         GET LOCATION OF CALLING SEQUENCE           FCOR2245
       SXA     ILC,4         .. SAVE AS USER ILC                        FCOR2246
       CAL     ILC           INITIALIZE RETURN ILC                      FCOR2247
       SLW     RTNILC        ..                                         FCOR2248
       CAL     ERRLOC        SET UP FOR ERROR IN CASE NO ERROR RETURN   FCOR2249
       ORA     ICFLAG+IOSMEM .. PROVIDED                                FCOR2250
       SLW     ERRTRN        ..                                         FCOR2251
       REM                                                              FCOR2252
       LXA     TMPIR4,1      -LOC. OF CALL TO SAVE TO IR1               FCOR2253
       LXA     IR4,2         -LOC. OF CALL TO FILE COORDINATOR TO IR2   FCOR2254
       AXC     1,3           INITIALIZE POINTER TO PARAMETER TABLE      FCOR2255
       STZ     NOPAR                                                    FCOR2256
SAVE3  ZET     NOPAR         IS PARAMETER LIST EXHAUSTED                FCOR2257
       TRA     SAVE4         YES, SKIP                                  FCOR2258
       CAL     RTNILC        NO, INCREASE RETURN ADDRESS                FCOR2259
       ADD     =1            ..                                         FCOR2260
       STA     RTNILC        ..                                         FCOR2261
       GETPAR  (1,2)         PICK UP NEXT WORD FROM CALL                FCOR2262
       SLW     P0            ..                                         FCOR2263
       TSX     CHKPAR,4      CHECK FOR VALID PARAMETER                  FCOR2264
       STL     NOPAR         .. SET SWITCH IF END OF PARAMETER LIST     FCOR2265
SAVE4  CAL     4,1           PICK UP TYPE OF ARGUMENT FROM PROTOTYPE    FCOR2266
       TSX     CHKPAR,4      CHECK FOR END OF PROTOTYPE                 FCOR2267
       TRA     SVERTN        .. SKIP TO GET ERROR RETURN AT END         FCOR2268
       SXA     TMPIR1,1      SAVE IR1                                   FCOR2269
       PAC     0,4           ADDRESS OF SECTION NEEDED TO GET PARAMETER FCOR2270
       TRA     0,4           DISPATCH ON EXPECTED PARAMETER TYPE        FCOR2271
       REM                                                              FCOR2272
FN     ZET     NOPAR         HERE TO PICK FILE NAME                     FCOR2273
       TRA     SAVER1        ERROR IF FILE NAME MISSING                 FCOR2274
       LAC     P0,1          GET FILE NAME(1) FROM USER'S MEMORY        FCOR2275
       GETPAR  (0,1)         ..                                         FCOR2276
       SLW     P0,3          ..                                         FCOR2277
       SLW     FILNAM        ..                                         FCOR2278
       ERA     NULPAR        INSURE FILE NAME NOT NULL                  FCOR2279
       TZE     SAVER1        .. ERROR IF NULL FILE NAME(1)              FCOR2280
       TXI     *+1,2,-1      BUMP POINTER TO USER'S CALLING SEQUENCE    FCOR2281
       TXI     *+1,3,-1      BUMP POINTER TO PARAMETER LIST             FCOR2282
       GETPAR  (1,2)         PICK UP NEXT PARAMETER FROM CALL           FCOR2283
       SLW     P0            ..                                         FCOR2284
       TSX     CHKPAR,4      CHECK FOR VALID PARAMETER                  FCOR2285
       TRA     SAVER1        .. ERROR IF NO SECOND FILE NAME GIVEN      FCOR2286
       LAC     P0,1          GET FILE NAME(2) FROM USER'S MEMORY        FCOR2287
       GETPAR  (0,1)         ..                                         FCOR2288
       SLW     P0,3          ..                                         FCOR2289
       SLW     FILNAM+1      ..                                         FCOR2290
       ERA     NULPAR        INSURE FILE NAME(2) NOT NULL               FCOR2291
       TZE     SAVER1        .. ERROR IF NULL FILE NAME(2)              FCOR2292
       NZT     FILNAM        ALSO ERROR (FOR SEARCH MODULE)             FCOR2293
       ZET     FILNAM+1      IF BOTH FILE NAMES ARE ZERO                FCOR2294
       TXI     SAVE5,3,-1    BUMP PARAMETER LIST COUNT                  FCOR2295
       TRA     SAVER1        SEQUENCE ERROR, BOTH FILE NAMES ZERO       FCOR2296
       REM                                                              FCOR2297
SP     CAL     NULPAR        HERE TO PICK UP OPTIONAL PARAMETER         FCOR2298
       SLW     P0,3          NULL PARAMETER IN CASE PARAMETER MISSING   FCOR2299
       ZET     NOPAR         HAS A PARAMETER BEEN SPECIFIED             FCOR2300
       TXI     SAVE5,3,-1    NO, SKIP                                   FCOR2301
       LAC     P0,1          PICK UP PARAMETER FROM USER'S MEMORY       FCOR2302
       GETPAR  (0,1)         ..                                         FCOR2303
       SLW     P0,3          ..                                         FCOR2304
       TXI     SAVE5,3,-1    BUMP PARAMETER LIST COUNT                  FCOR2305
       REM                                                              FCOR2306
SPM    ZET     NOPAR         HERE TO PICK UP MANDITORY PARAMETER        FCOR2307
       TRA     SAVER1        ERROR IF PARAMETER NOT SPECIFIED           FCOR2308
       LAC     P0,1          PICK UP PARAMETER FROM USER'S MEMORY       FCOR2309
       GETPAR  (0,1)         ..                                         FCOR2310
       SLW     P0,3          ..                                         FCOR2311
       ERA     NULPAR        CHECK FOR NULL PARAMETER                   FCOR2312
       TZE     SAVER1        ERROR IF NULL                              FCOR2313
       TXI     SAVE5,3,-1    BUMP PARAMETER LIST COUNT                  FCOR2314
       REM                                                              FCOR2315
ARY    CAL     GTCALL        HERE TO PICK UP ARRAY FROM 'CALL'          FCOR2316
       TRA     GETARY        ..                                         FCOR2317
       REM                                                              FCOR2318
MARY   CAL     GTMEM         HERE TO PICK UP ARRAY FROM 'MEM'           FCOR2319
       TRA     GETARY        ..                                         FCOR2320
       REM                                                              FCOR2321
BARY   CAL     GTBUF         HERE TO PICK UP ARRAY FROM 'BUF'           FCOR2322
       REM                                                              FCOR2323
GETARY SLW     TMEM          SAVE MEMORY POINTER                        FCOR2324
       ZET     NOPAR         CHECK IF ARRAY SPECIFIED IN CALL           FCOR2325
       TRA     SAVER1        ERROR IF ARRAY NOT SPECIFIED               FCOR2326
       CAL     P0            GET PARAMETER                              FCOR2327
       PAI                   INTO INDICATORS ALSO                       FCOR2328
       LFT     100000        IS PARAMETER SPECIFIED BY 'TIX'            FCOR2329
       TRA     GTARY1        NO, ASSUME TXH A,,N NOTATION               FCOR2330
       ANA     =O77777       YES, SET BASE ADDRESS OF ARRAY             FCOR2331
       SLW     P0,3          .. MODULO 2.P.15                           FCOR2332
       LDC     P0,1          GET -ADDRESS OF WORD COUNT                 FCOR2333
       GETPAR  (0,1)         PICK UP ARRAY WORD COUNT                   FCOR2334
       ANA     =O77777       .. MODULO 2.P.15                           FCOR2335
       ALS     18            .. COUNT TO DECREMENT                      FCOR2336
       STD     P0,3          SET ARRAY WORD COUNT                       FCOR2337
       TRA     GTARY2        SKIP TO CHECK ARRAY LIMITS                 FCOR2338
       REM                                                              FCOR2339
GTARY1 ANA     =O77777077777 HERE FOR TXH A,,N NOTATION, RESET PREFIX   FCOR2340
       SLW     P0,3          .. AND TAG, AND SET IN PARAMETER LIST      FCOR2341
GTARY2 CAL     P0,3          RELOAD ARRAY SPECIFICATION                 FCOR2342
       TSX     RCHECK,4      RELOCATE AND CHECK LIMITS                  FCOR2343
       PAR     SAVER1,,TMEM  ..                                         FCOR2344
       TXI     SAVE5,3,-1    BUMP PARAMETER LIST COUNT                  FCOR2345
       REM                                                              FCOR2346
ADR    CAL     NULPAR        HERE TO SET OPTIONAL ADDRESS PARAMETER     FCOR2347
       SLW     P0,3          NULL ADDRESS IN CASE ADDRESS MISSING       FCOR2348
       ZET     NOPAR         HAS THE ADDRESS PARAMETER BEEN SPECIFIED   FCOR2349
       TXI     SAVE5,3,-1    NO, SKIP                                   FCOR2350
       LAC     P0,1          -ADDRESS TO IR1                            FCOR2351
       GETPAR  (0,1)         PICK UP WORD AT THIS ADDRESS               FCOR2352
       ERA     NULPAR        CHECK FOR NULL PARAMETER                   FCOR2353
       TNZ     *+2           SKIP IF NOT A NULL PARAMETER               FCOR2354
       TXI     SAVE5,3,-1    OTHERWISE BUMP PARAMETER LIST COUNT        FCOR2355
       CAL     P0            HERE TO SET UP ADDRESS PARAMETER           FCOR2356
       ANA     =O77777       .. MODULE 2.P.15                           FCOR2357
       SLW     P0,3          .. IN PARAMETER LIST TABLE                 FCOR2358
       TXI     SAVE5,3,-1    BUMP PARAMETER LIST COUNT                  FCOR2359
       REM                                                              FCOR2360
SAVE5  LXA     TMPIR1,1      RELOAD IR1 TO POINT TO SAVE CALL           FCOR2361
       TXI     *+1,2,-1      BUMP POINTER TO USER'S CALLING SEQ.        FCOR2362
       TXI     SAVE3,1,-1    GET PARAMETER FROM SAVE CALL               FCOR2363
       REM                                                              FCOR2364
SVERTN CAL     NULPAR        HERE FOR END OF PROTOTYPE CALL TO SAVE     FCOR2365
       SLW     ERWORD        NULL ERROR WORD IN CASE NONE SPECIFIED     FCOR2366
       SXD     TMPIR4,1      SAVE POINTER TO END OF CALL TO SAVE        FCOR2367
       ZET     NOPAR         DID USER SPECIFY AN ERROR RETURN           FCOR2368
       TRA     SAVE6         NO, SKIP                                   FCOR2369
       CAL     P0            YES, SET UP USER ERROR RETURN              FCOR2370
       ANA     =O77777       .. MODULO 2.P.15                           FCOR2371
       SLW     ERRTRN        ..                                         FCOR2372
       LDQ     RTNILC        SET UP MEMORY FLAGS IN CASE OF ERROR       FCOR2373
       SLQ     ERRTRN        ..                                         FCOR2374
       CAL     RTNILC        BUMP RETURN LOCATION                       FCOR2375
       ADD     =1            ..                                         FCOR2376
       STA     RTNILC        ..                                         FCOR2377
       GETPAR  (2,2)         PICK UP ERROR CODE RETURN WORD IF ANY      FCOR2378
       SLW     P0            ..                                         FCOR2379
       TSX     CHKPAR,4      CHECK FOR ERROR CODE WORD PARAMETER        FCOR2380
       TRA     SAVE6         .. SKIP IF ERROR CODE WORD NOT PROVIDED    FCOR2381
       CAL     P0            SET UP ADDRESS TO RETURN ERROR CODE        FCOR2382
       ANA     =O77777       .. IN CASE OF ERROR RETURN                 FCOR2383
       SLW     ERWORD        ..                                         FCOR2384
       CAL     RTNILC        BUMP RETURN LOCATION                       FCOR2385
       ADD     =1            ..                                         FCOR2386
       STA     RTNILC        ..                                         FCOR2387
       REM                                                              FCOR2388
SAVE6  LXA     TMPIR4,4      RELOAD IR4 FROM CALL TO SAVE OR SSAVE      FCOR2389
       LAC     UTABLE,1      -BASE OF USER A.F.S.T. TO IR1              FCOR2390
       LDI     URCODE,1      PICK UP USER RESTRICTION CODE              FCOR2391
       ONT*    2,4           IS USER PRIVELEGED TO USE THIS ENTRY       FCOR2392
       TRA     SAVER2        NO, ERROR                                  FCOR2393
       NZT*    3,4           YES, DOES USER NEED TO BE SIGNED ON        FCOR2394
       TRA     SAVE7         NO, SKIP                                   FCOR2395
       NZT     PROBNO,1      YES, INSURE USER IS SIGNED ON              FCOR2396
       TRA     SAVER2        ERROR IF USER NOT SIGNED ON                FCOR2397
SAVE7  LXD     TMPIR4,4      RELOAD IR4 SAVED AT END OF SAVE CALL       FCOR2398
       TRA     4,4           AND RETURN                                 FCOR2399
       REM                                                              FCOR2400
SAVER1 ERROR   1             SAVE ERROR(1), BAD CALLING SEQUENCE        FCOR2401
       REM                                                              FCOR2402
SAVER2 ERROR   2             SAVE ERROR(2), ILLEGAL USE OF CALL         FCOR2403
       REM                                                              FCOR2404
       REM     CHKPAR ...... DETERMINE IF WORD IN AC IS A PARAMETER     FCOR2405
       REM     ............. USED BY SAVE AND SSAVE ONLY ..........     FCOR2406
       REM                                                              FCOR2407
CHKPAR PAI                   SAVE WORD IN SI                            FCOR2408
       ANA     =O600000700000  REMOVE ALL BUT PREFIX AND TAG            FCOR2409
       ERA     =O200000000000  CHECK FOR TIX OR TXH WITH NO TAG         FCOR2410
       TNZ     1,4           RETURN 1,4 IF WORD NOT A PARAMETER         FCOR2411
       PIA                   OTHERWISE RESTORE PARAMETER TO AC          FCOR2412
       TRA     2,4           AND RETURN 2,4                             FCOR2413
       REM                                                              FCOR2414
       EJECT                                                            FCOR2415
       REM                                                              FCOR2416
       REM     RETURN .......... NORMAL RETURN TO USER AT RTNILC        FCOR2417
       REM                                                              FCOR2418
RETURN TSX     RESTOR,4      HERE FOR NORMAL RETURN TO USER             FCOR2419
       EXIT    IR4,RTNILC    RETURN THROUGH COMMON EXIT ROUTINE         FCOR2420
       REM                                                              FCOR2421
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2422
       REM                                                              FCOR2423
       REM     QWAIT ......... HERE IF USER INPUT/OUTPUT ROADBLOCKED    FCOR2424
       REM                                                              FCOR2425
QWAIT  TSX     RESTOR,4      RESTORE USER'S MACHINE STATUS              FCOR2426
       SSTRAP  6,IR4,ILC,0,0 INTERRUPT SUPERVISORY SYSTEM               FCOR2427
       ENB*    ENABLE        REENABLE AFTER SIMULATED TRAP              FCOR2428
       EXIT    IR4,ILC       EXIT TO USER AT 0,4                        FCOR2429
       REM                                                              FCOR2430
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2431
       REM                                                              FCOR2432
       REM     RESTOR ..... RESTORE USER MACHINE CONDITIONS             FCOR2433
       REM                                                              FCOR2434
RESTOR LXA     SVIR12,1      RELOAD USER'S IRS 1-3                      FCOR2435
       LXD     SVIR12,2      ..                                         FCOR2436
       LXA     SVIR35,3      ..                                         FCOR2437
       LXD     SVIR35,5      ..                                         FCOR2438
       LXA     SVIR67,6      ..                                         FCOR2439
       LXD     SVIR67,7      ..                                         FCOR2440
       LDI     SVSI          AND SI                                     FCOR2441
       TRA     1,4                                                      FCOR2442
       REM                                                              FCOR2443
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2444
       REM                                                              FCOR2445
       REM     SETEOF ...... SET RETURN ON EOF FROM READ OR WRITE       FCOR2446
       REM                                                              FCOR2447
SETEOF SLW     TEMP          SAVE EOF COUNT                             FCOR2448
       CLA     P5            EOF RETURN IF SPECIFIED                    FCOR2449
       TMI     *+2           SKIP IF NOT SPECIFIED                      FCOR2450
       STA     RTNILC        OTHERWISE SET UP EOF RETURN                FCOR2451
       CLA     P6            'EOFCT' IF SPECIFIED                       FCOR2452
       TMI     1,4           RETURN IF EOFCT NOT SPECIFIED              FCOR2453
       SXA     SEOF34,3                                                 FCOR2454
       SXD     SEOF34,4                                                 FCOR2455
       LAC     P6,3          RETURN EOF COUNT TO USER                   FCOR2456
       MOVE1   HOME,TEMP,CALL,(0,3),STEOF1  ..                          FCOR2457
STEOF1 LXA     SEOF34,3      AND RETURN                                 FCOR2458
       LXD     SEOF34,4      ..                                         FCOR2459
       TRA     1,4           ..                                         FCOR2460
       REM                                                              FCOR2461
       EJECT                                                            FCOR2462
       REM                                                              FCOR2463
       REM     SSTRAP ....... ROUTINE TO INTERRUPT SUPERVISORY SYSTEM ..FCOR2464
       REM                                                              FCOR2465
SSTRAP ENB     =0            INSURE ALL TRAPS DISABLED                  FCOR2466
       TTR*    SSCALL        AND CALL SUPERVISOR INTERRUPT PROCEDURE    FCOR2467
       REM                                                              FCOR2468
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2469
       REM                                                              FCOR2470
       REM     ERROR/IOERR ....... STANDARD ERROR ROUTINES .......      FCOR2471
       REM                                                              FCOR2472
ERROR  CAL     =0            HERE FOR NORMAL ERROR RESET I/O CODE       FCOR2473
       TRA     ERROR1        ..                                         FCOR2474
       REM                                                              FCOR2475
IOERR  CAL     EFLAG,2       HERE FOR I/O ERROR SET I/O ERROR CODE      FCOR2476
       ARS     15            .. FROM TAG OF EFLAG,2                     FCOR2477
       ANA     =O7           .. MODULO 2.P.3                            FCOR2478
       STT     EFLAG,2       .. RESET ERROR CONDITION                   FCOR2479
       REM                                                              FCOR2480
ERROR1 LAC     UTABLE,1      INSURE -BASE OF USER TABLE IN IR1          FCOR2481
       SLW     IOCODE,1      SAVE INPUT/OUTPUT ERROR CODE IF ANY        FCOR2482
       CAL     ILC           SAVE USER ILC AT TIME OF CALL              FCOR2483
       SLW     ERRILC,1      ..                                         FCOR2484
       CAL     IOCALL        SAVE NAME OF ENTRY CALLED                  FCOR2485
       SLW     ERNAME,1      ..                                         FCOR2486
       PCA     0,4           SAVE LOCATION OF CALL TO ERROR (XEC ERR'N')FCOR2487
       SLW     ERCALL,1      ..                                         FCOR2488
       CAL     0,4           PICK UP 'XEC' INSTRUCTION                  FCOR2489
       PAC     0,4           -ADDRESS OF TSX TO IR4                     FCOR2490
       CAL     1,4           PICK UP ERROR CODE                         FCOR2491
       ANA     =O77777       .. MODULO 2.P.15                           FCOR2492
       SLW     ERCODE,1      .. SAVE IT                                 FCOR2493
       CAL     FILNAM        SAVE FILE NAME IF ANY                      FCOR2494
       SLW     ENAME1,1      ..                                         FCOR2495
       CAL     FILNAM+1      ..                                         FCOR2496
       SLW     ENAME2,1      ..                                         FCOR2497
       CLA     ERWORD        GET LOCATION OF ERROR WORD IF PROVIDED     FCOR2498
       TMI     ERROR2        SKIP IF NOT SPECIFIED                      FCOR2499
       PAC     0,2           -ADDRESS TO IR2                            FCOR2500
       MOVE1   HOME,(ERCODE,1),GTCALL,(0,2),*+1  MOVE ERROR CODE TO USERFCOR2501
ERROR2 TSX     RESTOR,4      RESTORE USER'S MACHINE STATUS              FCOR2502
       EXIT    IR4,ERRTRN    AND TAKE ERROR EXIT                        FCOR2503
       REM                                                              FCOR2504
       EJECT                                                            FCOR2505
       REM                                                              FCOR2506
       REM     GTDYTM ..... CONVERT DATE AND TIME TO I/O SYSTEM FORMAT  FCOR2507
       REM                                                              FCOR2508
GTDYTM SXA     GETMX4,4                                                 FCOR2509
       CAL*    DATLOC        GET CURRENT 'MMDDYY'                       FCOR2510
       ANA     =O171717171717  MASK TO INSURE DIGITS ONLY               FCOR2511
       XCL                   REMOVE FROM MQ 2 CHARS. EACH TIME          FCOR2512
       TSX     BCBN2,4       CONVERT FIRST TWO CHARS                    FCOR2513
       ANA     =O17          MONTH IN BINARY (4 BITS)                   FCOR2514
       ALS     18+5          SHIFT MONTH TO DECR., SAVE ROOM FOR DAY    FCOR2515
       SLW     DATE          ..                                         FCOR2516
       TSX     BCBN2,4       NOW CONVERT DD                             FCOR2517
       ANA     =O37          DAY IN BINARY (5 BITS)                     FCOR2518
       ALS     18            DAY TO DECREMENT                           FCOR2519
       ORS     DATE          ADD DAY TO MONTH                           FCOR2520
       TSX     BCBN2,4       FINALLY, YY                                FCOR2521
       ANA     =O777         YEAR IN BINARY (9 BITS)                    FCOR2522
       ALS     18+9          SHIFT TO POSITION                          FCOR2523
       ORS     DATE          DATE= YEAR(9BITS), MONTH(4BITS), DAY(5BITS)FCOR2524
       LDQ*    TIMLOC        PICK UP TIME OF DAY IN 60THS OF A SECOND   FCOR2525
       ZAC                   INSURE AC ZERO                             FCOR2526
       DVP     =60           GET TIME IN SECONDS                        FCOR2527
       XCL                   .. TIME TO AC                              FCOR2528
       ORA     DATE          YEAR, MONTH, DAY, TIME IN LOGICAL AC       FCOR2529
       LXA     GETMX4,4      RETURN TO CALLER                           FCOR2530
       TRA     1,4           ..                                         FCOR2531
       REM                                                              FCOR2532
BCBN2  ZAC                   CONVERT TWO BCD CHARS FROM MQ              FCOR2533
       LGL     6             GUARANTEED NO ZONE BITS                    FCOR2534
       SLW     TNUM          CALLED ONLY FROM 'GTDYTM'                  FCOR2535
       ZAC                   CLEAR AC FOR 2ND CHAR.                     FCOR2536
       LGL     3             ..                                         FCOR2537
       ADM     TNUM          ..                                         FCOR2538
       LGL     3             ..                                         FCOR2539
       ADM     TNUM          ..                                         FCOR2540
       ACL     TNUM          ..                                         FCOR2541
       TRA     1,4           FINIS                                      FCOR2542
       REM                                                              FCOR2543
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2544
       REM                                                              FCOR2545
       REM     GETDAY ..... PICK UP DATE IN BCD, RETURN IN AC ......    FCOR2546
       REM                                                              FCOR2547
GETDAY CAL*    DATLOC        DATE TO LOGICAL AC                         FCOR2548
       LDQ*    TIMLOC        TIME IN 60THS TO MQ                        FCOR2549
       TRA     1,4           RETURN                                     FCOR2550
       REM                                                              FCOR2551
       EJECT                                                            FCOR2552
       REM                                                              FCOR2553
       REM     CKLINK ....... ROUTINE TO CHECK AND FIND LINKED FILE     FCOR2554
       REM                                                              FCOR2555
CKLINK LDI     MODE,2        SET MODE AS RMODE                          FCOR2556
       RIS     =O1777777777  .. RESETING ALL BUT MODE BITS              FCOR2557
       STI     RMODE,2       ..                                         FCOR2558
       CAL     F,2           CHECK FOR 'LINKED' FILE                    FCOR2559
       ANA     =O700000      ..                                         FCOR2560
       TNZ     2,4           IGNORE IF NORMAL FILE                      FCOR2561
       SIL     001000        SET LINK BIT IN RMODE                      FCOR2562
       STI     RMODE,2       ..                                         FCOR2563
       SXA     CKLX34,3      HERE IF FILE IS A 'LINKED' FILE            FCOR2564
       SXD     CKLX34,4                                                 FCOR2565
       AXT     LDEPTH,3      MAXIMUM DEPTH FOR 'LINKED' FILES           FCOR2566
CKLNK1 CHKUFD  (LPROBN,2),CKLNK3 SEE IF UFD EXISTS                      FCOR2567
       SEARCH  (LPROBN,2),(LNAME1,2),CKLERR UFD EXISTS, DOES FILE EXIST FCOR2568
       CAL     MODE,2        PICK UP MODE OF THIS FILE                  FCOR2569
       ANA     =O776000000000 MASK AWAY ALL BUT MODE BITS               FCOR2570
       ORS     RMODE,2       AND ADD TO EFFECTIVE FILE MODE             FCOR2571
       CAL     F,2           CHECK FOR FURTHER LINKING                  FCOR2572
       ANA     =O700000      ..                                         FCOR2573
       TNZ     CKLNK2        SKIP WHEN NORMAL FILE FOUND                FCOR2574
       TIX     CKLNK1,3,1    OTHERWISE TRY TO LINK AGAIN                FCOR2575
CKLNK3 LXD     CKLX34,4      HERE FOR TARGET U.F.D. NOT FOUND           FCOR2576
       LXA     CKLX34,3      OR LINK DEPTH EXCEEDED                     FCOR2577
       CAL     1,4           PICK UP PARAMETERS                         FCOR2578
       PDC     ,7            ERROR RETURN                               FCOR2579
       TRA     0,7           LINKAGE DEPTH EXCEEDED                     FCOR2580
       REM                                                              FCOR2581
CKLERR LXD     CKLX34,4      HERE IF 'LINKED' FILE NOT FOUND            FCOR2582
       LXA     CKLX34,3      .. TAKE ERROR RETURN                       FCOR2583
       TRA*    1,4           ..                                         FCOR2584
       REM                                                              FCOR2585
CKLNK2 LXD     CKLX34,4      HERE ON COMPLETED LINK                     FCOR2586
       LXA     CKLX34,3      .. RETURN                                  FCOR2587
       TRA     2,4           ..                                         FCOR2588
       REM                                                              FCOR2589
       EJECT                                                            FCOR2590
       REM                                                              FCOR2591
       REM     STAFIL ...... ENTER ACTIVE FILE FOR SLOT '0'             FCOR2592
       REM                                                              FCOR2593
STAFIL SXA     STAFLX,4                                                 FCOR2594
       TSX     CSTAT0,4      FIND ROOM FOR ENTRY                        FCOR2595
       PAR     STAERR        .. ERROR, NO ROOM IN A.F.S.T.              FCOR2596
       SLW     STATMP        SAVE BASE ADDRESS OF SLOT IN A.F.S.T.      FCOR2597
       PAC     0,7           -BASE OF ENTRY TO IR7                      FCOR2598
       LXA     STAFLX,4      RELOAD CALLER'S IR4                        FCOR2599
       CAL     1,4           GET POINTER TO FILE ENTRY                  FCOR2600
       TSX     GETEFA,4      COMPUTE EFFECTIVE ADDRESS                  FCOR2601
       PAC     0,6           -BASE OF FILE ENTRY TO IR6                 FCOR2602
       AXT     9,5                                                      FCOR2603
STAFL1 CAL     0,6           MOVE FILE ENTRY TO A.F.S.T.                FCOR2604
       SLW     FPROBN,7      ..                                         FCOR2605
       TNX     STAFL2,5,1    ..                                         FCOR2606
       TXI     *+1,6,-1      ..                                         FCOR2607
       TXI     STAFL1,7,-1   ..                                         FCOR2608
STAFL2 LAC     STATMP,5      FILL IN RPROBN-RPROGN AND RNAME1-RNAME2    FCOR2609
       CLA     FPROBN,5      ..                                         FCOR2610
       LDQ     FPROGN,5      ..                                         FCOR2611
       DST     RPROBN,5      ..                                         FCOR2612
       CLA     FNAME1,5      ..                                         FCOR2613
       LDQ     FNAME2,5      ..                                         FCOR2614
       DST     RNAME1,5      ..                                         FCOR2615
       CAL     MODE,5        SET UP RMODE TO BE SAME AS MODE            FCOR2616
       SLW     RMODE,5       ..                                         FCOR2617
       LXA     STAFLX,4      AND RETURN TO CALLER                       FCOR2618
       CAL     STATMP        .. WITH BASE OF ENTRY IN A.F.S.T. IN AC    FCOR2619
       TRA     3,4           ..                                         FCOR2620
       REM                                                              FCOR2621
STAERR LXA     STAFLX,4      HERE IF NO ROOM IN A.F.S.T.                FCOR2622
       TRA*    2,4           TAKE ERROR RETURN                          FCOR2623
       REM                                                              FCOR2624
       EJECT                                                            FCOR2625
       REM                                                              FCOR2626
       REM     CKSTAT/CSTAT0 ...... FIND ROOM FOR NEW ENTRY IN A.F.S.T. FCOR2627
       REM                                                              FCOR2628
CSTAT0 LAC     USRTBL,5      -POINTER TO A.F.S.T. FOR SLOT '0'          FCOR2629
       LXD     USRTBL,6      NO. OF WORDS IN A.F.S.T.                   FCOR2630
       TXI     CSTAT1,5,-AFENTY  POINT TO FIRST ACTIVE FILE ENTRY       FCOR2631
       REM                                                              FCOR2632
CKSTAT LAC     UTABLE,5      -POINTER TO A.F.S.T. FOR CURRENT USER      FCOR2633
       LXD     UTABLE,6      NO. OF WORDS IN A.F.S.T.                   FCOR2634
       TXI     CSTAT1,5,-AFENTY  POINT TO FIRST ACTIVE FILE ENTRY       FCOR2635
       REM                                                              FCOR2636
CSTAT1 TNX     CKSERR,6,AFENTY-1  GET LENGTH DEVOTED TO ACTIVE FILES    FCOR2637
CKST1  TNX     CKSERR,6,ACTLNG INSURE ENOUGH ROOM                       FCOR2638
       NZT     RPROBN,5      FIND EMPTY SLOT IF ANY                     FCOR2639
       TRA     CKST2         .. SKIP WHEN FOUND                         FCOR2640
       TXI     CKST1,5,-ACTLNG  KEEP LOOKING                            FCOR2641
       REM                                                              FCOR2642
CKST2  PCA     0,5           RETURN POINTER TO EMPTY SLOT IN AC         FCOR2643
       TRA     2,4           AND EXIT                                   FCOR2644
       REM                                                              FCOR2645
CKSERR TRA*    1,4           ERROR RETURN IF NO ROOM IN A.F.S.T.        FCOR2646
       REM                                                              FCOR2647
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2648
       REM                                                              FCOR2649
       REM     GTSTAT/GTAFIL ..... FIND ACTIVE FILE IN A.F.S.T.         FCOR2650
       REM                                                              FCOR2651
GTAFIL LAC     USRTBL,6      -POINTER TO A.F.S.T. FOR SLOT '0'          FCOR2652
       LXD     USRTBL,7      NO. OF WORDS IN A.F.S.T.                   FCOR2653
       TXI     GSTAT1,6,-AFENTY  POINT TO FIRST ACTIVE FILE ENTRY       FCOR2654
       REM                                                              FCOR2655
GTSTAT LAC     UTABLE,6      -POINTER TO A.F.S.T. FOR CURRENT USER      FCOR2656
       LXD     UTABLE,7      NO. OF WORDS IN A.F.S.T.                   FCOR2657
       TXI     GSTAT1,6,-AFENTY  POINT TO FIRST ACTIVE FILE ENTRY       FCOR2658
       REM                                                              FCOR2659
GSTAT1 SXA     GTSIR4,4                                                 FCOR2660
       CAL     1,4           POINTER TO FILE NAME                       FCOR2661
       TSX     GETEFA,4      GET EFFECTIVE ADDRESS                      FCOR2662
       PAC     0,5           -LOCATION OF FILE NAME TO IR5              FCOR2663
       LXA     GTSIR4,4      RELOAD IR4                                 FCOR2664
       TNX     GTSERR,7,AFENTY  GET LENGTH DEVOTED TO ACTIVE FILES      FCOR2665
       CAL     0,5           FILE NAME(1) TO AC                         FCOR2666
       LDQ     1,5           FILE NAME(2) TO MQ                         FCOR2667
       LAS     NULPAR        IS FILE NAME(1) NULL                       FCOR2668
       TRA     *+2           NO, SKIP                                   FCOR2669
       TRA     GTANY         YES, GO TO FIND ANY ACTIVE FILE ENTRY      FCOR2670
GTST1  NZT     RPROBN,6      NO, TRY TO FIND SPECIFIED FILE IN A.F.S.T. FCOR2671
       TRA     GTST3         .. SKIP NULL ENTRY (FPROBN .E. 0)          FCOR2672
       LAS     RNAME1,6      .. LOOK FOR FILE NAME(1)                   FCOR2673
       TRA     GTST3         ..                                         FCOR2674
       TRA     *+2           .. FILE NAME(1) FOUND                      FCOR2675
       TRA     GTST3         ..                                         FCOR2676
       XCL                   .. HERE IF FILE NAME(1) FOUND              FCOR2677
       LAS     RNAME2,6      .. LOOK FOR FILE NAME(2)                   FCOR2678
       TRA     GTST2         ..                                         FCOR2679
       TRA     GTFND         .. FILE FOUND, GO PICK UP INDEX IN A.F.S.T.FCOR2680
GTST2  XCL                   .. RETURN FILE NAME(1) TO AC               FCOR2681
GTST3  TNX     GTSERR,7,ACTLNG  CHECK FOR END OF TABLE                  FCOR2682
       TXI     GTST1,6,-ACTLNG  KEEP LOOKING                            FCOR2683
       REM                                                              FCOR2684
GTANY  XCL                   HERE TO PICK UP ANY ACTIVE FILE ENTRY      FCOR2685
GTSTA1 TZE     GTSTA2        FIND POINTER OF LAST ENTRY RETURNED (+1)   FCOR2686
       TNX     GTSERR,7,ACTLNG  .. CHECK TO END OF TABLE                FCOR2687
       SUB     =1            ..                                         FCOR2688
       TXI     GTSTA1,6,-ACTLNG  ..                                     FCOR2689
       REM                                                              FCOR2690
GTSTA2 CAL     1,5           FIND ANY ACTIVE FILE ENTRY                 FCOR2691
       ADD     =1            ..                                         FCOR2692
       SLW     1,5           ..                                         FCOR2693
       ZET     RPROBN,6      ..                                         FCOR2694
       TRA     GTFND         .. FILE FOUND, GO PICK UP INDEX IN A.F.S.T.FCOR2695
       TNX     GTSERR,7,ACTLNG  .. CHECK FOR END OF TABLE               FCOR2696
       TXI     GTSTA2,6,-ACTLNG .. KEEP LOOKING                         FCOR2697
       REM                                                              FCOR2698
GTFND  PCA     0,6           SET UP POINTER TO ENTRY IN AC              FCOR2699
       TRA     2,4           .. AND RETURN                              FCOR2700
       REM                                                              FCOR2701
GTSERR CAL     1,4           HERE IF NO ENTRY FOUND                     FCOR2702
       PDC     0,5           TAKE ERROR RETURN                          FCOR2703
       TRA     0,5           ..                                         FCOR2704
       REM                                                              FCOR2705
       EJECT                                                            FCOR2706
       REM                                                              FCOR2707
       REM     CHKACT ..... CHECK IF FILE IS ALREADY ACTIVE .........   FCOR2708
       REM                                                              FCOR2709
CHKACT LAC     UTABLE,6      -POINTER TO ACTIVE FILE STATUS TABLE       FCOR2710
       LXD     UTABLE,7      LENGTH OF A.F.S.T.                         FCOR2711
       TXI     *+1,6,-AFENTY POINT TO FIRST ACTIVE FILE ENTRY           FCOR2712
       TNX     CKACTX,7,AFENTY  GET LENGTH DEVOTED TO ACTIVE FILES      FCOR2713
       SCA     CKACTP,2      SAVE BASE OF TEST ENTRY                    FCOR2714
CKACT1 NZT     RPROBN,6      IS THIS ENTRY OCCUPIED                     FCOR2715
       TRA     CKACT2        NO, SKIP                                   FCOR2716
       PCA     0,6           IS THIS ENTRY THE SAME AS THE TEST ENTRY   FCOR2717
       SUB     CKACTP        ..                                         FCOR2718
       TZE     CKACT2        AVOID CHECKING ENTRY AGAINST ITSELF        FCOR2719
       CAL     FPROBN,6      CHECK FOR DUPLICATED FILE ENTRY            FCOR2720
       ERA     FPROBN,2      ..                                         FCOR2721
       TNZ     CKACT2        ..                                         FCOR2722
       CAL     FPROGN,6      ..                                         FCOR2723
       ERA     FPROGN,2      ..                                         FCOR2724
       TNZ     CKACT2        ..                                         FCOR2725
       CAL     FNAME1,6      ..                                         FCOR2726
       ERA     FNAME1,2      ..                                         FCOR2727
       TNZ     CKACT2        ..                                         FCOR2728
       CAL     FNAME2,6      ..                                         FCOR2729
       ERA     FNAME2,2      ..                                         FCOR2730
       TZE*    1,4           .. ERROR RETURN IF DUPLICATE ENTRY FOUND   FCOR2731
CKACT2 TNX     CKACTX,7,ACTLNG  ..                                      FCOR2732
       TXI     CKACT1,6,-ACTLNG ..                                      FCOR2733
       REM                                                              FCOR2734
CKACTX TRA     2,4           HERE FOR NORMAL RETURN FROM CHKACT         FCOR2735
       REM                                                              FCOR2736
       EJECT                                                            FCOR2737
       REM                                                              FCOR2738
       REM     RELEAS ...... REMOVE FILE FROM A.F.S.T. .................FCOR2739
       REM                                                              FCOR2740
RELEAS SXA     RELIR4,4                                                 FCOR2741
       CAL     1,4           POINTER TO ACTIVE FILE ENTRY               FCOR2742
       TSX     GETEFA,4      COMPUTE EFFECTIVE ADDRESS                  FCOR2743
       PAC     0,4           -LOCATION OF ENTRY TO IR4                  FCOR2744
       STZ     RPROBN,4      CLEAR ENTRY BY LEAVING RPROBN ZERO         FCOR2745
       LXA     RELIR4,4      AND RETURN                                 FCOR2746
       TRA     2,4           ..                                         FCOR2747
       REM                                                              FCOR2748
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2749
       REM                                                              FCOR2750
       REM     RTNFIL ...... REMOVE FILE FROM ACTIVE STATUS ..........  FCOR2751
       REM                                                              FCOR2752
RTNFIL SXA     RTNFX4,4                                                 FCOR2753
       CAL     RCOUNT,2      PICK UP PHYSICAL RECORD SIZE               FCOR2754
       PAX     0,4           .. INTO IR4                                FCOR2755
       TXH     RTNFA,4,0     SKIP IF FILE HAS NOT BEEN 'SCRAPPED'       FCOR2756
       LDI     MODE,2        HERE FOR SCRAPPED FILE (RCOUNT.E.0)        FCOR2757
       LFT     002000        WAS IT A TEMPORARY FILE                    FCOR2758
       TRA     RTNDEL        YES, IGNORE FILE LENGTH                    FCOR2759
       CAL     NORECS,2      NO, PICK UP NO. OF RECORDS IN THIS FILE    FCOR2760
       PDX     0,5           .. INTO ADDRESS                            FCOR2761
       PXA     0,5           ..                                         FCOR2762
       SLW     TEMP          SAVE NO. OF RECORDS IN THIS FILE           FCOR2763
       LXTC    (F,2),3       -F TO IR3                                  FCOR2764
       GETQU   (FPROBN,2)    PICK UP RECORD QUOTA,,USED FROM UFD        FCOR2765
       TSX     SUBREC,4      REDUCE USER RECORDS USED                   FCOR2766
       PAR     TEMP          .. BY C(TEMP)                              FCOR2767
       PAR     *+1           .. IGNORE ERROR RETURN                     FCOR2768
       SETQU   (FPROBN,2)    UPDATE RECORD QUOTA,,USED IN UFD           FCOR2769
       TRA     RTNDEL        AND REMOVE FILE FROM UFD                   FCOR2770
       REM                                                              FCOR2771
RTNFA  LDI     RWSTAT,2      PICK UP READ AND/OR WRITE STATUS OF FILE   FCOR2772
       LNT     200000        WAS FILE IN WRITE STATUS                   FCOR2773
       TRA     RTNRED        NO, CLOSE OUT READ FILE                    FCOR2774
       RIL     700000        YES, RESET READ/WRITE FLAGS                FCOR2775
       STI     RWSTAT,2      ..                                         FCOR2776
       TSX     GTDYTM,4      PICK UP CURRENT DATE AND TIME              FCOR2777
       STP     DATELU,2      SET DATE FILE LAST USED                    FCOR2778
       STD     DATELU,2      ..                                         FCOR2779
       SLW     DAYTIM,2      SET NEW DATE/TIME FILE WAS LAST MODIFIED   FCOR2780
       LDI     RMODE,2       PICK UP EFFECTIVE FILE MODE                FCOR2781
       LFT     200000        IS FILE IN PROTECTED MODE                  FCOR2782
       TRA     RTNFB         YES, SKIP, DO NOT CHANGE 'AUTHOR'          FCOR2783
       CAL     AUTHNO,1      NO, GET AUTHOR MODIFYING THIS FILE         FCOR2784
       TZE     RTNFB         SKIP IF NO AUTHOR SPECIFIED                FCOR2785
       STA     AUTHOR,2      OTHERWISE SET NEW 'AUTHOR' OF FILE         FCOR2786
       STT     AUTHOR,2      ..                                         FCOR2787
RTNFB  TSX     UNLOCK,4      TELL SUPERVISOR FILE NOW AVAILABLE         FCOR2788
       TRA     UPDUFD        SKIP TO UPDATE USER'S FILE DIRECTORY       FCOR2789
       REM                                                              FCOR2790
RTNRED LFT     400000        HERE FOR READ FILE, HAS FILE BEEN SAVED    FCOR2791
       TRA     RTNF1         YES, IGNORE TEMPORARY MODE                 FCOR2792
       LDI     MODE,2        NO, PICK UP FILE MODE                      FCOR2793
       LNT     002000        IS FILE IN TEMPORARY MODE                  FCOR2794
       TRA     RTNF1         NO, SKIP                                   FCOR2795
       TSX     DFILE,4       YES, TRY TO DELETE THIS FILE               FCOR2796
RTNDEL REMOVE  UFD,(FNAME1,2),RTNMER  REMOVE THIS FILE FROM UFD         FCOR2797
       TSX     UNLOCK,4      FREE UP THIS FILE NAME                     FCOR2798
       TRA     UPDDIR        SKIP TO UPDATE DIRECTORIES                 FCOR2799
       REM                                                              FCOR2800
RTNF1  TSX     SEARCH,4      FIND FILE ENTRY (NON-STANDARD USAGE)       FCOR2801
       EFA     FPROBN,2      .. DIRECTORY                               FCOR2802
       EFA     FNAME1,2      .. FILE NAME                               FCOR2803
       EFA     FILTMP+FPROBN .. READ LOCATION                           FCOR2804
       PAR     RTNMER,,UFDERR  .. ERROR RETURNS                         FCOR2805
       AXC     FILTMP,7      FOR FUTURE REFERENCE                       FCOR2806
       LDI     RWSTAT,7      PICK UP FILE STATUS                        FCOR2807
       LNT     077777        TEST FOR NORECS = -1                       FCOR2808
       TRA     RTNF2         NO, ASSUME INFO. CORRECT                   FCOR2809
       CAL     =O77777077777 PREPARE TO RESET INDICATORS                FCOR2810
       RIA                   CLEAR NORECS, LCOUNT                       FCOR2811
       ANA     NORECS,2      USE NORECS, LCOUNT FROM AFENTY             FCOR2812
       OAI                   AND REPLACE IN PROPER BITS                 FCOR2813
RTNF2  RIL     600000        RESET ALL BUT READ STATUS                  FCOR2814
       CAL     ILOCK,2       GET ILOCK BEING RETURNED                   FCOR2815
       ANA     =O776000777777  LEAVE MODE, F, RCOUNT                    FCOR2816
       SLW     ILOCK,2       RESTORE                                    FCOR2817
       CAL     ILOCK,7       REDUCE NO. OF USERS READING THIS FILE      FCOR2818
       ANA     =O777000000   ISOLATE ILOCK FIELD                        FCOR2819
       TZE     RTNF3         IT'S ALREADY ZERO, MAYBE (ULP)             FCOR2820
       SUB     =1B17         ..                                         FCOR2821
       ORS     ILOCK,2       ..                                         FCOR2822
       TNZ     *+2           SKIP IF USERS STILL READING THIS FILE      FCOR2823
RTNF3  RIL     100000        OTHERWISE RESET FILE READ STATUS           FCOR2824
       STI     RWSTAT,2      RESET READ/WRITE STATUS                    FCOR2825
       LNT     100000        IS FILE NOW AVAILABLE                      FCOR2826
       TSX     UNLOCK,4      IF SO TELL SUPERVISOR ABOUT IT             FCOR2827
       TSX     GTDYTM,4      PICK UP DATE/TIME                          FCOR2828
       XCL                   .. SET NEW DATE LAST USED                  FCOR2829
       SLQ     DATELU,2      .. FOR THIS FILE                           FCOR2830
       REM                                                              FCOR2831
UPDUFD TSX     REFMFD,4      CHECK TO SEE WHETHER CLOSING READER'S UFD  FCOR2832
       EFA     FPROBN,2      ..                                         FCOR2833
       ZET     FS.TST        WATCH OUT FOR MACRO BELOW                  FCOR2834
       UPDFIL  UFD,(FNAME1,2),RTNMER  UPDATE THIS USER FILE ENTRY       FCOR2835
       REM                                                              FCOR2836
UPDDIR CAL     FPROBN,2      IS THIS FILE FROM CURRENT USER'S UFD       FCOR2837
       ERA     PROBNO,1      ..                                         FCOR2838
       TNZ     RWTUFD        NO, GO REWRITE THIS FILE DIRECTORY         FCOR2839
       CAL     FPROGN,2      ..                                         FCOR2840
       ERA     PROGNO,1      ..                                         FCOR2841
       TZE     RTNFND        YES, SKIP                                  FCOR2842
RWTUFD REWRIT  (FPROBN,2),RTNMER  NO, REWRITE THIS UFD                  FCOR2843
       REM                                                              FCOR2844
RTNFND RELEAS  (RPROBN,2)    RELEASE THIS FILE FROM ACTIVE STATUS       FCOR2845
       LXA     RTNFX4,4      AND RETURN                                 FCOR2846
       TRA     1,4           ..                                         FCOR2847
       REM                                                              FCOR2848
RTNMER RELEAS  (RPROBN,2)    HERE FOR ERROR IN UPDFIL, REMOVE OR REWRIT FCOR2849
       LXA     RTNFX4,4      TAKE ERROR RETURN                          FCOR2850
       TRA*    1,4           ..                                         FCOR2851
       REM                                                              FCOR2852
       EJECT                                                            FCOR2853
       REM                                                              FCOR2854
       REM     LOCK ..... INTERRUPT SUPERVISOR ON FILE INTERLOCK        FCOR2855
       REM                                                              FCOR2856
LOCK   TSX     IRSAV,7       SAVE IRS 1-4                               FCOR2857
       CAL     FPROBN,2      COMPUTE CHECKSUM OF FILE NAMES             FCOR2858
       ACL     FPROGN,2      ..                                         FCOR2859
       ACL     FNAME1,2      ..                                         FCOR2860
       ACL     FNAME2,2      ..                                         FCOR2861
       SLW     NAMSUM        ..                                         FCOR2862
       TSX     RESTOR,4      RESTORE USER'S MACHINE CONDITIONS          FCOR2863
       SSTRAP  4,IR4,ILC,NAMSUM,1  INTERRUPT SUPERVISOR (CODE 4)        FCOR2864
       ENB*    ENABLE        REENABLE AFTER SIMULATED TRAP              FCOR2865
       TSX     IRRST,7       RESTORE IRS 1-4                            FCOR2866
       TRA     1,4           AND RETURN                                 FCOR2867
       REM                                                              FCOR2868
       REM     UNLOCK ..... INTERRUPT SUPERVISOR WHEN FILE AVAILABLE    FCOR2869
       REM                                                              FCOR2870
UNLOCK TSX     IRSAV,7       SAVE IRS 1-4                               FCOR2871
       LDI     ILOCK,2       RESET INTERLOCK FLAGS                      FCOR2872
       RIL     001777        ..                                         FCOR2873
       STI     ILOCK,2       ..                                         FCOR2874
       CAL     FPROBN,2      COMPUTE CHECKSUM OF FILE NAMES             FCOR2875
       ACL     FPROGN,2      ..                                         FCOR2876
       ACL     FNAME1,2      ..                                         FCOR2877
       ACL     FNAME2,2      ..                                         FCOR2878
       SLW     NAMSUM        ..                                         FCOR2879
       TSX     RESTOR,4      RESTORE USER'S MACHINE CONDITIONS          FCOR2880
       SSTRAP  5,IR4,ILC,NAMSUM,1  INTERRUPT SUPERVISOR (CODE 5)        FCOR2881
       ENB*    ENABLE        REENABLE AFTER SIMULATED TRAP              FCOR2882
       TSX     IRRST,7       RESTORE IRS 1-4                            FCOR2883
       TRA     1,4           AND RETURN                                 FCOR2884
       REM                                                              FCOR2885
       EJECT                                                            FCOR2886
       REM                                                              FCOR2887
       REM     UPDSYS ..... UPDATE ALL SYSTEM INFORMATION TO PERMANENT  FCOR2888
       REM            ..... SECONDARY STORAGE.                          FCOR2889
       REM                                                              FCOR2890
UPDSYS SXA     UPDX34,3                                                 FCOR2891
       SXD     UPDX34,4                                                 FCOR2892
       AXC     1,3                                                      FCOR2893
UPDS1  XEC     UPDMOD,3      UPDATE ALL NECESSARY MODULES               FCOR2894
       TXL     *+2,3,-NUPDAT ..                                         FCOR2895
       TXI     UPDS1,3,-1    ..                                         FCOR2896
       LXA     UPDX34,3      RELOAD IR3 NOW                             FCOR2897
       NZT     PROBNO,1      IS USER ATTACH TO A U.F.D.                 FCOR2898
       TRA     UPDS2         NO, SKIP                                   FCOR2899
       REWRIT  UFD,UPDSER    YES, UPDATE USER FILE DIRECTORY            FCOR2900
UPDS2  REWRIT  MFD,UPDSER    ALWAYS UPDATE MASTER FILE DIRECTORY        FCOR2901
       LXD     UPDX34,4      RETURN TO CALLER                           FCOR2902
       TRA     2,4           ..                                         FCOR2903
       REM                                                              FCOR2904
UPDSER LXD     UPDX34,4      HERE IF ERROR REWRITING UFD OR MFD         FCOR2905
       TRA*    1,4           .. TAKE ERROR RETURN                       FCOR2906
       REM                                                              FCOR2907
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2908
       REM                                                              FCOR2909
       REM     DFILE ...... TRY TO DELETE FILE THROUGH STRATEGY MODULE  FCOR2910
       REM                                                              FCOR2911
DFILE  SXA     DFILX4,4                                                 FCOR2912
       CAL     NORECS,2      PICK UP NO. OF RECORDS IN FILE             FCOR2913
       STD     DELREC        .. SET TO DELETE RECORDS 1-NORECS          FCOR2914
       LXTC    (F,2),5       -DEVICE NO. TO IR5                         FCOR2915
       XEC     DFILEF,5      TRY TO DELETE THIS FILE                    FCOR2916
       EFA     0,2           ..                                         FCOR2917
       PAR     DELREC,,QWAIT ..                                         FCOR2918
       LXA     DFILX4,4      RETURN ON SUCESSFUL DELETE                 FCOR2919
       TRA     1,4           ..                                         FCOR2920
       EJECT                                                            FCOR2921
       REM     REFMFD ..... CHECK AGAINST ATTEMPTS TO MODIFY M.F.D.     FCOR2922
       REM                                                              FCOR2923
REFMFD SXA     REFTMP,4      SAVE X4                                    FCOR2924
       CAL     1,4           GET POINTER                                FCOR2925
       TSX     GETEFA,4      ..                                         FCOR2926
       LXA     REFTMP,4      RELOAD                                     FCOR2927
       PAC     ,7            TO TEMPORARY INDEX REGISTER                FCOR2928
       CAL     0,7           NAME1                                      FCOR2929
       ERA     MFD           VS. 'M.F.D.'                               FCOR2930
       TNZ     3,4           TKO                                        FCOR2931
       CAL     1,7           ROUND 2                                    FCOR2932
       ERA     MFD+1         VS. '(FILE)'                               FCOR2933
       TNZ     3,4           DECISION                                   FCOR2934
       TRA     2,4           RETURN MATCH                               FCOR2935
       EJECT                                                            FCOR2936
       REM                                                              FCOR2937
       REM     ADDREC/SUBREC ...... COMPUTE AND CHECK RECORD QUOTAS     FCOR2938
       REM                                                              FCOR2939
ADDREC AXC     ADDOP,5       ADD TO RECORDS USED, CHECK QUOTA           FCOR2940
       TRA     UPDRC1        ..                                         FCOR2941
       REM                                                              FCOR2942
SUBREC AXC     SUBOP,5       SUBTRACT FROM RECORDS USED, CHECK QUOTA    FCOR2943
       REM                                                              FCOR2944
UPDRC1 ANA     =O77777077777 INSURE PREFIX AND TAG ARE RESET            FCOR2945
       PAI                   QUOTA,,USED TO SI                          FCOR2946
       RNT     77777         IS USER ALLOTTED 32767 ON THIS DEVICE      FCOR2947
       TRA     UPDRC2        NO, SKIP                                   FCOR2948
       RIL     77777         YES, INSURE 'USED' IS ZERO                 FCOR2949
       TRA     RECQOK        AND GIVE NORMAL RETURN                     FCOR2950
       REM                                                              FCOR2951
UPDRC2 LGR     18            SAVE QUOTA IN MQ                           FCOR2952
       XEC     0,5           ADD TO OR SUBTRACT FROM 'USED'             FCOR2953
       TPL     *+2           SKIP IF POSITIVE                           FCOR2954
       ZAC                   OTHERWISE REPLACE NEGATIVE NO. WITH ZERO   FCOR2955
       ANA     =O77777       TAKE RECORDS USED MODULO 2.P.15            FCOR2956
       SLW     RECTMP        SAVE NEW NO. OF RECORDS USED               FCOR2957
       LGL     18            RESTORE QUOTA,,USED TO AC                  FCOR2958
       PAI                   SAVE IN SI                                 FCOR2959
       ANA     =O77777       GET QUOTA ALONE                            FCOR2960
       SUB     RECTMP        CHECK USED AGAINST QUOTA                   FCOR2961
       TMI     RECQNG        SKIP IF USED .G. QUOTA                     FCOR2962
RECQOK PIA                   RESTORE QUOTA,,USED FROM SI                FCOR2963
       TRA     3,4           AND TAKE NORMAL RETURN                     FCOR2964
       REM                                                              FCOR2965
RECQNG PIA                   RESTORE QUOTA,,USED FROM SI                FCOR2966
       TRA*    2,4           AND TAKE ERROR EXIT                        FCOR2967
       REM                                                              FCOR2968
ADDOP  ADD*    1,4           ADD TO RECORDS USED (ADDREC)               FCOR2969
SUBOP  SUB*    1,4           SUBTRACT FROM RECORDS USED (SUBREC)        FCOR2970
       REM                                                              FCOR2971
       EJECT                                                            FCOR2972
       REM                                                              FCOR2973
       REM     USTORE ... STORE A WORD IN USER ARRAY, REDUCE ARRAY COUNTFCOR2974
       REM                                                              FCOR2975
USTORE SLW     USTEMP        SAVE WORD TO BE MOVED                      FCOR2976
       CAL*    1,4           PICK UP USER ARRAY LENGTH                  FCOR2977
       PDX     0,5           .. TO IR5                                  FCOR2978
       TXH     USTO1,5,0     SKIP IF ONE OR MORE WORDS LEFT             FCOR2979
       CAL     1,4           OTHERWISE TAKE EMPTY EXIT                  FCOR2980
       PDC     0,5           ..                                         FCOR2981
       TRA     0,5           ..                                         FCOR2982
       REM                                                              FCOR2983
USTO1  TXI     *+1,5,-1      REDUCE ARRAY COUNT BY ONE                  FCOR2984
       PXD     0,5           ..                                         FCOR2985
       STD*    1,4           ..                                         FCOR2986
       SXA     USTX34,3                                                 FCOR2987
       SXD     USTX34,4                                                 FCOR2988
       CAL*    1,4           GET CURRENT BASE OF USER ARRAY             FCOR2989
       PAC     0,3           -ADDRESS TO IR3                            FCOR2990
       ADD     =1            BUMP ARRAY BASE ADDRESS                    FCOR2991
       STA*    1,4           ..                                         FCOR2992
       MOVE1   HOME,USTEMP,CALL,(0,3),*+1  MOVE WORD TO USER MEMORY     FCOR2993
       LXD     USTX34,4      AND RETURN                                 FCOR2994
       LXA     USTX34,3      ..                                         FCOR2995
       TRA     2,4           ..                                         FCOR2996
       REM                                                              FCOR2997
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR2998
       REM                                                              FCOR2999
       REM     MVHOME ..... MOVE USER ARRAY TO HBUF IN HOME MEMORY .....FCOR3000
       REM                                                              FCOR3001
MVHOME SXA     MVHX12,1                                                 FCOR3002
       SXD     MVHX12,2                                                 FCOR3003
       SXA     MVHIR4,4                                                 FCOR3004
       CAL*    1,4           GET ARRAY POINTER BASE,,COUNT              FCOR3005
       PAC     0,1           -BASE ADDRESS OF ARRAY TO IR1              FCOR3006
       PDC     0,2           -COUNT TO IR2                              FCOR3007
       TXH     MVHOM1,2,-HBUFL-1  SKIP IF ARRAY WILL FIT IN BUFFER      FCOR3008
       AXC     HBUFL,2       OTHERWISE SET ARRAY SIZE TO HBUFL          FCOR3009
       PCD     0,2           RESET POINTER WORD                         FCOR3010
       STD*    1,4           ..                                         FCOR3011
MVHOM1 CAL     MVHADR        SET NEW BASE OF ARRAY TO 'HBUF'            FCOR3012
       STA*    1,4           ..                                         FCOR3013
       TSX     MOVE,4        MOVE ARRAY TO HBUF IN HOME MEMORY          FCOR3014
       PAR     CALL,,HOME    ..                                         FCOR3015
       EFA     0,1           ..                                         FCOR3016
MVHADR EFA     HBUF          ..                                         FCOR3017
       EFA     0,2           .. ARRAY LENGTH                            FCOR3018
       PAR     *+1           .. IGNORE ERROR RETURN                     FCOR3019
       LXA     MVHX12,1      RETURN TO CALLER                           FCOR3020
       LXD     MVHX12,2      ..                                         FCOR3021
       LXA     MVHIR4,4      ..                                         FCOR3022
       TRA     2,4           ..                                         FCOR3023
       REM                                                              FCOR3024
       EJECT                                                            FCOR3025
       REM                                                              FCOR3026
       REM     MOVE ..... MOVE ARRAY OR WORD BETWEEN MEMORIES ..........FCOR3027
       REM                                                              FCOR3028
MOVE   SXA     MOVX34,3                                                 FCOR3029
       SXD     MOVX34,4                                                 FCOR3030
       CAL*    1,4           GET POINTER TO 'FROM' MEMORY               FCOR3031
       SLW     FRMEM         ..                                         FCOR3032
       CAL     1,4           GET POINTER TO 'TO' MEMORY                 FCOR3033
       PDC     0,5           ..                                         FCOR3034
       CAL     0,5           ..                                         FCOR3035
       SLW     TOMEM         ..                                         FCOR3036
       CAL     2,4           GET 'FROM' ADDRESS                         FCOR3037
       TSX     GETEFA,4      GET EFFECTIVE ADDRESS                      FCOR3038
       SLW     FRWORD        ..                                         FCOR3039
       LXD     MOVX34,4                                                 FCOR3040
       CAL     3,4           GET 'TO' ADDRESS                           FCOR3041
       TSX     GETEFA,4      GET AFFECTIVE ADDRESS                      FCOR3042
       SLW     TOWORD        ..                                         FCOR3043
       LXD     MOVX34,4                                                 FCOR3044
       CAL     4,4           GET WORD COUNT                             FCOR3045
       TSX     GETEFA,4      COMPUTE EFFECTIVE WORD COUNT               FCOR3046
       ALS     18            .. INTO DECREMENT                          FCOR3047
       STD     FRWORD        SET UP ARRAY LIMITS                        FCOR3048
       STD     TOWORD        ..                                         FCOR3049
       CAL     FRWORD                                                   FCOR3050
       TSX     RCHECK,4      RELOCATE AND CHECK 'FROM' ARRAY            FCOR3051
       PAR     MVERTN,,FRMEM ..                                         FCOR3052
       SLW     FRWORD        ..                                         FCOR3053
       CAL     TOWORD                                                   FCOR3054
       TSX     RCHECK,4      RELOCATE AND CHECK 'TO' ARRAY              FCOR3055
       PAR     MVERTN,,TOMEM ..                                         FCOR3056
       SLW     TOWORD        ..                                         FCOR3057
       CAL     =O3           MASK OUT PROTECT BIT                       FCOR3058
       ANS     FRMEM         ..                                         FCOR3059
       ANS     TOMEM         ..                                         FCOR3060
       LAC     FRWORD,5      -BASE OF 'FROM' ARRAY                      FCOR3061
       LAC     TOWORD,6      -BASE OF 'TO' ARRAY                        FCOR3062
       LXD     FRWORD,7      ARRAY COUNT                                FCOR3063
       TXI     *+1,7,1       BUMP ARRAY LENGTH BY ONE                   FCOR3064
       LAC     FRMEM,3       FLAG FOR 'FROM' MEMORY                     FCOR3065
       LAC     TOMEM,4       FLAG FOR 'TO' MEMORY                       FCOR3066
       CAL     FRMEM         CHECK IF 'FROM' AND 'TO'                   FCOR3067
       ERA     TOMEM         .. ARE THE SAME MEMORY UNIT                FCOR3068
       TNZ     MOVE2         .. SKIP IF DIFFERENT MEMORIES              FCOR3069
       REM                                                              FCOR3070
       XEC     SETMEM,3      HERE IF BOTH MEMORIES THE SAME             FCOR3071
MOVE1  TNX     MOVE3,7,3     MOVE WORDS (THREE AT A TIME)               FCOR3072
       CAL     0,5           ..                                         FCOR3073
       LDQ     1,5           ..                                         FCOR3074
       LDI     2,5           ..                                         FCOR3075
       SLW     0,6           ..                                         FCOR3076
       STQ     1,6           ..                                         FCOR3077
       STI     2,6           ..                                         FCOR3078
       TXI     *+1,5,-3      ..                                         FCOR3079
       TXI     MOVE1,6,-3    ..                                         FCOR3080
       REM                                                              FCOR3081
MOVE2  TNX     MOVE3,7,3     HERE IN MEMORIES DIFFERENT,                FCOR3082
       XEC     SETMEM,3      .. MOVE WORDS (THREE AT A TIME)            FCOR3083
       CAL     0,5           ..                                         FCOR3084
       LDQ     1,5           ..                                         FCOR3085
       LDI     2,5           ..                                         FCOR3086
       XEC     SETMEM,4      .. SELECT 'TO' MEMORY                      FCOR3087
       SLW     0,6           ..                                         FCOR3088
       STQ     1,6           ..                                         FCOR3089
       STI     2,6           ..                                         FCOR3090
       TXI     *+1,5,-3      ..                                         FCOR3091
       TXI     MOVE2,6,-3    ..                                         FCOR3092
       REM                                                              FCOR3093
MOVE3  TNX     MOVE4,7,1     HERE TO MOVE LAST WORDS (ONE AT A TIME)    FCOR3094
       XEC     SETMEM,3      ..                                         FCOR3095
       CAL     0,5           ..                                         FCOR3096
       XEC     SETMEM,4      ..                                         FCOR3097
       SLW     0,6           ..                                         FCOR3098
       TXI     *+1,5,-1      ..                                         FCOR3099
       TXI     MOVE3,6,-1    ..                                         FCOR3100
       REM                                                              FCOR3101
MOVE4  HOMOP                 HERE AT END, INSURE ECC RESET TO 'HOME'    FCOR3102
       LXA     MOVX34,3      AND RETURN                                 FCOR3103
       LXD     MOVX34,4      ..                                         FCOR3104
       TRA     6,4           ..                                         FCOR3105
       REM                                                              FCOR3106
MVERTN HOMOP                 HERE FOR ERROR, INSURE ECC RESET TO 'HOME' FCOR3107
       LXA     MOVX34,3      .. TAKE ERROR RETURN                       FCOR3108
       LXD     MOVX34,4      ..                                         FCOR3109
       TRA*    5,4           ..                                         FCOR3110
       REM                                                              FCOR3111
SETMEM TRA     MVERTN        MEMORY SELECT TABLE FOR MOVE ROUTINE       FCOR3112
       SEA                   ..                                         FCOR3113
       SEB                   ..                                         FCOR3114
       TRA     MVERTN        .. ERROR IF MEMORY .E. 0 OR 3              FCOR3115
       REM                                                              FCOR3116
       EJECT                                                            FCOR3117
       REM                                                              FCOR3118
       REM     RCHECK ..... RELOCATE AND CHECK ADDRESS/ES ............  FCOR3119
       REM                                                              FCOR3120
RCHECK ANA     =O77777077777 INSURE PREFIX AND TAG ZERO                 FCOR3121
       SLW     RCKTMP        SAVE ADDRESS WORD                          FCOR3122
       CAL     1,4           PAR ERRTN,,MEMFLG                          FCOR3123
       PDC     0,5           -LOCATION OF MEMORY FLAG                   FCOR3124
       LDI     0,5           PICK UP MEMORY FLAG                        FCOR3125
       RNT     4             IS THIS MEMORY PROTECTED                   FCOR3126
       TRA     RCHK2         NO, SKIP                                   FCOR3127
       LAC     UTABLE,5      YES, GET -BASE OF USER A.F.S.T.            FCOR3128
       CAL     RCKTMP        RELOCATE USER ADDRESS                      FCOR3129
       ACL     RELOC,5       ..                                         FCOR3130
       STA     RCKTMP        ..                                         FCOR3131
       ARS     18            GET ARRAY COUNT IF ANY                     FCOR3132
       TZE     RCHK1         SKIP IF COUNT ZERO                         FCOR3133
       ACL     RCKTMP        OTHERWIZE COMPUTE HIGH ADDRESS             FCOR3134
       SUB     =1            .. OF USER ARRAY                           FCOR3135
       PAI                   HIGH ADDRESS TO SI                         FCOR3136
       RFT     700000        DID ADDRESS EXCEED ADDRESSABLE MEMORY      FCOR3137
       TRA     RCHKER        YES, ERROR                                 FCOR3138
       TSX     CHKADR,6      NO, CHECK HIGH ADDRESS                     FCOR3139
RCHK1  CAL     RCKTMP        PICK UP LOW ADDRESS                        FCOR3140
       TSX     CHKADR,6      CHECK IT                                   FCOR3141
RCHK2  CAL     RCKTMP        RETURN RELOCATED ADDRESS IN AC             FCOR3142
       TRA     2,4           ..                                         FCOR3143
       REM                                                              FCOR3144
CHKADR ANA     =O77777       ROUTINE TO CHECK USER ADDRESS              FCOR3145
       XCL                   ADDRESS TO MQ                              FCOR3146
       CAL     LIMITS,5      USER MEMORY LIMITS LOW,,HIGH               FCOR3147
       ANA     =O77777       GET LOWER BOUND                            FCOR3148
       TLQ     RCHKER        ERROR IF ADDRESS .L. LOWER BOUND           FCOR3149
       CAL     LIMITS,5      LOW,,HIGH                                  FCOR3150
       ARS     18            GET UPPER BOUND                            FCOR3151
       ANA     =O77777       ..                                         FCOR3152
       XCL                   UPPER BOUND TO MQ, ADDRESS TO AC           FCOR3153
       TLQ     RCHKER        ERROR IF UPPER BOUND .L. ADDRESS           FCOR3154
       TRA     1,6           RETURN TO RCHECK                           FCOR3155
       REM                                                              FCOR3156
RCHKER CAL     RCKTMP        HERE FOR ERROR, RETURN ARRAY ADDRESS IN AC FCOR3157
       TRA*    1,4           RETURN                                     FCOR3158
       REM                                                              FCOR3159
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR3160
       REM                                                              FCOR3161
       REM     GETEFA ..... COMPUTE EFFECTIVE ADDRESS OF WORD IN AC ....FCOR3162
       REM                                                              FCOR3163
GETEFA STT     SCATMP        PLACE TAG IN  SCA  GTATMP,**               FCOR3164
       XEC     SCATMP        SCA  GTATMP,TAG                            FCOR3165
       ACL     GTATMP        ADD COMPLEMENT OF IR TO ADDRESS            FCOR3166
       ANA     =O77777       EFFECTIVE ADDRESS MODULO 2.P.15            FCOR3167
       TRA     1,4           RETURN EFFECTIVE ADDRESS IN AC             FCOR3168
       REM                                                              FCOR3169
       EJECT                                                            FCOR3170
       REM                                                              FCOR3171
       REM     RECADR ..... COMPUTE LINEAR FILE ADDRESS ................FCOR3172
       REM                                                              FCOR3173
RECADR STA     TLCNT         SAVE WORD COUNT OF LAST RECORD             FCOR3174
       ARS     18            NO. OF RECORDS TO ADDRESS                  FCOR3175
       ANA     =O77777       .. MODULO 2.P.15                           FCOR3176
       TZE     1,4           LENGTH IS ZERO IF RECORD COUNT ZERO        FCOR3177
       SUB     =1            REDUCE RECORD COUNT BY ONE                 FCOR3178
       SLW     TNREC         .. AND SAVE IT                             FCOR3179
       CAL     RCOUNT,2      PICK UP NUMBER OF WORDS PER RECORD         FCOR3180
       ANA     =O77777       .. FROM A.F.S.T. MODULO 2.P.15             FCOR3181
       XCL                   RECORD LENGTH TO MQ                        FCOR3182
       MPY     TNREC         RCOUNT*(NORECS-1)                          FCOR3183
       XCL                   RESULT TO AC                               FCOR3184
       ADD     TLCNT         RCOUNT*(NORECS-1)+LCOUNT                   FCOR3185
       TRA     1,4           RETURN LINEAR ADDRESS IN AC                FCOR3186
       REM                                                              FCOR3187
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR3188
       REM                                                              FCOR3189
       REM     SORT ..... SORT ARRAY IN ASCENDING ORDER ........        FCOR3190
       REM                                                              FCOR3191
SORT   CAL     1,7           ARRAY POINTER, PAR ARRAY,,COUNT            FCOR3192
       PAC     0,5           -BASE OF ARRAY TO IR5                      FCOR3193
       PDX     0,6           COUNT TO IR6                               FCOR3194
       STZ     SORTSW        RESET SORT SWITCH                          FCOR3195
SORT1  TNX     SORT4,6,1     SORT ARRAY, TREAT ZEROS AS LARGEST NUMBER  FCOR3196
       CAL     1,5           ..                                         FCOR3197
       TZE     SORT3         ..                                         FCOR3198
       NZT     0,5           ..                                         FCOR3199
       TRA     SORT2         .. TREAT ZERO AS LARGEST POSSIBLE NUMBER   FCOR3200
       LAS     0,5           ..                                         FCOR3201
       TRA     SORT3         .. SKIP IF IN ASCENDING ORDER ALREADY      FCOR3202
       TRA     SORT3         .. OR EQUAL                                FCOR3203
SORT2  LDQ     0,5           .. HERE IF NOT IN ASCENDING ORDER          FCOR3204
       SLW     0,5           .. SWITCH WORDS                            FCOR3205
       STQ     1,5           ..                                         FCOR3206
       STL     SORTSW        .. INDICATE CHANGE ON THIS PASS            FCOR3207
SORT3  TXI     SORT1,5,-1    ..                                         FCOR3208
       REM                                                              FCOR3209
SORT4  ZET     SORTSW        HERE AT END OF PASS, WAS ANYTHING MOVED    FCOR3210
       TRA     SORT          YES, SORT AGAIN                            FCOR3211
       TRA     2,7           NO, RETURN                                 FCOR3212
       REM                                                              FCOR3213
       EJECT                                                            FCOR3214
       REM                                                              FCOR3215
       REM     IRSAV/IRRST ..... SAVE AND RESTORE IRS 1-3 FOR FILE SYS. FCOR3216
       REM                                                              FCOR3217
IRSAV  SXA     IRSX12,1      SAVE IRS 1-4                               FCOR3218
       SXD     IRSX12,2      ..                                         FCOR3219
       SXA     IRSX34,3      ..                                         FCOR3220
       SXD     IRSX34,4      ..                                         FCOR3221
       TRA     1,7           RETURN                                     FCOR3222
       REM                                                              FCOR3223
IRRST  LXA     IRSX12,1      RESTORE IRS 1-4                            FCOR3224
       LXD     IRSX12,2      ..                                         FCOR3225
       LXA     IRSX34,3      ..                                         FCOR3226
       LXD     IRSX34,4      ..                                         FCOR3227
       TRA     1,7           RETURN                                     FCOR3228
       EJECT                                                            FCOR3229
       REM                                                              FCOR3230
       REM     ..... FILE COORDINATOR VARIABLE STORAGE .................FCOR3231
       REM                                                              FCOR3232
VARSTO SYN     *             BEGINNING OF VARIABLE STORAGE              FCOR3233
       REM                                                              FCOR3234
FS.TST PZE     **            ENTRY SWITCH FOR DAEMON SNEAK-AROUND       FCOR3235
       REM                                                              FCOR3236
       REM     ..... TABLES AND STORAGE COMMON TO ALL I/O SYSTEM MODULESFCOR3237
       REM                                                              FCOR3238
UTABLE PZE     **,,**        POINTERS TO CURRENT USER STATUS TABLE      FCOR3239
       REM                                                              FCOR3240
USRTBL PZE     ZEROQ,,ZEROQL POINTERS TO USER STATUS TABLES             FCOR3241
       DUP     1,DUSERS      ..                                         FCOR3242
       PZE     **,,**        ..                                         FCOR3243
       REM                                                              FCOR3244
PRIORT DUP     1,DUSERS      SORTED USER PRIORITY TABLE                 FCOR3245
       PZE     **,,**        ..                                         FCOR3246
       REM                                                              FCOR3247
       PZE     0             ZERO FOR END OF USER PRIORITY TABLE        FCOR3248
       REM                                                              FCOR3249
SLOTNO PZE     1             SLOT CURRENTLY BEING SERVICED BY I/O SYSTEMFCOR3250
       REM                                                              FCOR3251
       REM     ..... INTERNAL VARIABLE STORAGE .........................FCOR3252
       REM                                                              FCOR3253
SSCALL PZE     **            ADDRESS OF SUPERVISOR INTERRUPT PROCEDURE  FCOR3254
       REM                                                              FCOR3255
ERRLOC PZE     FRSTER        ADDRESS OF SUPERVISOR ERROR PROCEDURE      FCOR3256
DATLOC PZE     **            LOCATION OF TODAY'S DATE IN SUPERVISOR     FCOR3257
TIMLOC PZE     **            LOCATION OF TIME IN SUPERVISOR             FCOR3258
ENABLE PZE     =0            LOCATION OF ENABLE WORD IN SUPERVISOR      FCOR3259
       REM                                                              FCOR3260
IOCALL PZE     0             CURRENT I/O ENTRY IN USE                   FCOR3261
       REM                                                              FCOR3262
FILNAM OCT     0,0           CURRENT FILE NAME SAVED HERE               FCOR3263
ANYFIL OCT     -0,0          CODE TO RETURN ANY ACTIVE FILE STATUS      FCOR3264
       REM                                                              FCOR3265
P0     PZE     0             PARAMETER LIST TABLE                       FCOR3266
P1     PZE     0             ..                                         FCOR3267
P2     PZE     0             ..                                         FCOR3268
P3     PZE     0             ..                                         FCOR3269
P4     PZE     0             ..                                         FCOR3270
P5     PZE     0             ..                                         FCOR3271
P6     PZE     0             ..                                         FCOR3272
P7     PZE     0             ..                                         FCOR3273
P8     PZE     0             ..                                         FCOR3274
P9     PZE     0             ..                                         FCOR3275
P10    PZE     0             ..                                         FCOR3276
       REM                                                              FCOR3277
ERWORD PZE     0             ADDRESS TO RETURN ERROR CODE IF ANY        FCOR3278
       REM                                                              FCOR3279
STATUS PZE     0             TEMP FOR OPEN                              FCOR3280
TEMP   PZE     0             GENERAL TEMP FOR FILE COORDINATOR ENTRIES  FCOR3281
SAVEQU PZE     0             TEMP FOR WRFILE, TRFILE                    FCOR3282
WAITSW PZE     0             SWITCH FOR RDFILE,WRFILE,RDWAIT,WRWAIT     FCOR3283
FCLIR4 PZE     0             TEMP FOR CLOSE                             FCOR3284
NEWMOD PZE     0             TEMP FOR CHFILE                            FCOR3285
NAMESW PZE     0             TEMP FOR CHFILE                            FCOR3286
COUNT  PZE     0             TEMP FOR USAVE                             FCOR3287
       REM                                                              FCOR3288
CALL   PZE     **            MEMORY FLAG FOR USER PROGRAM               FCOR3289
MEM    PZE     **            MEMORY FLAG FOR USER I/O MEMORY            FCOR3290
BUF    PZE     **            MEMORY FLAG FOR USER I/O BUFFERS           FCOR3291
       REM                                                              FCOR3292
GTCALL PZE     **            MEMORY FLAG TO PICK UP CALLING SEQUENCE    FCOR3293
GTMEM  PZE     **            MEMORY FLAG FOR CHECKING MEMORY ADDRESSES  FCOR3294
GTBUF  PZE     **            MEMORY FLAG FOR CHECKING BUFFER ADDRESSES  FCOR3295
       REM                                                              FCOR3296
ILC    PZE     0             ILC OF USER CALL TO I/O SYSTEM             FCOR3297
RTNILC PZE     0             USER RETURN ILC                            FCOR3298
ERRTRN PZE     0             ERROR RETURN ILC                           FCOR3299
IR4    PZE     **            USER'S IR4 SAVED HERE                      FCOR3300
       REM                                                              FCOR3301
SVIR12 PZE     **,,**        USER MACHINE CONDITIONS                    FCOR3302
SVIR35 PZE     **,,**        ..                                         FCOR3303
SVIR67 PZE     **,,**        ..                                         FCOR3304
SVSI   BSS     1             ..                                         FCOR3305
       REM                                                              FCOR3306
TMPIR1 PZE     **            TEMPS FOR SAVE/SSAVE                       FCOR3307
TMPIR4 PZE     **,,**        ..                                         FCOR3308
NOPAR  PZE     **            ..                                         FCOR3309
PARMEM PZE     0             ..                                         FCOR3310
TMEM   PZE     0             ..                                         FCOR3311
       REM                                                              FCOR3312
SEOF34 PZE     **,,**        TEMP FOR SETEOF                            FCOR3313
       REM                                                              FCOR3314
GETMX4 PZE     **            TEMPS FOR GTDYTM                           FCOR3315
DATTMP PZE     0             ..                                         FCOR3316
DATE   PZE     0             ..                                         FCOR3317
       REM                                                              FCOR3318
CKLX34 PZE     **,,**        TEMPS FOR CKLINK                           FCOR3319
       REM                                                              FCOR3320
CHKTMP BSS     LNAME2-FPROBN+1 TEMP FOR CHKUFD                          FCOR3321
       REM                                                              FCOR3322
STAFLX PZE     0             TEMPS FOR STAFIL                           FCOR3323
STATMP PZE     0             ..                                         FCOR3324
       REM                                                              FCOR3325
GTSIR4 PZE     **            TEMP FOR GTSTAT                            FCOR3326
       REM                                                              FCOR3327
CKACTP PZE     **            TEMP FOR CHKACT                            FCOR3328
       REM                                                              FCOR3329
RELIR4 PZE     **            TEMP FOR RELEAS                            FCOR3330
       REM                                                              FCOR3331
RTNFX4 PZE     **            TEMP FOR RTNFIL                            FCOR3332
       REM                                                              FCOR3333
NAMSUM PZE     0             TEMP FOR LOCK/UNLOCK                       FCOR3334
       REM                                                              FCOR3335
UPDX34 PZE     **,,**        TEMP FOR UPDSYS                            FCOR3336
       REM                                                              FCOR3337
DFILX4 PZE     **            TEMPS FOR DFILE                            FCOR3338
DELREC PZE     1,,**         ..                                         FCOR3339
       REM                                                              FCOR3340
RECTMP PZE     0             TEMP FOR ADDREC/SUBREC                     FCOR3341
       REM                                                              FCOR3342
USTEMP PZE     0             TEMPS FOR USTORE                           FCOR3343
USTX34 PZE     **,,**        ..                                         FCOR3344
       REM                                                              FCOR3345
REFTMP PZE     **            X4 FOR REFMFD                              FCOR3346
       REM                                                              FCOR3347
MVHX12 PZE     **,,**        TEMPS FOR MVHOME                           FCOR3348
MVHIR4 PZE     **            ..                                         FCOR3349
       REM                                                              FCOR3350
MOVX34 PZE     **,,**        TEMPS FOR MOVE                             FCOR3351
FRMEM  PZE     0             ..                                         FCOR3352
TOMEM  PZE     0             ..                                         FCOR3353
FRWORD PZE     0             ..                                         FCOR3354
TOWORD PZE     0             ..                                         FCOR3355
       REM                                                              FCOR3356
RCKTMP PZE     0             TEMP FOR RCHECK                            FCOR3357
       REM                                                              FCOR3358
SCATMP SCA     GTATMP,**     VARIABLE INTSTUCTION AND TEMP FOR GETEFA   FCOR3359
GTATMP PZE     **            ..                                         FCOR3360
       REM                                                              FCOR3361
TLCNT  PZE     0             TEMPS FOR ADDREC                           FCOR3362
TNREC  PZE     0             ..                                         FCOR3363
       REM                                                              FCOR3364
SORTSW PZE     0             TEMP FOR SORT                              FCOR3365
       REM                                                              FCOR3366
IRSX12 PZE     **,,**        TEMPS FOR IRSAV/IRRST                      FCOR3367
IRSX34 PZE     **,,**        ..                                         FCOR3368
       REM                                                              FCOR3369
TNUM   PZE     0             TEMP FOR 'BCBN2'                           FCOR3370
       REM                                                              FCOR3371
FILTMP BSS     ACTLNG        TEMPORARY BUFFER FOR ACTIVE FILE ENTRY     FCOR3372
       REM                                                              FCOR3373
ZEROQ  BSS     QUEUE1-PROBNO QUEUE FOR SLOT NUMBER ZERO                 FCOR3374
       PZE     ZEROQ1,,1QL   ..                                         FCOR3375
       PZE     ZEROQ2,,2QL   ..                                         FCOR3376
       BSS     AFENTY-QUEUE3 ..                                         FCOR3377
       DUP     1,SFILES      .. NO. OF ACTIVE FILES NEEDED BY SEARCH    FCOR3378
       BSS     ACTLNG        ..                                         FCOR3379
ZEROQL SYN     *-ZEROQ       ..                                         FCOR3380
       REM                                                              FCOR3381
ZEROQ1 BSS     1QL           STORAGE FOR QUEUE1 SLOT NO. 0              FCOR3382
ZEROQ2 BSS     2QL           STORAGE FOR QUEUE2 SLOT NO. 0              FCOR3383
       REM                                                              FCOR3384
HBUFL  EQU     20            UTILITY BUFFER FOR I/O SYSTEM              FCOR3385
HBUF   BSS     HBUFL         ..                                         FCOR3386
       REM                                                              FCOR3387
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  FCOR3388
       REM                                                              FCOR3389
       REM     ..... CONSTANTS FOR FILE COORDINATOR ....................FCOR3390
       REM                                                              FCOR3391
MFD    BCI     2,M.F.D.(FILE)  NAME OF MASTER FILE DIRECTORY            FCOR3392
UTFNAM BCI     1,(FILE)      SECOND NAME OF USAGE TABLES                FCOR3393
DRMNAM BCI     1,DRUMUT      DRUM USAGE TABLE, FIRST NAME               FCOR3394
DSKNAM BCI     1,DISKUT      DISK USAGE TABLE, ..                       FCOR3395
       REM                                                              FCOR3396
EXTEND PZE     RGRACE        NO. OF RECORDS USER MAY EXCEED HIS QUOTA   FCOR3397
       REM                                                              FCOR3398
HOME   PZE     IOSMEM        FLAG FOR MEMORY IN WHICH I/O SYSTEM RESIDESFCOR3399
       REM                                                              FCOR3400
NULPAR OCT     -0            FLAG FOR MISSING PARAMETER                 FCOR3401
       REM                                                              FCOR3402
TGPMAX PZE     0,PMAX        PMAX IN TAG                                FCOR3403
M.IL.F PZE     0,2,0         STANDARD MODE AND DEVICE FOR NEW FILE      FCOR3404
TPUNIT PZE     0,3,0         MODE AND DEVICE FOR TAPE FILE              FCOR3405
       REM                                                              FCOR3406
ICFLAG SYN     *-1           RETURN FLAGS FOR FILE EXIT ROUTINE         FCOR3407
       PZE     0,,1          .. FLAG FOR MEMORY 'A'                     FCOR3408
       PZE     0,,2          .. FLAG FOR MEMORY 'B'                     FCOR3409
       REM                                                              FCOR3410
FRSTER HTR     *             HERE ON ERROR IN FIRST CALL TO IOS         FCOR3411
       TTL     REMOTE SEQUENCES --- ERROR CALLS AND DEFINITIONS         FCOR3412
       PMC     ON                                                       FCOR3413
       RMT     *             FORCE REMOTE SEQUENCES                     FCOR3414
       PMC     OFF                                                      FCOR3415
       TTL     FILE CO-ORDINATOR LITERALS/CROSS-REFERENCE LISTING       FCOR3416
       END                                                              FCOR3417
